<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/12/UPGRADING-CEPH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/12/UPGRADING-CEPH/" class="post-title-link" itemprop="url">UPGRADING CEPH</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-12 10:55:29" itemprop="dateCreated datePublished" datetime="2019-10-12T10:55:29+08:00">2019-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SUMMARY"><a href="#SUMMARY" class="headerlink" title="SUMMARY"></a>SUMMARY</h1><p>您可以在群集处于online并in service状态时升级Ceph群集中的daemons！某些类型的daemons依赖于其他daemon。例如，Ceph<br>Metadata Servers和Ceph Object Gateways依赖于Ceph<br>Monitors和Ceph OSD Daemons。我们建议按以下顺序升级：</p>
<p>1、Ceph Deploy</p>
<p>2、Ceph Monitors</p>
<p>3、Ceph OSD Daemons</p>
<p>4、Ceph Metadata Servers</p>
<p>5、Ceph Object Gateways</p>
<p>通常，我们建议升级所有daemons以确保它们都在同一版本上（例如，所有ceph-mon daemons，所有ceph-osd daemons等）。我们还建议您先升级集群中的所有daemons，然后再尝试使用新功能。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/install/upgrading-ceph/#upgrade-procedures">Upgrade Procedures</a>比较简单，在升级之前需要查看<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/releases">release notes document of your release</a>。基础过程包括三个步骤：</p>
<p>1、 在admin节点上使用ceph-deploy为多个host升级packages（使用ceph-deploy install命令），或者登陆到每个host使用package manager升级Ceph package。例如，在升级Monitors时，ceph-deploy语法可能如下所示： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1[ ceph-node2]</span><br><span class="line"></span><br><span class="line">ceph-deploy install --release firefly mon1 mon2 mon3</span><br></pre></td></tr></table></figure>
<p>注意：ceph-deploy install命令会将指定节点中的packages从旧版本升级到你指定的版本。（该工具不存在ceph-deploy upgrade命令）</p>
<p>2、 登陆到每个Ceph节点，然后重新启动每个Ceph daemon，有关详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/rados/operations/operating">Operating a Cluster</a>。</p>
<p>3、 确保您的群集healthy。有关详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/rados/operations/monitoring">Monitoring a Cluster</a>。</p>
<p><code>重要说明：升级daemon后，将无法降级。</code></p>
<h1 id="CEPH-DEPLOY"><a href="#CEPH-DEPLOY" class="headerlink" title="CEPH DEPLOY"></a>CEPH DEPLOY</h1><p>在升级Ceph daemons之前，先升级ceph-deploy工具。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install -U ceph-deploy</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ceph-deploy</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install ceph-deploy python-pushy</span><br></pre></td></tr></table></figure>
<h1 id="UPGRADE-PROCEDURES"><a href="#UPGRADE-PROCEDURES" class="headerlink" title="UPGRADE PROCEDURES"></a>UPGRADE PROCEDURES</h1><p>以下各节描述了升级过程。</p>
<p>重要说明：每个Ceph版本可能都有一些其他步骤。在开始升级daemons之前，请详细阅读<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/releases">release notes document of your release</a>。</p>
<h2 id="UPGRADING-MONITORS"><a href="#UPGRADING-MONITORS" class="headerlink" title="UPGRADING MONITORS"></a>UPGRADING MONITORS</h2><p>要升级monitors，执行以下步骤：</p>
<p>1、为每个daemon instance升级Ceph package。</p>
<p>可以使用ceph-deploy一次指定所有的monitor节点。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1[ ceph-node2]</span><br><span class="line">ceph-deploy install --release hammer mon1 mon2 mon3</span><br></pre></td></tr></table></figure>
<p>你也可以在每个节点上使用<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/install/install-storage-cluster/">distro’s package manager</a>。对于Debian/Ubuntu，在每个主机上执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install ceph</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat，执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo yum update &amp;&amp; sudo yum install ceph</span><br></pre></td></tr></table></figure>
<p>2、重新启动每个monitor，对于Ubuntu</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-mon id&#x3D;&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat/Debian，使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;ceph restart &#123;mon-id&#125;</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat通过ceph-deploy部署的集群，monitor ID通常为mon.{hostname}。</p>
<p>3、确保每个monitor都重新quorum</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mon stat</span><br></pre></td></tr></table></figure>
<p>确保你已完成所有Ceph Monitor的升级步骤。</p>
<h2 id="UPGRADING-AN-OSD"><a href="#UPGRADING-AN-OSD" class="headerlink" title="UPGRADING AN OSD"></a>UPGRADING AN OSD</h2><p>要升级Ceph OSD Daemon，请执行以下步骤：</p>
<p>1、 升级Ceph OSD Daemon package。</p>
<p>可以使用ceph-deploy一次指定所有的monitor节点。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1[ ceph-node2]</span><br><span class="line">ceph-deploy install --release hammer osd1 osd2 osd3</span><br></pre></td></tr></table></figure>
<p>你也可以在每个节点上使用<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/install/install-storage-cluster/">distro’s package manager</a>。对于Debian/Ubuntu，在每个主机上执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install ceph</span><br></pre></td></tr></table></figure>
<p>对于CentOS / Red Hat，执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo yum update &amp;&amp; sudo yum install ceph</span><br></pre></td></tr></table></figure>
<p>2、重新启动OSD，其中N是OSD number。对于Ubuntu，请使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-osd id&#x3D;N</span><br></pre></td></tr></table></figure>
<p>对于主机上的多个OSD，可以使用Upstart重新启动所有OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-osd-all</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat/Debian，使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;ceph restart N</span><br></pre></td></tr></table></figure>
<p>3、确保每个升级的Ceph OSD Daemon都已重新加入集群：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph osd stat</span><br></pre></td></tr></table></figure>
<p>确保你已完成所有Ceph OSD Daemons的升级步骤。</p>
<h2 id="UPGRADING-A-METADATA-SERVER"><a href="#UPGRADING-A-METADATA-SERVER" class="headerlink" title="UPGRADING A METADATA SERVER"></a>UPGRADING A METADATA SERVER</h2><p>要升级Ceph Metadata Server，请执行以下步骤：</p>
<p>1、升级Ceph Metadata Server package。可以使用ceph-deploy一次指定所有的Ceph Metadata Server节点，或在每个节点上使用package manager。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1</span><br><span class="line">ceph-deploy install --release hammer mds1</span><br></pre></td></tr></table></figure>
<p>要手动升级packages，请在每个Debian/Ubuntu节点上执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;mon-host&#125;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install ceph-mds</span><br></pre></td></tr></table></figure>
<p>或在CentOS/Red Hat节点上执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;mon-host&#125;</span><br><span class="line">sudo yum update &amp;&amp; sudo yum install ceph-mds</span><br></pre></td></tr></table></figure>
<p>2、重新启动metadata server。对于Ubuntu，请使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-mds id&#x3D;&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat/Debian，使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;ceph restart mds.&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>对于使用ceph-deploy部署的集群，name通常是您在创建时指定的name或hostname。</p>
<p>3、确保metadata server已启动并正在运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mds stat</span><br></pre></td></tr></table></figure>
<h2 id="UPGRADING-A-CLIENT"><a href="#UPGRADING-A-CLIENT" class="headerlink" title="UPGRADING A CLIENT"></a>UPGRADING A CLIENT</h2><p>升级packages并在Ceph集群上重新启动daemons后，我们建议您也升级client节点上的ceph-common和client libraries（librbd1和librados2）。</p>
<p>1、 升级package。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;client-host&#125;</span><br><span class="line">apt-get update &amp;&amp; sudo apt-get install ceph-common librados2 librbd1 python-rados python-rbd</span><br></pre></td></tr></table></figure>
<p>2、确保已升级为新版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph --version</span><br></pre></td></tr></table></figure>
<p>如果没有升级为最新版本，则需要卸载，auto remove dependencies并重新安装。</p>
<h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><h2 id="升级Ceph服务端package"><a href="#升级Ceph服务端package" class="headerlink" title="升级Ceph服务端package"></a>升级Ceph服务端package</h2><h3 id="升级可能带来的影响"><a href="#升级可能带来的影响" class="headerlink" title="升级可能带来的影响"></a>升级可能带来的影响</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（1）服务端升级可能会影响客户业务，导致业务中断一定时间。如果cephfs或rgw前端有流量（install ceph package时会自动停掉mds与rgw service），请先将升级节点流量先转向其他节点。</span><br><span class="line">（2）如果容器中有ceph client packages，同样需要逐一转走流量，再升级</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/releases/nautilus/">原文</a></p>
<h3 id="UPGRADING-FROM-PRE-LUMINOUS-RELEASES-LIKE-JEWEL"><a href="#UPGRADING-FROM-PRE-LUMINOUS-RELEASES-LIKE-JEWEL" class="headerlink" title="UPGRADING FROM PRE-LUMINOUS RELEASES (LIKE JEWEL)"></a>UPGRADING FROM PRE-LUMINOUS RELEASES (LIKE JEWEL)</h3><p>您必须先升级到Luminous（12.2.z），然后再尝试升级到Nautilus。 另外，您的集群必须在运行Luminous的同时至少完成了所有PG的一次scrub，并在OSD map中设置了recovery_deletes和purged_snapdirs标志。</p>
<h3 id="UPGRADING-FROM-MIMIC-OR-LUMINOUS"><a href="#UPGRADING-FROM-MIMIC-OR-LUMINOUS" class="headerlink" title="UPGRADING FROM MIMIC OR LUMINOUS"></a>UPGRADING FROM MIMIC OR LUMINOUS</h3><p><strong>NOTES</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在从Luminous升级到Nautilus的过程中，将monitors升级到Nautilus后，将无法使用Luminous ceph-osd daemon创建新的OSD。我们建议您避免在升级过程中添加或替换任何OSD。</span><br><span class="line">我们建议您避免在升级过程中创建任何RADOS pools。</span><br><span class="line">您可以使用ceph version(s)命令在每个阶段监视升级进度，该命令将告诉您每种daemon正在运行的ceph版本。</span><br></pre></td></tr></table></figure>
<h3 id="UPGRADE-COMPATIBILITY-NOTES（升级兼容性说明）"><a href="#UPGRADE-COMPATIBILITY-NOTES（升级兼容性说明）" class="headerlink" title="UPGRADE COMPATIBILITY NOTES（升级兼容性说明）"></a>UPGRADE COMPATIBILITY NOTES（升级兼容性说明）</h3><p>这些更改发生在Mimic和Nautilus版本之间。</p>
<ul>
<li><p>ceph pg stat输出已修改为json格式，以匹配ceph df输出：</p>
<ul>
<li>“raw_bytes” field renamed to “total_bytes”</li>
<li>“raw_bytes_avail” field renamed to “total_bytes_avail”</li>
<li>“raw_bytes_avail” field renamed to “total_bytes_avail”</li>
<li>“raw_bytes_used” field renamed to “total_bytes_raw_used”</li>
<li>添加了“total_bytes_used” field 来表示分配给block(slow) device上data objects的（所有OSD）空间</li>
</ul>
</li>
<li><p>ceph df [detail]输出（GLOBAL section）格式进行了修改：</p>
<ul>
<li>新的‘USED’ column显示了分配给block(slow) device上data objects的（所有OSD）空间</li>
<li>现在，‘RAW USED’ 是‘USED’空间与为Ceph目的在块设备上分配/保留的空间之和。BlueStore的BlueFS部分。</li>
</ul>
</li>
</ul>
<h3 id="INSTRUCTIONS（使用说明）"><a href="#INSTRUCTIONS（使用说明）" class="headerlink" title="INSTRUCTIONS（使用说明）"></a>INSTRUCTIONS（使用说明）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">1、如果您的集群最初安装的是Luminous之前的版本，请确保在运行Luminous时集群已完成对所有PG的至少一次完整scrub。否则，将导致您的monitor daemons在启动时拒绝加入quorum，从而使其无法运行。如果不确定Luminous集群是否已完成所有PG的完全scrub，则可以通过运行以下命令检查集群的状态：</span><br><span class="line">ceph osd dump | grep ^flags		(OSD map必须包含recovery_deletes和purged_snapdirs标志)</span><br><span class="line"></span><br><span class="line">如果您的OSD map不包含这两个标志，则只需等待大约24-48小时，在标准群集配置中，应该有充足的时间，以便至少一次scrub所有placement groups，然后重复上述过程 重新检查。</span><br><span class="line">如果您刚刚完成了对Luminous的升级，并且想在短时间内进行升级到Mimic，可以使用shell命令在所有placement groups上强制执行scrub，例如：</span><br><span class="line">ceph pg dump pgs_brief | cut -d &quot; &quot; -f 1 | xargs -n1 ceph pg scrub</span><br><span class="line">您应该考虑到这种强制性scrub可能会对您的Ceph客户的性能产生负面影响。</span><br><span class="line"></span><br><span class="line">2、确保您的群集stable且healthy（没有宕机或无法恢复的OSD）。 （可选，但推荐。）</span><br><span class="line"></span><br><span class="line">3、在升级期间设置noout标志。 （可选，但建议使用。）</span><br><span class="line">ceph osd set noout</span><br><span class="line"></span><br><span class="line">4、通过安装新软件包并重新启动monitor daemons来升级monitors。 例如，在每个monitors主机上，：</span><br><span class="line">systemctl restart ceph-mon.target</span><br><span class="line">所有monitors启动之后，通过在mon map中查找nautilus字符串来验证monitor升级是否完成。 命令：</span><br><span class="line">ceph mon dump | grep min_mon_release</span><br><span class="line">应报告：</span><br><span class="line">min_mon_release 14 (nautilus)</span><br><span class="line">如果不是，则表示尚未升级和重新启动monitors，或者quorum不包括所有monitors。</span><br><span class="line"></span><br><span class="line">5、通过安装新packages并重新启动所有manager daemons来升级ceph-mgr daemons。 例如，在每个manager主机上，：</span><br><span class="line">systemctl restart ceph-mgr.target</span><br><span class="line">请注意，如果您使用的是Ceph Dashboard，则升级ceph-mgr package后可能需要单独安装ceph-mgr-dashboard。ceph-mgr-dashboard的安装脚本将自动为您重新启动manager daemons。 因此，在这种情况下，您可以跳过该步骤以重新启动daemons。</span><br><span class="line">通过检查ceph -s来验证ceph-mgr daemons是否正在运行：</span><br><span class="line"># ceph -s</span><br><span class="line">...</span><br><span class="line">  services:</span><br><span class="line">   mon: 3 daemons, quorum foo,bar,baz</span><br><span class="line">   mgr: foo(active), standbys: bar, baz</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">6、通过安装新packages并在所有OSD主机上重新启动ceph-osd daemons来升级所有OSD：</span><br><span class="line">systemctl restart ceph-osd.target</span><br><span class="line">您可以使用ceph versions或ceph osd versions命令监视OSD升级的进度：</span><br><span class="line"># ceph osd versions</span><br><span class="line">&#123;</span><br><span class="line">   &quot;ceph version 13.2.5 (...) mimic (stable)&quot;: 12,</span><br><span class="line">   &quot;ceph version 14.2.0 (...) nautilus (stable)&quot;: 22,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">7、如果集群中通过ceph-disk部署了OSD（例如，几乎所有在Mimic版本之前创建的OSD），您都需要让ceph-volume承担启动daemons的责任。 在包含OSD的每个主机上，确保OSD当前正在运行，然后：</span><br><span class="line">ceph-volume simple scan   （所有使用ceph-disk创建的并正在运行的OSDs，从OSD data partition或directory中捕获元数据）</span><br><span class="line">ceph-volume simple activate --all （使systemd units可以mount已配置的devices，并启动Ceph OSD）</span><br><span class="line">我们建议按照此步骤重新启动每个OSD主机，以验证OSD是否自动启动。</span><br><span class="line">请注意，ceph-volume不具有与ceph-disk相同的hot-plug功能，后者通过udev events自动检测到新连接的磁盘。如果运行上述scan命令时OSD当前未running，或者将基于ceph-disk的OSD移至新主机，或者重新安装了主机OSD，或者&#x2F;etc&#x2F;ceph&#x2F;osd目录丢失， 您将需要显式扫描每个ceph-disk OSD的主数据分区。例如，：</span><br><span class="line">ceph-volume simple scan &#x2F;dev&#x2F;sdb1</span><br><span class="line">输出将包括相应的ceph-volume simple activate命令以启用OSD。</span><br><span class="line"></span><br><span class="line">8、升级所有CephFS MDS daemons。 对于每个CephFS file system，</span><br><span class="line">	8.1	将ranks数减少到1。（如果您打算稍后还原它，请首先记录MDS守护程序的原始数量）：</span><br><span class="line">	ceph status</span><br><span class="line">	ceph fs set &lt;fs_name&gt; max_mds 1</span><br><span class="line">	8.2 通过定期检查状态，等待集群停用所有non-zero ranks：</span><br><span class="line">	ceph status</span><br><span class="line">	8.3 使用以下命令使所有standby MDS daemons在适当的主机上offline：</span><br><span class="line">	systemctl stop ceph-mds@&lt;daemon_name&gt;</span><br><span class="line">	8.4 确认只有一个MDS处于online，并且您的FS的rank 0：</span><br><span class="line">	ceph status</span><br><span class="line">	8.5 通过安装新packages并重新启动daemon来升级剩余的MDS daemon：</span><br><span class="line">	systemctl restart ceph-mds.target</span><br><span class="line">	</span><br><span class="line">	8.6 重新启动所有已offline的standby MDS daemons</span><br><span class="line">	systemctl start ceph-mds.target</span><br><span class="line">	</span><br><span class="line">	8.7 恢复该volume的max_mds原始值：</span><br><span class="line">	ceph fs set &lt;fs_name&gt; max_mds &lt;original_max_mds&gt;</span><br><span class="line">	</span><br><span class="line">9、通过升级packages并在所有主机上重新启动daemons来升级所有radosgw daemons：</span><br><span class="line">systemctl restart ceph-radosgw.target</span><br><span class="line"></span><br><span class="line">10、禁用Nautilus之前的OSD并启用所有Nautilus的新功能来完成升级：</span><br><span class="line">ceph osd require-osd-release nautilus</span><br><span class="line"></span><br><span class="line">11、如果您一开始设置noout，请确保清除它：</span><br><span class="line">ceph osd unset noout</span><br><span class="line"></span><br><span class="line">12、使用ceph health验证集群是否healthy</span><br><span class="line">如果您的CRUSH tunables（可调参数）早于Hammer，Ceph现在将发出健康警告。 如果您看到有这种效果的健康警报，则可以使用以下方法还原此更改：</span><br><span class="line">ceph config set mon mon_crush_min_required_version firefly</span><br><span class="line">但是，如果Ceph没有警报，那么我们建议您也将所有现有的CRUSH buckets都切换到straw2，这是Hammer版本中重新添加的。如果您有任何“straw” buckets，这将导致少量的数据移动，但通常不会太严重。</span><br><span class="line">ceph osd getcrushmap -o backup-crushmap</span><br><span class="line">ceph osd crush set-all-straw-buckets-to-straw2</span><br><span class="line">如果有问题，您可以还原：</span><br><span class="line">ceph osd setcrushmap -i backup-crushmap</span><br><span class="line">移至“straw2” buckets将解锁一些最新功能，例如在Luminous中crush-compat balancer mode（https:&#x2F;&#x2F;docs.ceph.com&#x2F;docs&#x2F;master&#x2F;rados&#x2F;operations&#x2F;balancer&#x2F;#balancer）。</span><br><span class="line"></span><br><span class="line">13、要启用新的 v2 network protocol，请发出以下命令：</span><br><span class="line">ceph mon enable-msgr2</span><br><span class="line">指示所有与旧版v1 protocol绑定到旧的默认端口6789的monitors，同时也绑定到新的3300 v2 protocol端口。要查看是否所有monitors都已更新，请执行以下操作：</span><br><span class="line">ceph mon dump</span><br><span class="line">并确认每个monitors都显示v2:和v1:地址。</span><br><span class="line"></span><br><span class="line">14、对于已升级的每个主机，应更新ceph.conf文件，使其不指定monitor端口（如果您在默认端口上运行monitor），或者显式引用v2和v1地址和端口。 如果仅列出了v1 IP和端口，则一切仍将起作用，但是在得知monitor也使用v2协议后，每个CLI实例或daemon都将需要重新连接，这会减慢速度并阻止完全过渡到v2协议。</span><br><span class="line">这也是将ceph.conf中的所有配置选项完全转换到集群的配置数据库中的好时机。 在每个主机上，您可以使用以下命令通过以下命令将所有选项导入monitor：</span><br><span class="line">ceph config assimilate-conf -i &#x2F;etc&#x2F;ceph&#x2F;ceph.conf</span><br><span class="line">您可以通过以下方式查看集群的配置数据库：</span><br><span class="line">ceph config dump</span><br><span class="line">要为每个主机创建一个最小但足够的ceph.conf，请执行以下操作：</span><br><span class="line">ceph config generate-minimal-conf &gt; &#x2F;etc&#x2F;ceph&#x2F;ceph.conf.new</span><br><span class="line">mv &#x2F;etc&#x2F;ceph&#x2F;ceph.conf.new &#x2F;etc&#x2F;ceph&#x2F;ceph.conf</span><br><span class="line">确保仅在已升级到Nautilus的主机上使用此新配置，因为它可能包含mon_host值，该值包含Nautilus能理解的IP地址的新v2:和v1:前缀。</span><br><span class="line">有关更多信息，请参阅https:&#x2F;&#x2F;docs.ceph.com&#x2F;docs&#x2F;master&#x2F;rados&#x2F;configuration&#x2F;msgr2&#x2F;#msgr2-ceph-conf</span><br><span class="line"></span><br><span class="line">15、考虑启用telemetry module以将匿名使用情况统计信息和崩溃信息发送给Ceph upstream developers。 查看将要报告的内容（实际上没有向任何人发送任何信息），请执行以下操作：</span><br><span class="line">ceph mgr module enable telemetry</span><br><span class="line">ceph telemetry show</span><br><span class="line">如果您对所报告的数据感到满意，则可以选择使用以下方法自动报告high-level cluster metadata：</span><br><span class="line">ceph telemetry on</span><br><span class="line">有关telemetry module的更多信息，请参见文档：https:&#x2F;&#x2F;docs.ceph.com&#x2F;docs&#x2F;master&#x2F;mgr&#x2F;telemetry&#x2F;#telemetry</span><br></pre></td></tr></table></figure>




<p>1、查看当前环境与版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph -v</span><br><span class="line">ceph version 12.2.12 (1436006594665279fe734b4c15d7e08c13ebd777) luminous (stable)</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# cat &#x2F;etc&#x2F;redhat-release </span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# uname -a</span><br><span class="line">Linux ceph2 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph2(active), standbys: ceph3, ceph1</span><br><span class="line">    mds: cephfs-1&#x2F;1&#x2F;1 up  &#123;0&#x3D;ceph1&#x3D;up:active&#125;, 2 up:standby</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">    rgw: 3 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 244 objects, 5.27KiB</span><br><span class="line">    usage:   6.04GiB used, 293GiB &#x2F; 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br><span class="line"> </span><br><span class="line">  io:</span><br><span class="line">    client:   2.00KiB&#x2F;s rd, 0B&#x2F;s wr, 1op&#x2F;s rd, 1op&#x2F;s wr</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# ceph osd tree</span><br><span class="line">ID CLASS WEIGHT  TYPE NAME      STATUS REWEIGHT PRI-AFF </span><br><span class="line">-1       0.29214 root default                           </span><br><span class="line">-5       0.09738     host ceph1                         </span><br><span class="line"> 1   hdd 0.04869         osd.1      up  1.00000 1.00000 </span><br><span class="line"> 4   hdd 0.04869         osd.4      up  1.00000 1.00000 </span><br><span class="line">-7       0.09738     host ceph2                         </span><br><span class="line"> 2   hdd 0.04869         osd.2      up  1.00000 1.00000 </span><br><span class="line"> 5   hdd 0.04869         osd.5      up  1.00000 1.00000 </span><br><span class="line">-3       0.09738     host ceph3                         </span><br><span class="line"> 0   hdd 0.04869         osd.0      up  1.00000 1.00000 </span><br><span class="line"> 3   hdd 0.04869         osd.3      up  1.00000 1.00000 </span><br><span class="line"> </span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep ceph</span><br><span class="line">libcephfs2-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-common-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-radosgw-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-base-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-osd-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-mds-12.2.12-0.el7.x86_64</span><br><span class="line">python-cephfs-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-selinux-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-mon-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-mgr-12.2.12-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rbd</span><br><span class="line">python-rbd-12.2.12-0.el7.x86_64</span><br><span class="line">librbd1-12.2.12-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rados</span><br><span class="line">ceph-radosgw-12.2.12-0.el7.x86_64</span><br><span class="line">librados2-12.2.12-0.el7.x86_64</span><br><span class="line">python-rados-12.2.12-0.el7.x86_64</span><br><span class="line">libradosstriper1-12.2.12-0.el7.x86_64</span><br></pre></td></tr></table></figure>
<p>2、修改每台ceph节点的ceph mirror，L版地址修改为N版地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# vim &#x2F;etc&#x2F;yum.repos.d&#x2F;ceph_stable.repo </span><br><span class="line">[ceph_stable]</span><br><span class="line">baseurl &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;$basearch</span><br><span class="line">gpgcheck &#x3D; 1</span><br><span class="line">gpgkey &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;keys&#x2F;release.asc</span><br><span class="line">name &#x3D; Ceph Stable repo</span><br></pre></td></tr></table></figure>
<p>3、设置noout 标志停机维护</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph osd set noout</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            insufficient standby MDS daemons available</span><br><span class="line">            noout flag(s) set</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph1(active), standbys: ceph3, ceph2</span><br><span class="line">    mds: cephfs-1&#x2F;1&#x2F;1 up  &#123;0&#x3D;ceph2&#x3D;up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 2 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.30KiB</span><br><span class="line">    usage:   6.05GiB used, 293GiB &#x2F; 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br></pre></td></tr></table></figure>
<p>4、升级每台ceph节点的 ceph packages（一个节点一个节点的升）</p>
<p>升级顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、Ceph Monitors</span><br><span class="line">2、Ceph Mgr</span><br><span class="line">3、Ceph OSD Daemons</span><br><span class="line">4、Ceph Metadata Servers</span><br><span class="line">5、Ceph Object Gateways</span><br></pre></td></tr></table></figure>
<p>升级命令（<code>注意：安装过程中rgw与mds服务会自动被stop</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# yum install ceph</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">epel&#x2F;x86_64&#x2F;metalink                                                                                                                                                                                                  | 6.5 kB  00:00:00     </span><br><span class="line"> * base: mirrors.huaweicloud.com</span><br><span class="line"> * epel: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.huaweicloud.com</span><br><span class="line"> * updates: mirrors.huaweicloud.com</span><br><span class="line">base                                                                                                                                                                                                                  | 3.6 kB  00:00:00     </span><br><span class="line">ceph_stable                                                                                                                                                                                                           | 2.9 kB  00:00:00     </span><br><span class="line">epel                                                                                                                                                                                                                  | 5.3 kB  00:00:00     </span><br><span class="line">extras                                                                                                                                                                                                                | 2.9 kB  00:00:00     </span><br><span class="line">updates                                                                                                                                                                                                               | 2.9 kB  00:00:00     </span><br><span class="line">(1&#x2F;8): epel&#x2F;x86_64&#x2F;group_gz                                                                                                                                                                                           |  88 kB  00:00:00     </span><br><span class="line">(2&#x2F;8): ceph_stable&#x2F;x86_64&#x2F;primary_db                                                                                                                                                                                  | 192 kB  00:00:01     </span><br><span class="line">(3&#x2F;8): base&#x2F;7&#x2F;x86_64&#x2F;group_gz                                                                                                                                                                                         | 165 kB  00:00:01     </span><br><span class="line">(4&#x2F;8): epel&#x2F;x86_64&#x2F;updateinfo                                                                                                                                                                                         | 1.0 MB  00:00:02     </span><br><span class="line">(5&#x2F;8): extras&#x2F;7&#x2F;x86_64&#x2F;primary_db                                                                                                                                                                                     | 152 kB  00:00:01     </span><br><span class="line">(6&#x2F;8): base&#x2F;7&#x2F;x86_64&#x2F;primary_db                                                                                                                                                                                       | 6.0 MB  00:00:04     </span><br><span class="line">(7&#x2F;8): updates&#x2F;7&#x2F;x86_64&#x2F;primary_db                                                                                                                                                                                    | 1.9 MB  00:00:05     </span><br><span class="line">(8&#x2F;8): epel&#x2F;x86_64&#x2F;primary_db                                                                                                                                                                                         | 6.9 MB  00:00:16     </span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph.x86_64 2:14.2.4-0.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: ceph-osd &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-mds &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-mgr &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-mon &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph-mds.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-mds.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: ceph-base &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-mds-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librdmacm.so.1()(64bit) for package: 2:ceph-mds-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-mgr.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-mgr.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: python-bcrypt for package: 2:ceph-mgr-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-mon.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-mon.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package ceph-osd.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-osd.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: libstoragemgmt for package: 2:ceph-osd-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph-base.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">--&gt; Processing Dependency: ceph-base &#x3D; 2:12.2.12-0.el7 for package: 2:ceph-selinux-12.2.12-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-base &#x3D; 2:12.2.12-0.el7 for package: 2:ceph-selinux-12.2.12-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-base &#x3D; 2:12.2.12-0.el7 for package: 2:ceph-radosgw-12.2.12-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-base.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: librados2 &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libcephfs2 &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librgw2 &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librbd1 &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-common &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0(LIBOATH_1.10.0)(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0(LIBOATH_1.12.0)(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0(LIBOATH_1.2.0)(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0()(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package librdmacm.x86_64 0:22.1-3.el7 will be installed</span><br><span class="line">---&gt; Package libstoragemgmt.x86_64 0:1.7.3-3.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: libstoragemgmt-python for package: libstoragemgmt-1.7.3-3.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libyajl.so.2()(64bit) for package: libstoragemgmt-1.7.3-3.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libconfig.so.9()(64bit) for package: libstoragemgmt-1.7.3-3.el7.x86_64</span><br><span class="line">---&gt; Package python2-bcrypt.x86_64 0:3.1.6-2.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-cffi for package: python2-bcrypt-3.1.6-2.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python2-six for package: python2-bcrypt-3.1.6-2.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph-common.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-common.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: libradosstriper1 &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-cephfs &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-rbd &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-ceph-argparse &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-rados &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-rgw &#x3D; 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librabbitmq.so.4()(64bit) for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-radosgw.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-radosgw.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package ceph-selinux.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-selinux.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: selinux-policy-base &gt;&#x3D; 3.13.1-229.el7_6.15 for package: 2:ceph-selinux-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package libcephfs2.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package libcephfs2.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package libconfig.x86_64 0:1.4.9-5.el7 will be installed</span><br><span class="line">---&gt; Package liboath.x86_64 0:2.6.2-1.el7 will be installed</span><br><span class="line">---&gt; Package librados2.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package librados2.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package librbd1.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package librbd1.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package librgw2.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package librgw2.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package libstoragemgmt-python.noarch 0:1.7.3-3.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: libstoragemgmt-python-clibs for package: libstoragemgmt-python-1.7.3-3.el7.noarch</span><br><span class="line">---&gt; Package python-cffi.x86_64 0:1.6.0-5.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-pycparser for package: python-cffi-1.6.0-5.el7.x86_64</span><br><span class="line">---&gt; Package python2-six.noarch 0:1.9.0-0.el7 will be installed</span><br><span class="line">---&gt; Package yajl.x86_64 0:2.0.4-4.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package librabbitmq.x86_64 0:0.8.0-2.el7 will be installed</span><br><span class="line">---&gt; Package libradosstriper1.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package libradosstriper1.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package libstoragemgmt-python-clibs.x86_64 0:1.7.3-3.el7 will be installed</span><br><span class="line">---&gt; Package python-ceph-argparse.x86_64 2:14.2.4-0.el7 will be installed</span><br><span class="line">---&gt; Package python-cephfs.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-cephfs.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package python-pycparser.noarch 0:2.14-1.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-ply for package: python-pycparser-2.14-1.el7.noarch</span><br><span class="line">---&gt; Package python-rados.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-rados.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package python-rbd.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-rbd.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package python-rgw.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-rgw.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package selinux-policy-targeted.noarch 0:3.13.1-229.el7 will be updated</span><br><span class="line">---&gt; Package selinux-policy-targeted.noarch 0:3.13.1-252.el7.1 will be an update</span><br><span class="line">--&gt; Processing Dependency: selinux-policy &#x3D; 3.13.1-252.el7.1 for package: selinux-policy-targeted-3.13.1-252.el7.1.noarch</span><br><span class="line">--&gt; Processing Dependency: selinux-policy &#x3D; 3.13.1-252.el7.1 for package: selinux-policy-targeted-3.13.1-252.el7.1.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package python-ply.noarch 0:3.4-11.el7 will be installed</span><br><span class="line">---&gt; Package selinux-policy.noarch 0:3.13.1-229.el7 will be updated</span><br><span class="line">---&gt; Package selinux-policy.noarch 0:3.13.1-252.el7.1 will be an update</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> Package                                                              Arch                                            Version                                                     Repository                                            Size</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Installing:</span><br><span class="line"> ceph                                                                 x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          3.0 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> libconfig                                                            x86_64                                          1.4.9-5.el7                                                 base                                                  59 k</span><br><span class="line"> liboath                                                              x86_64                                          2.6.2-1.el7                                                 epel                                                  51 k</span><br><span class="line"> librabbitmq                                                          x86_64                                          0.8.0-2.el7                                                 base                                                  37 k</span><br><span class="line"> librdmacm                                                            x86_64                                          22.1-3.el7                                                  base                                                  63 k</span><br><span class="line"> libstoragemgmt                                                       x86_64                                          1.7.3-3.el7                                                 base                                                 243 k</span><br><span class="line"> libstoragemgmt-python                                                noarch                                          1.7.3-3.el7                                                 base                                                 167 k</span><br><span class="line"> libstoragemgmt-python-clibs                                          x86_64                                          1.7.3-3.el7                                                 base                                                  19 k</span><br><span class="line"> python-ceph-argparse                                                 x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           36 k</span><br><span class="line"> python-cffi                                                          x86_64                                          1.6.0-5.el7                                                 base                                                 218 k</span><br><span class="line"> python-ply                                                           noarch                                          3.4-11.el7                                                  base                                                 123 k</span><br><span class="line"> python-pycparser                                                     noarch                                          2.14-1.el7                                                  base                                                 104 k</span><br><span class="line"> python2-bcrypt                                                       x86_64                                          3.1.6-2.el7                                                 epel                                                  39 k</span><br><span class="line"> python2-six                                                          noarch                                          1.9.0-0.el7                                                 epel                                                 2.9 k</span><br><span class="line"> yajl                                                                 x86_64                                          2.0.4-4.el7                                                 base                                                  39 k</span><br><span class="line">Updating for dependencies:</span><br><span class="line"> ceph-base                                                            x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          5.4 M</span><br><span class="line"> ceph-common                                                          x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           18 M</span><br><span class="line"> ceph-mds                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          1.8 M</span><br><span class="line"> ceph-mgr                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          1.5 M</span><br><span class="line"> ceph-mon                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          4.5 M</span><br><span class="line"> ceph-osd                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           16 M</span><br><span class="line"> ceph-radosgw                                                         x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          5.3 M</span><br><span class="line"> ceph-selinux                                                         x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           21 k</span><br><span class="line"> libcephfs2                                                           x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          480 k</span><br><span class="line"> librados2                                                            x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          3.3 M</span><br><span class="line"> libradosstriper1                                                     x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          342 k</span><br><span class="line"> librbd1                                                              x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          1.6 M</span><br><span class="line"> librgw2                                                              x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          4.6 M</span><br><span class="line"> python-cephfs                                                        x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           91 k</span><br><span class="line"> python-rados                                                         x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          190 k</span><br><span class="line"> python-rbd                                                           x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          171 k</span><br><span class="line"> python-rgw                                                           x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           76 k</span><br><span class="line"> selinux-policy                                                       noarch                                          3.13.1-252.el7.1                                            updates                                              492 k</span><br><span class="line"> selinux-policy-targeted                                              noarch                                          3.13.1-252.el7.1                                            updates                                              7.0 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Install  1 Package  (+14 Dependent packages)</span><br><span class="line">Upgrade             ( 19 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 72 M</span><br><span class="line">Is this ok [y&#x2F;d&#x2F;N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">Delta RPMs disabled because &#x2F;usr&#x2F;bin&#x2F;applydeltarpm not installed.</span><br><span class="line">(1&#x2F;34): ceph-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                                  | 3.0 kB  00:00:00     </span><br><span class="line">(2&#x2F;34): ceph-common-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           |  18 MB  00:00:19     </span><br><span class="line">(3&#x2F;34): ceph-mds-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 1.8 MB  00:00:01     </span><br><span class="line">(4&#x2F;34): ceph-mgr-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 1.5 MB  00:00:03     </span><br><span class="line">(5&#x2F;34): ceph-mon-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 4.5 MB  00:00:05     </span><br><span class="line">(6&#x2F;34): ceph-osd-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              |  16 MB  00:00:14     </span><br><span class="line">(7&#x2F;34): ceph-radosgw-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                          | 5.3 MB  00:00:07     </span><br><span class="line">(8&#x2F;34): ceph-selinux-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                          |  21 kB  00:00:00     </span><br><span class="line">(9&#x2F;34): libconfig-1.4.9-5.el7.x86_64.rpm                                                                                                                                                                              |  59 kB  00:00:00     </span><br><span class="line">(10&#x2F;34): librabbitmq-0.8.0-2.el7.x86_64.rpm                                                                                                                                                                           |  37 kB  00:00:00     </span><br><span class="line">(11&#x2F;34): libcephfs2-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           | 480 kB  00:00:00     </span><br><span class="line">(12&#x2F;34): librados2-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                            | 3.3 MB  00:00:05     </span><br><span class="line">(13&#x2F;34): libradosstriper1-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                     | 342 kB  00:00:00     </span><br><span class="line">(14&#x2F;34): librdmacm-22.1-3.el7.x86_64.rpm                                                                                                                                                                              |  63 kB  00:00:00     </span><br><span class="line">(15&#x2F;34): liboath-2.6.2-1.el7.x86_64.rpm                                                                                                                                                                               |  51 kB  00:00:07     </span><br><span class="line">(16&#x2F;34): librbd1-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 1.6 MB  00:00:01     </span><br><span class="line">(17&#x2F;34): libstoragemgmt-python-1.7.3-3.el7.noarch.rpm                                                                                                                                                                 | 167 kB  00:00:00     </span><br><span class="line">(18&#x2F;34): libstoragemgmt-1.7.3-3.el7.x86_64.rpm                                                                                                                                                                        | 243 kB  00:00:00     </span><br><span class="line">(19&#x2F;34): libstoragemgmt-python-clibs-1.7.3-3.el7.x86_64.rpm                                                                                                                                                           |  19 kB  00:00:00     </span><br><span class="line">(20&#x2F;34): librgw2-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 4.6 MB  00:00:02     </span><br><span class="line">(21&#x2F;34): python-ceph-argparse-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                 |  36 kB  00:00:00     </span><br><span class="line">(22&#x2F;34): python-ply-3.4-11.el7.noarch.rpm                                                                                                                                                                             | 123 kB  00:00:00     </span><br><span class="line">(23&#x2F;34): python-cffi-1.6.0-5.el7.x86_64.rpm                                                                                                                                                                           | 218 kB  00:00:00     </span><br><span class="line">(24&#x2F;34): python-cephfs-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                        |  91 kB  00:00:00     </span><br><span class="line">(25&#x2F;34): python-pycparser-2.14-1.el7.noarch.rpm                                                                                                                                                                       | 104 kB  00:00:00     </span><br><span class="line">(26&#x2F;34): python-rados-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                         | 190 kB  00:00:00     </span><br><span class="line">(27&#x2F;34): python-rbd-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           | 171 kB  00:00:00     </span><br><span class="line">(28&#x2F;34): python2-six-1.9.0-0.el7.noarch.rpm                                                                                                                                                                           | 2.9 kB  00:00:00     </span><br><span class="line">(29&#x2F;34): python2-bcrypt-3.1.6-2.el7.x86_64.rpm                                                                                                                                                                        |  39 kB  00:00:00     </span><br><span class="line">(30&#x2F;34): python-rgw-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           |  76 kB  00:00:00     </span><br><span class="line">(31&#x2F;34): selinux-policy-3.13.1-252.el7.1.noarch.rpm                                                                                                                                                                   | 492 kB  00:00:00     </span><br><span class="line">(32&#x2F;34): yajl-2.0.4-4.el7.x86_64.rpm                                                                                                                                                                                  |  39 kB  00:00:00     </span><br><span class="line">(33&#x2F;34): selinux-policy-targeted-3.13.1-252.el7.1.noarch.rpm                                                                                                                                                          | 7.0 MB  00:00:02     </span><br><span class="line">(34&#x2F;34): ceph-base-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                            | 5.4 MB  00:01:13     </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                                                                        1.0 MB&#x2F;s |  72 MB  00:01:13     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : librdmacm-22.1-3.el7.x86_64                                                                                                                                                                                              1&#x2F;53 </span><br><span class="line">  Updating   : 2:librados2-14.2.4-0.el7.x86_64                                                                                                                                                                                          2&#x2F;53 </span><br><span class="line">  Updating   : 2:python-rados-14.2.4-0.el7.x86_64                                                                                                                                                                                       3&#x2F;53 </span><br><span class="line">  Installing : liboath-2.6.2-1.el7.x86_64                                                                                                                                                                                               4&#x2F;53 </span><br><span class="line">  Updating   : 2:librbd1-14.2.4-0.el7.x86_64                                                                                                                                                                                            5&#x2F;53 </span><br><span class="line">  Updating   : 2:libcephfs2-14.2.4-0.el7.x86_64                                                                                                                                                                                         6&#x2F;53 </span><br><span class="line">  Installing : librabbitmq-0.8.0-2.el7.x86_64                                                                                                                                                                                           7&#x2F;53 </span><br><span class="line">  Updating   : 2:librgw2-14.2.4-0.el7.x86_64                                                                                                                                                                                            8&#x2F;53 </span><br><span class="line">  Installing : 2:python-ceph-argparse-14.2.4-0.el7.x86_64                                                                                                                                                                               9&#x2F;53 </span><br><span class="line">  Installing : yajl-2.0.4-4.el7.x86_64                                                                                                                                                                                                 10&#x2F;53 </span><br><span class="line">  Updating   : 2:python-cephfs-14.2.4-0.el7.x86_64                                                                                                                                                                                     11&#x2F;53 </span><br><span class="line">  Updating   : 2:python-rgw-14.2.4-0.el7.x86_64                                                                                                                                                                                        12&#x2F;53 </span><br><span class="line">  Updating   : 2:python-rbd-14.2.4-0.el7.x86_64                                                                                                                                                                                        13&#x2F;53 </span><br><span class="line">  Updating   : 2:libradosstriper1-14.2.4-0.el7.x86_64                                                                                                                                                                                  14&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-common-14.2.4-0.el7.x86_64                                                                                                                                                                                       15&#x2F;53 </span><br><span class="line">  Updating   : selinux-policy-3.13.1-252.el7.1.noarch                                                                                                                                                                                  16&#x2F;53 </span><br><span class="line">  Updating   : selinux-policy-targeted-3.13.1-252.el7.1.noarch                                                                                                                                                                         17&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-base-14.2.4-0.el7.x86_64                                                                                                                                                                                         18&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-selinux-14.2.4-0.el7.x86_64                                                                                                                                                                                      19&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-mds-14.2.4-0.el7.x86_64                                                                                                                                                                                          20&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-mon-14.2.4-0.el7.x86_64                                                                                                                                                                                          21&#x2F;53 </span><br><span class="line">  Installing : libconfig-1.4.9-5.el7.x86_64                                                                                                                                                                                            22&#x2F;53 </span><br><span class="line">  Installing : libstoragemgmt-1.7.3-3.el7.x86_64                                                                                                                                                                                       23&#x2F;53 </span><br><span class="line">  Installing : libstoragemgmt-python-clibs-1.7.3-3.el7.x86_64                                                                                                                                                                          24&#x2F;53 </span><br><span class="line">  Installing : libstoragemgmt-python-1.7.3-3.el7.noarch                                                                                                                                                                                25&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-osd-14.2.4-0.el7.x86_64                                                                                                                                                                                          26&#x2F;53 </span><br><span class="line">  Installing : python-ply-3.4-11.el7.noarch                                                                                                                                                                                            27&#x2F;53 </span><br><span class="line">  Installing : python-pycparser-2.14-1.el7.noarch                                                                                                                                                                                      28&#x2F;53 </span><br><span class="line">  Installing : python-cffi-1.6.0-5.el7.x86_64                                                                                                                                                                                          29&#x2F;53 </span><br><span class="line">  Installing : python2-six-1.9.0-0.el7.noarch                                                                                                                                                                                          30&#x2F;53 </span><br><span class="line">  Installing : python2-bcrypt-3.1.6-2.el7.x86_64                                                                                                                                                                                       31&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-mgr-14.2.4-0.el7.x86_64                                                                                                                                                                                          32&#x2F;53 </span><br><span class="line">  Installing : 2:ceph-14.2.4-0.el7.x86_64                                                                                                                                                                                              33&#x2F;53 </span><br><span class="line">  Updating   : 2:ceph-radosgw-14.2.4-0.el7.x86_64                                                                                                                                                                                      34&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-radosgw-12.2.12-0.el7.x86_64                                                                                                                                                                                     35&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-mon-12.2.12-0.el7.x86_64                                                                                                                                                                                         36&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-osd-12.2.12-0.el7.x86_64                                                                                                                                                                                         37&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-mds-12.2.12-0.el7.x86_64                                                                                                                                                                                         38&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-mgr-12.2.12-0.el7.x86_64                                                                                                                                                                                         39&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-selinux-12.2.12-0.el7.x86_64                                                                                                                                                                                     40&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-base-12.2.12-0.el7.x86_64                                                                                                                                                                                        41&#x2F;53 </span><br><span class="line">  Cleanup    : selinux-policy-targeted-3.13.1-229.el7.noarch                                                                                                                                                                           42&#x2F;53 </span><br><span class="line">  Cleanup    : 2:ceph-common-12.2.12-0.el7.x86_64                                                                                                                                                                                      43&#x2F;53 </span><br><span class="line">  Cleanup    : selinux-policy-3.13.1-229.el7.noarch                                                                                                                                                                                    44&#x2F;53 </span><br><span class="line">  Cleanup    : 2:python-rbd-12.2.12-0.el7.x86_64                                                                                                                                                                                       45&#x2F;53 </span><br><span class="line">  Cleanup    : 2:python-rgw-12.2.12-0.el7.x86_64                                                                                                                                                                                       46&#x2F;53 </span><br><span class="line">  Cleanup    : 2:librgw2-12.2.12-0.el7.x86_64                                                                                                                                                                                          47&#x2F;53 </span><br><span class="line">  Cleanup    : 2:python-rados-12.2.12-0.el7.x86_64                                                                                                                                                                                     48&#x2F;53 </span><br><span class="line">  Cleanup    : 2:librbd1-12.2.12-0.el7.x86_64                                                                                                                                                                                          49&#x2F;53 </span><br><span class="line">  Cleanup    : 2:libradosstriper1-12.2.12-0.el7.x86_64                                                                                                                                                                                 50&#x2F;53 </span><br><span class="line">  Cleanup    : 2:python-cephfs-12.2.12-0.el7.x86_64                                                                                                                                                                                    51&#x2F;53 </span><br><span class="line">  Cleanup    : 2:libcephfs2-12.2.12-0.el7.x86_64                                                                                                                                                                                       52&#x2F;53 </span><br><span class="line">  Cleanup    : 2:librados2-12.2.12-0.el7.x86_64                                                                                                                                                                                        53&#x2F;53 </span><br><span class="line">  Verifying  : 2:librados2-14.2.4-0.el7.x86_64                                                                                                                                                                                          1&#x2F;53 </span><br><span class="line">  Verifying  : liboath-2.6.2-1.el7.x86_64                                                                                                                                                                                               2&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-rgw-14.2.4-0.el7.x86_64                                                                                                                                                                                         3&#x2F;53 </span><br><span class="line">  Verifying  : python2-six-1.9.0-0.el7.noarch                                                                                                                                                                                           4&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-14.2.4-0.el7.x86_64                                                                                                                                                                                               5&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-mgr-14.2.4-0.el7.x86_64                                                                                                                                                                                           6&#x2F;53 </span><br><span class="line">  Verifying  : python2-bcrypt-3.1.6-2.el7.x86_64                                                                                                                                                                                        7&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-osd-14.2.4-0.el7.x86_64                                                                                                                                                                                           8&#x2F;53 </span><br><span class="line">  Verifying  : libstoragemgmt-python-clibs-1.7.3-3.el7.x86_64                                                                                                                                                                           9&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-base-14.2.4-0.el7.x86_64                                                                                                                                                                                         10&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-common-14.2.4-0.el7.x86_64                                                                                                                                                                                       11&#x2F;53 </span><br><span class="line">  Verifying  : 2:libradosstriper1-14.2.4-0.el7.x86_64                                                                                                                                                                                  12&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-rados-14.2.4-0.el7.x86_64                                                                                                                                                                                      13&#x2F;53 </span><br><span class="line">  Verifying  : 2:librbd1-14.2.4-0.el7.x86_64                                                                                                                                                                                           14&#x2F;53 </span><br><span class="line">  Verifying  : librdmacm-22.1-3.el7.x86_64                                                                                                                                                                                             15&#x2F;53 </span><br><span class="line">  Verifying  : libstoragemgmt-python-1.7.3-3.el7.noarch                                                                                                                                                                                16&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-mds-14.2.4-0.el7.x86_64                                                                                                                                                                                          17&#x2F;53 </span><br><span class="line">  Verifying  : python-ply-3.4-11.el7.noarch                                                                                                                                                                                            18&#x2F;53 </span><br><span class="line">  Verifying  : 2:libcephfs2-14.2.4-0.el7.x86_64                                                                                                                                                                                        19&#x2F;53 </span><br><span class="line">  Verifying  : libconfig-1.4.9-5.el7.x86_64                                                                                                                                                                                            20&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-selinux-14.2.4-0.el7.x86_64                                                                                                                                                                                      21&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-radosgw-14.2.4-0.el7.x86_64                                                                                                                                                                                      22&#x2F;53 </span><br><span class="line">  Verifying  : selinux-policy-targeted-3.13.1-252.el7.1.noarch                                                                                                                                                                         23&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-mon-14.2.4-0.el7.x86_64                                                                                                                                                                                          24&#x2F;53 </span><br><span class="line">  Verifying  : yajl-2.0.4-4.el7.x86_64                                                                                                                                                                                                 25&#x2F;53 </span><br><span class="line">  Verifying  : 2:librgw2-14.2.4-0.el7.x86_64                                                                                                                                                                                           26&#x2F;53 </span><br><span class="line">  Verifying  : python-cffi-1.6.0-5.el7.x86_64                                                                                                                                                                                          27&#x2F;53 </span><br><span class="line">  Verifying  : python-pycparser-2.14-1.el7.noarch                                                                                                                                                                                      28&#x2F;53 </span><br><span class="line">  Verifying  : libstoragemgmt-1.7.3-3.el7.x86_64                                                                                                                                                                                       29&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-rbd-14.2.4-0.el7.x86_64                                                                                                                                                                                        30&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-cephfs-14.2.4-0.el7.x86_64                                                                                                                                                                                     31&#x2F;53 </span><br><span class="line">  Verifying  : selinux-policy-3.13.1-252.el7.1.noarch                                                                                                                                                                                  32&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-ceph-argparse-14.2.4-0.el7.x86_64                                                                                                                                                                              33&#x2F;53 </span><br><span class="line">  Verifying  : librabbitmq-0.8.0-2.el7.x86_64                                                                                                                                                                                          34&#x2F;53 </span><br><span class="line">  Verifying  : selinux-policy-targeted-3.13.1-229.el7.noarch                                                                                                                                                                           35&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-mgr-12.2.12-0.el7.x86_64                                                                                                                                                                                         36&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-osd-12.2.12-0.el7.x86_64                                                                                                                                                                                         37&#x2F;53 </span><br><span class="line">  Verifying  : selinux-policy-3.13.1-229.el7.noarch                                                                                                                                                                                    38&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-base-12.2.12-0.el7.x86_64                                                                                                                                                                                        39&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-rados-12.2.12-0.el7.x86_64                                                                                                                                                                                     40&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-cephfs-12.2.12-0.el7.x86_64                                                                                                                                                                                    41&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-common-12.2.12-0.el7.x86_64                                                                                                                                                                                      42&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-mon-12.2.12-0.el7.x86_64                                                                                                                                                                                         43&#x2F;53 </span><br><span class="line">  Verifying  : 2:libradosstriper1-12.2.12-0.el7.x86_64                                                                                                                                                                                 44&#x2F;53 </span><br><span class="line">  Verifying  : 2:libcephfs2-12.2.12-0.el7.x86_64                                                                                                                                                                                       45&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-rbd-12.2.12-0.el7.x86_64                                                                                                                                                                                       46&#x2F;53 </span><br><span class="line">  Verifying  : 2:librbd1-12.2.12-0.el7.x86_64                                                                                                                                                                                          47&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-radosgw-12.2.12-0.el7.x86_64                                                                                                                                                                                     48&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-mds-12.2.12-0.el7.x86_64                                                                                                                                                                                         49&#x2F;53 </span><br><span class="line">  Verifying  : 2:librgw2-12.2.12-0.el7.x86_64                                                                                                                                                                                          50&#x2F;53 </span><br><span class="line">  Verifying  : 2:ceph-selinux-12.2.12-0.el7.x86_64                                                                                                                                                                                     51&#x2F;53 </span><br><span class="line">  Verifying  : 2:python-rgw-12.2.12-0.el7.x86_64                                                                                                                                                                                       52&#x2F;53 </span><br><span class="line">  Verifying  : 2:librados2-12.2.12-0.el7.x86_64                                                                                                                                                                                        53&#x2F;53 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  ceph.x86_64 2:14.2.4-0.el7                                                                                                                                                                                                                 </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  libconfig.x86_64 0:1.4.9-5.el7                   liboath.x86_64 0:2.6.2-1.el7                           librabbitmq.x86_64 0:0.8.0-2.el7                 librdmacm.x86_64 0:22.1-3.el7          libstoragemgmt.x86_64 0:1.7.3-3.el7      </span><br><span class="line">  libstoragemgmt-python.noarch 0:1.7.3-3.el7       libstoragemgmt-python-clibs.x86_64 0:1.7.3-3.el7       python-ceph-argparse.x86_64 2:14.2.4-0.el7       python-cffi.x86_64 0:1.6.0-5.el7       python-ply.noarch 0:3.4-11.el7           </span><br><span class="line">  python-pycparser.noarch 0:2.14-1.el7             python2-bcrypt.x86_64 0:3.1.6-2.el7                    python2-six.noarch 0:1.9.0-0.el7                 yajl.x86_64 0:2.0.4-4.el7             </span><br><span class="line"></span><br><span class="line">Dependency Updated:</span><br><span class="line">  ceph-base.x86_64 2:14.2.4-0.el7                   ceph-common.x86_64 2:14.2.4-0.el7   ceph-mds.x86_64 2:14.2.4-0.el7     ceph-mgr.x86_64 2:14.2.4-0.el7   ceph-mon.x86_64 2:14.2.4-0.el7         ceph-osd.x86_64 2:14.2.4-0.el7          </span><br><span class="line">  ceph-radosgw.x86_64 2:14.2.4-0.el7                ceph-selinux.x86_64 2:14.2.4-0.el7  libcephfs2.x86_64 2:14.2.4-0.el7   librados2.x86_64 2:14.2.4-0.el7  libradosstriper1.x86_64 2:14.2.4-0.el7 librbd1.x86_64 2:14.2.4-0.el7           </span><br><span class="line">  librgw2.x86_64 2:14.2.4-0.el7                     python-cephfs.x86_64 2:14.2.4-0.el7 python-rados.x86_64 2:14.2.4-0.el7 python-rbd.x86_64 2:14.2.4-0.el7 python-rgw.x86_64 2:14.2.4-0.el7       selinux-policy.noarch 0:3.13.1-252.el7.1</span><br><span class="line">  selinux-policy-targeted.noarch 0:3.13.1-252.el7.1</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<p>5、检查更新后的rpm packages</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# rpm -qa | grep ceph</span><br><span class="line">python-ceph-argparse-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-mon-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-14.2.4-0.el7.x86_64</span><br><span class="line">libcephfs2-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-mds-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-osd-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-mgr-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-radosgw-14.2.4-0.el7.x86_64</span><br><span class="line">python-cephfs-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-selinux-14.2.4-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rbd</span><br><span class="line">librbd1-14.2.4-0.el7.x86_64</span><br><span class="line">python-rbd-14.2.4-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rados</span><br><span class="line">librados2-14.2.4-0.el7.x86_64</span><br><span class="line">libradosstriper1-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-radosgw-14.2.4-0.el7.x86_64</span><br><span class="line">python-rados-14.2.4-0.el7.x86_64</span><br></pre></td></tr></table></figure>
<p>6、重启服务每台ceph节点的ceph service并检查service状态</p>
<p>重启顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、Ceph Monitors</span><br><span class="line">2、Ceph Mgr</span><br><span class="line">3、Ceph OSD Daemons</span><br><span class="line">4、Ceph Metadata Servers</span><br><span class="line">5、Ceph Object Gateways</span><br></pre></td></tr></table></figure>
<p>重启命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># 重启Ceph Monitors</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-mon@ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph mon stat</span><br><span class="line">e1: 3 mons at &#123;ceph1&#x3D;10.20.10.8:6789&#x2F;0,ceph2&#x3D;10.20.10.21:6789&#x2F;0,ceph3&#x3D;10.20.10.15:6789&#x2F;0&#125;, election epoch 6, leader 0 ceph1, quorum 0,1,2 ceph1,ceph3,ceph2</span><br><span class="line"></span><br><span class="line"># 重启Ceph Mgr</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-mgr@ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            insufficient standby MDS daemons available</span><br><span class="line">            noout flag(s) set</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph1(active), standbys: ceph3, ceph2</span><br><span class="line">    mds: cephfs-1&#x2F;1&#x2F;1 up  &#123;0&#x3D;ceph2&#x3D;up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 2 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.30KiB</span><br><span class="line">    usage:   6.05GiB used, 293GiB &#x2F; 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br><span class="line"></span><br><span class="line"># 重启Ceph OSD Daemons</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-osd@2.service &amp;&amp; systemctl restart ceph-osd@5.service &amp;&amp; ceph osd stat</span><br><span class="line">6 osds: 5 up, 6 in</span><br><span class="line">[root@ceph2 ~]# ceph osd stat</span><br><span class="line">6 osds: 6 up, 6 in</span><br><span class="line"></span><br><span class="line"># 重启Ceph Metadata Servers</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-mds@ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph mds stat</span><br><span class="line">cephfs-1&#x2F;1&#x2F;1 up  &#123;0&#x3D;ceph2&#x3D;up:reconnect&#125;, 1 up:standby</span><br><span class="line">[root@ceph2 ~]# ceph mds stat</span><br><span class="line">cephfs-1&#x2F;1&#x2F;1 up  &#123;0&#x3D;ceph2&#x3D;up:active&#125;, 1 up:standby</span><br><span class="line"></span><br><span class="line"># 重启Ceph Object Gateways</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-radosgw@rgw.ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            insufficient standby MDS daemons available</span><br><span class="line">            noout flag(s) set</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph1(active), standbys: ceph3, ceph2</span><br><span class="line">    mds: cephfs-1&#x2F;1&#x2F;1 up  &#123;0&#x3D;ceph2&#x3D;up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 2 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.30KiB</span><br><span class="line">    usage:   6.05GiB used, 293GiB &#x2F; 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br></pre></td></tr></table></figure>
<p><code>注意</code>：当集群升级过程中，刚刚升级第一个MDS会出现<code>insufficient standby MDS daemons available</code>，当升级第二个MDS后，警告会自动消失。</p>
<p>7、警告解除<code>Legacy BlueStore stats reporting detected on 6 OSD(s)</code></p>
<p>首先确认集群状态，无其他异常告警，并修复。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            noout flag(s) set</span><br><span class="line">            Legacy BlueStore stats reporting detected on 6 OSD(s)</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2 (age 111s)</span><br><span class="line">    mgr: ceph2(active, since 6h), standbys: ceph3, ceph1</span><br><span class="line">    mds: cephfs:1 &#123;0&#x3D;ceph2&#x3D;up:active&#125; 2 up:standby</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 3 daemons active (ceph1, ceph2, ceph3)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.8 KiB</span><br><span class="line">    usage:   6.1 GiB used, 293 GiB &#x2F; 299 GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br><span class="line"></span><br><span class="line">[root@ceph1 ~]# systemctl stop ceph-osd@1.service</span><br><span class="line">[root@ceph1 ~]# ceph-bluestore-tool repair --path &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-1&#x2F;</span><br><span class="line">repair success</span><br><span class="line">[root@ceph1 ~]# systemctl start ceph-osd@1.service</span><br></pre></td></tr></table></figure>
<p><code>当前出现问题：https://tracker.ceph.com/issues/42297，正在与社区沟通</code></p>
<p>相关ceph users</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;lists.ceph.com&#x2F;pipermail&#x2F;ceph-users-ceph.com&#x2F;2019-July&#x2F;035889.html</span><br><span class="line">http:&#x2F;&#x2F;lists.ceph.com&#x2F;pipermail&#x2F;ceph-users-ceph.com&#x2F;2019-July&#x2F;036010.html</span><br><span class="line">http:&#x2F;&#x2F;lists.ceph.com&#x2F;pipermail&#x2F;ceph-users-ceph.com&#x2F;2019-July&#x2F;036002.html</span><br></pre></td></tr></table></figure>
<p>8、告警解除<code>3 monitors have not enabled msgr2</code>（nautilus版本中mon需要打开v2，监听3300端口），关于msgr2参见<a target="_blank" rel="noopener" href="http://lnsyyj.github.io/2019/10/14/Ceph-MESSENGER-V2/">http://lnsyyj.github.io/2019/10/14/Ceph-MESSENGER-V2/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 ~]# ceph mon enable-msgr2</span><br></pre></td></tr></table></figure>
<p>9、解除noout标志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph osd unset noout</span><br></pre></td></tr></table></figure>
<p>10、确认ceph状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2 (age 30m)</span><br><span class="line">    mgr: ceph2(active, since 7h), standbys: ceph3, ceph1</span><br><span class="line">    mds: cephfs:1 &#123;0&#x3D;ceph2&#x3D;up:active&#125; 2 up:standby</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">    rgw: 3 daemons active (ceph1, ceph2, ceph3)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.8 KiB</span><br><span class="line">    usage:   6.1 GiB used, 293 GiB &#x2F; 299 GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br></pre></td></tr></table></figure>
<h2 id="升级Ceph客户端package"><a href="#升级Ceph客户端package" class="headerlink" title="升级Ceph客户端package"></a>升级Ceph客户端package</h2><h3 id="升级可能带来的影响-1"><a href="#升级可能带来的影响-1" class="headerlink" title="升级可能带来的影响"></a>升级可能带来的影响</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（1）客户端升级可能会影响客户业务，导致业务中断一定时间。</span><br><span class="line">（2）可能带来客户端程序不兼容ceph client package的情况。</span><br></pre></td></tr></table></figure>
<p>1、升级package</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 ~]# yum install ceph-common librados2 librbd1 python-rbd python-rados -y</span><br></pre></td></tr></table></figure>
<p>2、确认升级后的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph --version</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/08/CEPH-ISCSI-GATEWAY/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/08/CEPH-ISCSI-GATEWAY/" class="post-title-link" itemprop="url">CEPH ISCSI GATEWAY</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-08 15:14:50" itemprop="dateCreated datePublished" datetime="2019-10-08T15:14:50+08:00">2019-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:35" itemprop="dateModified" datetime="2020-03-22T16:16:35+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>iSCSI gateway将Ceph Storage与iSCSI标准集成在一起，将RADOS Block Device（RBD）images导出为SCSI disks高可用（HA）iSCSI target。iSCSI协议允许客户端（initiators）通过TCP / IP网络将SCSI命令发送到SCSI storage devices（targets）。这允许异构客户端（例如Microsoft Windows）访问Ceph存储群集。</p>
<p>每个iSCSI gateway都运行Linux IO target kernel subsystem（LIO）以提供iSCSI协议支持。LIO利用userspace直通（TCMU）Ceph的librbd库进行交互，并将RBD images公开给iSCSI客户端。借助Ceph的iSCSI gateway，您可以有效地运行完整的block-storage infrastructure，并具有传统Storage Area Network （SAN） 的所有功能和优势。</p>
<p><img src="https://docs.ceph.com/docs/master/_images/ditaa-176c606a1d1a5b7415ee811bd62dda640513a33a.png"></p>
<h1 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h1><p>要实现Ceph iSCSI gateway，有一些要求。对于高可用的Ceph iSCSI gateway解决方案，建议使用2到4个iSCSI gateway节点。</p>
<p>有关硬件建议，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/start/hardware-recommendations/">Hardware Recommendation page</a>获取更多详细信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意 在iSCSI gateway节点上，RBD images的内存占用量可能会增大。根据映射(mapped)的RBD images的数量，相应地计划内存需求。</span><br></pre></td></tr></table></figure>
<p>Ceph Monitors或OSD没有特定的iSCSI gateway选项，但是降低默认timers以检测OSD至关重要，它可以降低initiator超时的可能性，这一点很重要。建议为存储集群中的每个OSD节点使用以下配置选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[osd]</span><br><span class="line">osd heartbeat grace &#x3D; 20</span><br><span class="line">osd heartbeat interval &#x3D; 5</span><br></pre></td></tr></table></figure>
<ul>
<li>Ceph Monitor的在线更新</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ceph tell &lt;daemon_type&gt;.&lt;id&gt; config set &lt;parameter_name&gt; &lt;new_value&gt;</span><br><span class="line"></span><br><span class="line">ceph tell osd.0 config set osd_heartbeat_grace 20</span><br><span class="line">ceph tell osd.0 config set osd_heartbeat_interval 5</span><br></pre></td></tr></table></figure>
<ul>
<li>OSD节点的在线更新</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ceph daemon &lt;daemon_type&gt;.&lt;id&gt; config set osd_client_watch_timeout 15</span><br><span class="line"></span><br><span class="line">ceph daemon osd.0 config set osd_heartbeat_grace 20</span><br><span class="line">ceph daemon osd.0 config set osd_heartbeat_interval 5</span><br></pre></td></tr></table></figure>
<p>有关设置Ceph的配置选项的更多详细信息，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/configuration/">Configuration page</a>。</p>
<h1 id="Configuring-the-iSCSI-Target"><a href="#Configuring-the-iSCSI-Target" class="headerlink" title="Configuring the iSCSI Target"></a>Configuring the iSCSI Target</h1><p>传统上，对Ceph存储集群的块级访问仅限于QEMU和librbd，这是在OpenStack环境中采用的关键因素。从Ceph Luminous版本开始，块级访问正在扩展，以提供标准的iSCSI支持，从而允许更广泛的平台使用，并有可能打开新的用例。</p>
<ul>
<li>Red Hat Enterprise Linux/CentOS 7.5（或更高版本）；Linux内核v4.16（或更高版本）</li>
<li>使用ceph-ansible或使用command-line interface部署的有效Ceph Storage集群</li>
<li>iSCSI gateways nodes，可以与OSD nodes同一节点，也可以使用专用节点上</li>
<li>iSCSI front-end traffic和Ceph back-end traffic使用单独的网络</li>
</ul>
<p>安装和配置 Ceph iSCSI gateway的方法： </p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/mimic/rbd/iscsi-target-ansible/">Using Ansible</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/mimic/rbd/iscsi-target-cli/">Using the Command Line Interface</a></p>
</li>
</ul>
<h1 id="Configuring-the-iSCSI-Initiators"><a href="#Configuring-the-iSCSI-Initiators" class="headerlink" title="Configuring the iSCSI Initiators"></a>Configuring the iSCSI Initiators</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/mimic/rbd/iscsi-initiator-linux">iSCSI Initiator for Linux</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/mimic/rbd/iscsi-initiator-win">iSCSI Initiator for Microsoft Windows</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/mimic/rbd/iscsi-initiator-esx">iSCSI Initiator for VMware ESX</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">警告：通过多个iSCSI网关导出RBD image时，不支持使用SCSI persistent group reservations（PGR）和基于SCSI 2 reservations的应用程序。</span><br></pre></td></tr></table></figure>
<h1 id="Monitoring-the-iSCSI-Gateways"><a href="#Monitoring-the-iSCSI-Gateways" class="headerlink" title="Monitoring the iSCSI Gateways"></a>Monitoring the iSCSI Gateways</h1><p>Ceph为iSCSI gateway环境提供了一个附加工具，以监视导出的RADOS Block Device（RBD）images的性能。</p>
<p>该gwtop工具是一个类似top的工具，用于显示通过iSCSI导出到客户端的RBD images的聚合性能指标。这些指标来自Performance Metrics Domain Agent（PMDA）。来自Linux-IO target（LIO）PMDA的信息用于列出每个已导出的RBD images以及所连接的客户端及其关联的I / O指标。</p>
<p><strong>Requirements</strong></p>
<ul>
<li>正在运行的Ceph iSCSI gateway</li>
</ul>
<p><strong>Installing</strong></p>
<p>1、在每个iSCSI gateway节点安装ceph-iscsi-tools</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ceph-iscsi-tools</span><br></pre></td></tr></table></figure>
<p>2、在每个iSCSI gateway节点安装performance co-pilot</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install pcp</span><br></pre></td></tr></table></figure>
<p>3、在每个iSCSI gateway节点安装LIO PMDA</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install pcp-pmda-lio</span><br></pre></td></tr></table></figure>
<p>4、在每个iSCSI gateway节点enable并start performance co-pilot service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable pmcd</span><br><span class="line"># systemctl start pmcd</span><br></pre></td></tr></table></figure>
<p>5、注册pcp-pmda-lio agent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;lib&#x2F;pcp&#x2F;pmdas&#x2F;lio</span><br><span class="line">.&#x2F;Install</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>gwtop</code>假定iSCSI gateway configuration object被存储在rbd pool被叫做gateway.conf的RADOS object中。此configuration定义了需要收集性能信息的iSCSI gateways。可以使用<code>-g</code>或<code>-c</code>标志将其覆盖 。gwtop –help获取更多详细信息。</p>
<p>LIO configuration确定要从performance co-pilot提取性能统计信息的类型。当<code>gwtop</code>启动时，它着眼于LIO configuration，如果发现user-space的磁盘，然后<code>gwtop</code> 自动选择LIO收集器。</p>
<p><strong>Example gwtop Outputs</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gwtop  2&#x2F;2 Gateways   CPU% MIN:  4 MAX:  5    Network Total In:    2M  Out:    3M   10:20:00</span><br><span class="line">Capacity:   8G    Disks:   8   IOPS:  503   Clients:  1   Ceph: HEALTH_OK          OSDs:   3</span><br><span class="line">Pool.Image       Src    Size     iops     rMB&#x2F;s     wMB&#x2F;s   Client</span><br><span class="line">iscsi.t1703             500M        0      0.00      0.00</span><br><span class="line">iscsi.testme1           500M        0      0.00      0.00</span><br><span class="line">iscsi.testme2           500M        0      0.00      0.00</span><br><span class="line">iscsi.testme3           500M        0      0.00      0.00</span><br><span class="line">iscsi.testme5           500M        0      0.00      0.00</span><br><span class="line">rbd.myhost_1      T       4G      504      1.95      0.00   rh460p(CON)</span><br><span class="line">rbd.test_2                1G        0      0.00      0.00</span><br><span class="line">rbd.testme              500M        0      0.00      0.00</span><br></pre></td></tr></table></figure>
<p>在<em>Client</em> column，<code>(CON)</code>表示iSCSI initiator (client)当前已登录到iSCSI gateway。如果显示<code>-multi-</code>，则表示多个clients映射到单个RBD image。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/09/23/tgt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/23/tgt/" class="post-title-link" itemprop="url">tgt</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-23 23:53:01" itemprop="dateCreated datePublished" datetime="2019-09-23T23:53:01+08:00">2019-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安装编译依赖"><a href="#安装编译依赖" class="headerlink" title="安装编译依赖"></a>安装编译依赖</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc rpm-build libibverbs-devel librdmacm-devel libaio-devel docbook-style-xsl -y</span><br></pre></td></tr></table></figure>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@dev tgt]# tree scripts&#x2F;</span><br><span class="line">scripts&#x2F;</span><br><span class="line">├── build-pkg.sh	#build rpm或deb包</span><br><span class="line">├── checkarch.sh	#</span><br><span class="line">├── checkpatch.pl	#</span><br><span class="line">├── deb</span><br><span class="line">│   ├── changelog</span><br><span class="line">│   ├── compat</span><br><span class="line">│   ├── control</span><br><span class="line">│   ├── copyright</span><br><span class="line">│   ├── init</span><br><span class="line">│   ├── patches</span><br><span class="line">│   │   └── 0001-Use-local-docbook-for-generating-docs.patch</span><br><span class="line">│   ├── rules</span><br><span class="line">│   ├── source</span><br><span class="line">│   │   └── format</span><br><span class="line">│   └── tgt.bash-completion</span><br><span class="line">├── initd.sample</span><br><span class="line">├── Makefile</span><br><span class="line">├── tgt-admin</span><br><span class="line">├── tgt.bashcomp.sh</span><br><span class="line">├── tgt-core-test</span><br><span class="line">├── tgtd.service</span><br><span class="line">├── tgtd.spec</span><br><span class="line">└── tgt-setup-lun</span><br><span class="line"></span><br><span class="line">3 directories, 20 files</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/09/18/elastic-stack-logstash/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/18/elastic-stack-logstash/" class="post-title-link" itemprop="url">elastic stack - logstash</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-18 18:34:36" itemprop="dateCreated datePublished" datetime="2019-09-18T18:34:36+08:00">2019-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h1><p>Logstash是开源的服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到您最喜欢的“存储库”中。（我们的存储库是Elasticsearch）</p>
<p><img src="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png"></p>
<h2 id="Logstash部署安装"><a href="#Logstash部署安装" class="headerlink" title="Logstash部署安装"></a>Logstash部署安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 检查jdk环境，要就jdk1.8+</span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"># 解压安装包</span><br><span class="line">tar zxvf logstash-6.5.4.tar.gz</span><br><span class="line"></span><br><span class="line"># 第一个logstash示例</span><br><span class="line">bin&#x2F;logstash -e &#39;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123; &#125; &#125;&#39;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# &#x2F;usr&#x2F;share&#x2F;logstash&#x2F;bin&#x2F;logstash -e &#39;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123; &#125; &#125;&#39;</span><br><span class="line">hello</span><br><span class="line">&#123;</span><br><span class="line">       &quot;message&quot; &#x3D;&gt; &quot;hello&quot;,</span><br><span class="line">      &quot;@version&quot; &#x3D;&gt; &quot;1&quot;,</span><br><span class="line">    &quot;@timestamp&quot; &#x3D;&gt; 2019-09-19T02:29:59.833Z,</span><br><span class="line">          &quot;host&quot; &#x3D;&gt; &quot;dev&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Logstash的配置有三部分组成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">input &#123;	# 输入</span><br><span class="line">    stdin &#123; ... &#125; #标准输入</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123; # 过滤，对数据进行分割、截取等处理</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123; # 输出</span><br><span class="line">    stdout &#123; ... &#125; #标准输出</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>输入</p>
<p>采集各种样式、大小和来源的数据</p>
</li>
<li><p>过滤</p>
<p>实时解析和转换数据</p>
</li>
<li><p>输出</p>
<p>选择您的存储库，导出您的数据</p>
</li>
</ul>
<h2 id="读取自定义日志"><a href="#读取自定义日志" class="headerlink" title="读取自定义日志"></a>读取自定义日志</h2><p>如果是自定义结构的日志，这个时候就需要Logstash处理后才能使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># Logstash配置文件，规则定义</span><br><span class="line">[root@dev conf.d]# cat 99-test-yujiang.conf </span><br><span class="line">input &#123;</span><br><span class="line">    file &#123;</span><br><span class="line">        path &#x3D;&gt; &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;</span><br><span class="line">        start_position &#x3D;&gt; &quot;beginning&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">        split &#x3D;&gt; &#123; &quot;message&quot;&#x3D;&gt;&quot;|&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123; codec &#x3D;&gt; rubydebug&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动Logstash，等待自定义日志文件写入数据</span><br><span class="line">[root@dev conf.d]# &#x2F;usr&#x2F;share&#x2F;logstash&#x2F;bin&#x2F;logstash -f &#x2F;etc&#x2F;logstash&#x2F;conf.d&#x2F;99-test-yujiang.conf</span><br><span class="line">&#123;</span><br><span class="line">      &quot;@version&quot; &#x3D;&gt; &quot;1&quot;,</span><br><span class="line">       &quot;message&quot; &#x3D;&gt; [</span><br><span class="line">        [0] &quot;2019-09-19 11:20&quot;,</span><br><span class="line">        [1] &quot;ERROR&quot;,</span><br><span class="line">        [2] &quot;hello world&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;@timestamp&quot; &#x3D;&gt; 2019-09-19T03:20:21.116Z,</span><br><span class="line">          &quot;path&quot; &#x3D;&gt; &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,</span><br><span class="line">          &quot;host&quot; &#x3D;&gt; &quot;dev&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 向自定义日志文件中写入数据</span><br><span class="line">[root@dev log]# echo &quot;2019-09-19 11:20|ERROR|hello world&quot; &gt;&gt; yujiang.log </span><br></pre></td></tr></table></figure>
<p>将自定义日志写入Elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># Logstash配置文件，规则定义</span><br><span class="line">[root@dev conf.d]# cat 99-test-yujiang.conf</span><br><span class="line">input &#123;</span><br><span class="line">    file &#123;</span><br><span class="line">        path &#x3D;&gt; &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;</span><br><span class="line">        start_position &#x3D;&gt; &quot;beginning&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">        split &#x3D;&gt; &#123; &quot;message&quot;&#x3D;&gt;&quot;|&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts &#x3D;&gt; [ &quot;192.168.56.101:9200&quot; ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在Elasticsearch-head中查看</span><br><span class="line">&#123;</span><br><span class="line">	&quot;_index&quot;: &quot;logstash-2019.09.19&quot;,</span><br><span class="line">	&quot;_type&quot;: &quot;doc&quot;,</span><br><span class="line">	&quot;_id&quot;: &quot;ZNuTR20BQ8jxL59AtKFm&quot;,</span><br><span class="line">	&quot;_version&quot;: 1,</span><br><span class="line">	&quot;_score&quot;: 1,</span><br><span class="line">	&quot;_source&quot;: &#123;</span><br><span class="line">		&quot;message&quot;: [</span><br><span class="line">			&quot;2019-09-19 11:20&quot;,</span><br><span class="line">			&quot;ERROR&quot;,</span><br><span class="line">			&quot;hello world&quot;</span><br><span class="line">		],</span><br><span class="line">		&quot;@timestamp&quot;: &quot;2019-09-19T03:32:04.502Z&quot;,</span><br><span class="line">		&quot;@version&quot;: &quot;1&quot;,</span><br><span class="line">		&quot;path&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,</span><br><span class="line">		&quot;host&quot;: &quot;dev&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/09/17/elastic-stack-filebeat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/17/elastic-stack-filebeat/" class="post-title-link" itemprop="url">elastic stack - filebeat</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-17 15:28:40" itemprop="dateCreated datePublished" datetime="2019-09-17T15:28:40+08:00">2019-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ELK是Elasticsearch、Logstash、Kibana的简称，这三者是核心套件，并不是全部。一般用于集中搜集并展示日志。</p>
<h1 id="filebeat"><a href="#filebeat" class="headerlink" title="filebeat"></a>filebeat</h1><p>filebeat的主要作用是采集日志文件，是轻量级的日志采集器。部署filebeat非常简单，这里就不做介绍了。我们来看一下filebeat的配置与使用。</p>
<h2 id="简单配置及演示："><a href="#简单配置及演示：" class="headerlink" title="简单配置及演示："></a>简单配置及演示：</h2><p>​    这里我们先看一下filebeat.inputs类型为stdin，output.console方式。启动filebeat后，它会从标准输入接收数据，并以JSON格式打印在控制台中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat &#x2F;etc&#x2F;filebeat&#x2F;test_stdin.yml </span><br><span class="line">filebeat.inputs:       # filebeat输入配置</span><br><span class="line">  - type: stdin        # stdin表示标准输入</span><br><span class="line">    enabled: true      # 用于启用或禁用模块</span><br><span class="line">output.console:        # Console output</span><br><span class="line">  enabled: true        # 用于启用或禁用模块</span><br><span class="line">  codec.json:          # 配置JSON编码</span><br><span class="line">    pretty: true       # Pretty-print JSON event</span><br><span class="line">    escape_html: true  # 在字符串中配置转义HTML symbols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev filebeat]# filebeat -e -c test_stdin.yml</span><br><span class="line">hello yujiang # 在控制台输入</span><br><span class="line">&#123;</span><br><span class="line">  &quot;@timestamp&quot;: &quot;2019-09-17T09:01:00.251Z&quot;,</span><br><span class="line">  &quot;@metadata&quot;: &#123;				# 元数据</span><br><span class="line">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;doc&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;offset&quot;: 0,</span><br><span class="line">  &quot;log&quot;: &#123;</span><br><span class="line">    &quot;file&quot;: &#123;</span><br><span class="line">      &quot;path&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;prospector&quot;: &#123;				# 标准输入勘探器</span><br><span class="line">    &quot;type&quot;: &quot;stdin&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;input&quot;: &#123;					# 控制台标准输入</span><br><span class="line">    &quot;type&quot;: &quot;stdin&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;beat&quot;: &#123;						# beat版本以及hostname</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;hostname&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;host&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;message&quot;: &quot;hello yujiang&quot;,	# 输入的内容</span><br><span class="line">  &quot;source&quot;: &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="日志文件配置及演示"><a href="#日志文件配置及演示" class="headerlink" title="日志文件配置及演示"></a>日志文件配置及演示</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat test_log.yml </span><br><span class="line">filebeat.inputs:       # filebeat输入配置</span><br><span class="line">  - type: log          # log表示收集日志文件</span><br><span class="line">    enabled: true      # 用于启用或禁用模块</span><br><span class="line">    paths:             # 日志文件位置</span><br><span class="line">      - &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">output.console:        # Console output</span><br><span class="line">  enabled: true        # 用于启用或禁用模块</span><br><span class="line">  codec.json:          # 配置JSON编码</span><br><span class="line">    pretty: true       # Pretty-print JSON event</span><br><span class="line">    escape_html: true  # 在字符串中配置转义HTML symbols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动filebeat，这时开启另一个终端，向&#x2F;var&#x2F;log&#x2F;yujiang.log文件中写入hello world</span><br><span class="line">[root@dev filebeat]# filebeat -e -c .&#x2F;test_log.yml </span><br><span class="line">2019-09-17T05:27:25.513-0400	INFO	crawler&#x2F;crawler.go:106	Loading and starting Inputs completed. Enabled inputs: 1</span><br><span class="line">2019-09-17T05:28:55.525-0400	INFO	log&#x2F;harvester.go:255	Harvester started for file: &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">&#123;</span><br><span class="line">  &quot;@timestamp&quot;: &quot;2019-09-17T09:28:55.525Z&quot;,</span><br><span class="line">  &quot;@metadata&quot;: &#123;</span><br><span class="line">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;doc&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;beat&quot;: &#123;</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;hostname&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;host&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;offset&quot;: 0,</span><br><span class="line">  &quot;log&quot;: &#123;</span><br><span class="line">    &quot;file&quot;: &#123;</span><br><span class="line">      &quot;path&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;message&quot;: &quot;hello world&quot;,</span><br><span class="line">  &quot;source&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,</span><br><span class="line">  &quot;prospector&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;input&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 向&#x2F;var&#x2F;log&#x2F;yujiang.log文件中写入hello world</span><br><span class="line">[root@dev log]# echo &quot;hello world&quot; &gt;&gt; yujiang.log</span><br></pre></td></tr></table></figure>
<h2 id="自定义tags配置及演示"><a href="#自定义tags配置及演示" class="headerlink" title="自定义tags配置及演示"></a>自定义tags配置及演示</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat test_log_tags.yml </span><br><span class="line">filebeat.inputs:       # filebeat输入配置</span><br><span class="line">  - type: log          # log表示收集日志文件</span><br><span class="line">    enabled: true      # 用于启用或禁用模块</span><br><span class="line">    paths:             # 日志文件位置</span><br><span class="line">      - &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">    tags: [&quot;web&quot;, &quot;ceph&quot;]  # 自定义tags</span><br><span class="line">output.console:        # Console output</span><br><span class="line">  enabled: true        # 用于启用或禁用模块</span><br><span class="line">  codec.json:          # 配置JSON编码</span><br><span class="line">    pretty: true       # Pretty-print JSON event</span><br><span class="line">    escape_html: true  # 在字符串中配置转义HTML symbols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动filebeat，这时开启另一个终端，向&#x2F;var&#x2F;log&#x2F;yujiang.log文件中写入hello tags</span><br><span class="line">[root@dev filebeat]# filebeat -e -c .&#x2F;test_log_tags.yml </span><br><span class="line">&#123;</span><br><span class="line">  &quot;@timestamp&quot;: &quot;2019-09-17T09:55:43.909Z&quot;,</span><br><span class="line">  &quot;@metadata&quot;: &#123;</span><br><span class="line">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;doc&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;source&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,</span><br><span class="line">  &quot;offset&quot;: 12,</span><br><span class="line">  &quot;beat&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;hostname&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;message&quot;: &quot;hello tags&quot;,</span><br><span class="line">  &quot;log&quot;: &#123;</span><br><span class="line">    &quot;file&quot;: &#123;</span><br><span class="line">      &quot;path&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tags&quot;: [      # 自定义tags</span><br><span class="line">    &quot;web&quot;,</span><br><span class="line">    &quot;ceph&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;prospector&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;input&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;host&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 向&#x2F;var&#x2F;log&#x2F;yujiang.log文件中写入hello world</span><br><span class="line">[root@dev log]# echo &quot;hello tags&quot; &gt;&gt; yujiang.log</span><br></pre></td></tr></table></figure>
<h2 id="自定义字段配置及演示"><a href="#自定义字段配置及演示" class="headerlink" title="自定义字段配置及演示"></a>自定义字段配置及演示</h2><p>from添加到子节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat test_log_tags_fields.yml</span><br><span class="line">filebeat.inputs:       # filebeat输入配置</span><br><span class="line">  - type: log          # log表示收集日志文件</span><br><span class="line">    enabled: true      # 用于启用或禁用模块</span><br><span class="line">    paths:             # 日志文件位置</span><br><span class="line">      - &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">    tags: [&quot;web&quot;, &quot;ceph&quot;]  # 添加自定义tags</span><br><span class="line">    fields:            # 添加自定义字段</span><br><span class="line">      from: test-web-ceph</span><br><span class="line">output.console:        # Console output</span><br><span class="line">  enabled: true        # 用于启用或禁用模块</span><br><span class="line">  codec.json:          # 配置JSON编码</span><br><span class="line">    pretty: true       # Pretty-print JSON event</span><br><span class="line">    escape_html: true  # 在字符串中配置转义HTML symbols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev filebeat]# filebeat -e -c test_log_tags_fields.yml </span><br><span class="line">&#123;</span><br><span class="line">  &quot;@timestamp&quot;: &quot;2019-09-17T10:14:23.323Z&quot;,</span><br><span class="line">  &quot;@metadata&quot;: &#123;</span><br><span class="line">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;doc&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;source&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,</span><br><span class="line">  &quot;tags&quot;: [</span><br><span class="line">    &quot;web&quot;,</span><br><span class="line">    &quot;ceph&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;input&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;offset&quot;: 23,</span><br><span class="line">  &quot;message&quot;: &quot;hello tags fields&quot;,</span><br><span class="line">  &quot;prospector&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;beat&quot;: &#123;</span><br><span class="line">    &quot;hostname&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;host&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;log&quot;: &#123;</span><br><span class="line">    &quot;file&quot;: &#123;</span><br><span class="line">      &quot;path&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;fields&quot;: &#123;</span><br><span class="line">    &quot;from&quot;: &quot;test-web-ceph&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev log]# echo &quot;hello tags fields&quot; &gt;&gt; yujiang.log</span><br></pre></td></tr></table></figure>
<p>from添加到root节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat test_log_tags_fields.yml </span><br><span class="line">filebeat.inputs:       # filebeat输入配置</span><br><span class="line">  - type: log          # log表示收集日志文件</span><br><span class="line">    enabled: true      # 用于启用或禁用模块</span><br><span class="line">    paths:             # 日志文件位置</span><br><span class="line">      - &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">    tags: [&quot;web&quot;, &quot;ceph&quot;]  # 添加自定义tags</span><br><span class="line">    fields:            # 添加自定义字段</span><br><span class="line">      from: test-web-ceph</span><br><span class="line">    fields_under_root: true # true为添加到根节点，false为添加到子节点</span><br><span class="line">output.console:        # Console output</span><br><span class="line">  enabled: true        # 用于启用或禁用模块</span><br><span class="line">  codec.json:          # 配置JSON编码</span><br><span class="line">    pretty: true       # Pretty-print JSON event</span><br><span class="line">    escape_html: true  # 在字符串中配置转义HTML symbols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev filebeat]# filebeat -e -c test_log_tags_fields.yml</span><br><span class="line">&#123;</span><br><span class="line">  &quot;@timestamp&quot;: &quot;2019-09-17T10:25:29.414Z&quot;,</span><br><span class="line">  &quot;@metadata&quot;: &#123;</span><br><span class="line">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;doc&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;offset&quot;: 77,</span><br><span class="line">  &quot;tags&quot;: [</span><br><span class="line">    &quot;web&quot;,</span><br><span class="line">    &quot;ceph&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;prospector&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;input&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;log&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: &quot;test-web-ceph&quot;,    # from添加到root中</span><br><span class="line">  &quot;beat&quot;: &#123;</span><br><span class="line">    &quot;version&quot;: &quot;6.8.3&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;,</span><br><span class="line">    &quot;hostname&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;log&quot;: &#123;</span><br><span class="line">    &quot;file&quot;: &#123;</span><br><span class="line">      &quot;path&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;message&quot;: &quot;hello tags fields fields_under_root&quot;,</span><br><span class="line">  &quot;source&quot;: &quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,</span><br><span class="line">  &quot;host&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;dev&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev log]# echo &quot;hello tags fields fields_under_root&quot; &gt;&gt; yujiang.log</span><br></pre></td></tr></table></figure>
<h2 id="对接elasticsearch配置及演示"><a href="#对接elasticsearch配置及演示" class="headerlink" title="对接elasticsearch配置及演示"></a>对接elasticsearch配置及演示</h2><p>日志内容输出到elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat test_es.yml </span><br><span class="line">filebeat.inputs:       # filebeat输入配置</span><br><span class="line">  - type: log          # log表示收集日志文件</span><br><span class="line">    enabled: true      # 用于启用或禁用模块</span><br><span class="line">    paths:             # 日志文件位置</span><br><span class="line">      - &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">    tags: [&quot;web&quot;, &quot;ceph&quot;]  # 添加自定义tags</span><br><span class="line">    fields:            # 添加自定义字段</span><br><span class="line">      from: test-web-ceph</span><br><span class="line">    fields_under_root: true # true为添加到根节点，false为添加到子节点</span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 3 #索引的分区数</span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [&quot;192.168.56.101:9200&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev filebeat]# filebeat -e -c test_es.yml </span><br><span class="line">2019-09-17T23:10:34.272-0400	INFO	log&#x2F;harvester.go:255	Harvester started for file: &#x2F;var&#x2F;log&#x2F;yujiang.log</span><br><span class="line">2019-09-17T23:10:35.273-0400	INFO	pipeline&#x2F;output.go:95	Connecting to backoff(elasticsearch(http:&#x2F;&#x2F;192.168.56.101:9200))</span><br><span class="line">2019-09-17T23:10:35.279-0400	INFO	elasticsearch&#x2F;client.go:739	Attempting to connect to Elasticsearch version 6.8.3</span><br><span class="line">2019-09-17T23:10:35.379-0400	INFO	template&#x2F;load.go:128	Template already exists and will not be overwritten.</span><br><span class="line">2019-09-17T23:10:35.379-0400	INFO	instance&#x2F;beat.go:889	Template successfully loaded.</span><br><span class="line">2019-09-17T23:10:35.380-0400	INFO	pipeline&#x2F;output.go:105	Connection to backoff(elasticsearch(http:&#x2F;&#x2F;192.168.56.101:9200)) established</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dev log]# echo &quot;hello&quot; &gt; yujiang.log</span><br></pre></td></tr></table></figure>
<h2 id="Filebeat工作原理"><a href="#Filebeat工作原理" class="headerlink" title="Filebeat工作原理"></a>Filebeat工作原理</h2><p>Filebeat主要由两个组件组成：prospector和harvester。</p>
<ul>
<li><p>harvester</p>
<ul>
<li><p>负责读取单个文件的内容</p>
</li>
<li><p>如果文件在读取时被删除或重命名，Filebeat将继续读取文件</p>
</li>
</ul>
</li>
<li><p>prospector</p>
<ul>
<li><p>负责管理harvester并找到所有要读取的文件来源</p>
</li>
<li><p>如果输入类型为日志，则查找器将查找路径匹配的所有文件，并为每个文件启动一个harvester</p>
</li>
<li><p>Filebeat目前支持两种prospector类型：log和stdin</p>
</li>
</ul>
</li>
<li><p>Filebeat如何保持文件的状态</p>
<ul>
<li><p>Filebeat保存每个文件的状态并将状态刷新到磁盘上的注册文件中</p>
</li>
<li><p>该状态用于记住harvester正在读取的最后偏移量，并确保发送所有日志行</p>
</li>
<li><p>如果输出（例如Elasticsearch或Logstash）无法访问，Filebeat会跟踪最后发送的行，并在输出再次可用时继续读取文件</p>
</li>
<li><p>在Filebeat运行时，每个prospector内存中也会保存文件状态信息，当重新启动Filebeat时，将使用注册文件的数据来重建文件状态，Filebeat将每个harvester在从保存的最后偏移量继续读取</p>
</li>
<li><p>文件状态记录在data/registry文件中</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一般会保存在registry文件中，记录文件的偏移量</span><br><span class="line">[root@dev filebeat]# cat &#x2F;var&#x2F;lib&#x2F;filebeat&#x2F;registry </span><br><span class="line">[&#123;&quot;source&quot;:&quot;&#x2F;var&#x2F;log&#x2F;boot.log&quot;,&quot;offset&quot;:0,&quot;timestamp&quot;:&quot;2019-09-17T21:50:45.201469161-04:00&quot;,&quot;ttl&quot;:-2,&quot;type&quot;:&quot;log&quot;,&quot;meta&quot;:null,&quot;FileStateOS&quot;:&#123;&quot;inode&quot;:134315203,&quot;device&quot;:64768&#125;&#125;,&#123;&quot;source&quot;:&quot;&#x2F;var&#x2F;log&#x2F;yum.log&quot;,&quot;offset&quot;:9899,&quot;timestamp&quot;:&quot;2019-09-17T21:50:45.160502101-04:00&quot;,&quot;ttl&quot;:-2,&quot;type&quot;:&quot;log&quot;,&quot;meta&quot;:null,&quot;FileStateOS&quot;:&#123;&quot;inode&quot;:134315217,&quot;device&quot;:64768&#125;&#125;,&#123;&quot;source&quot;:&quot;&#x2F;var&#x2F;log&#x2F;yujiang.log&quot;,&quot;offset&quot;:12,&quot;timestamp&quot;:&quot;2019-09-17T23:15:39.385983011-04:00&quot;,&quot;ttl&quot;:-1,&quot;type&quot;:&quot;log&quot;,&quot;meta&quot;:null,&quot;FileStateOS&quot;:&#123;&quot;inode&quot;:134836485,&quot;device&quot;:64768&#125;&#125;]</span><br></pre></td></tr></table></figure>
<h2 id="启动参数说明"><a href="#启动参数说明" class="headerlink" title="启动参数说明"></a>启动参数说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# filebeat -e -c test_es.yml -d &quot;publish&quot;</span><br><span class="line">-e	输出到标准输出，默认输出到syslog和logs下</span><br><span class="line">-c	指定配置文件</span><br><span class="line">-d	输出debug信息</span><br></pre></td></tr></table></figure>
<h2 id="Filebeat-Module"><a href="#Filebeat-Module" class="headerlink" title="Filebeat Module"></a>Filebeat Module</h2><p>Filebeat中，有大量的Module，可以简化我们的配置，可直接使用。在filebeat.yml中必须配置<code>filebeat.config.modules.path</code>目录，否则会报错<code>Error in modules manager: modules management requires &#39;filebeat.config.modules.path&#39; setting</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# cat &#x2F;etc&#x2F;filebeat&#x2F;filebeat.yml </span><br><span class="line"># ......</span><br><span class="line">filebeat.config:</span><br><span class="line">  modules:</span><br><span class="line">    enabled: true</span><br><span class="line">    path: &#x2F;etc&#x2F;filebeat&#x2F;modules.d&#x2F;*.yml</span><br><span class="line">    reload.enabled: true</span><br><span class="line">    reload.period: 10s</span><br><span class="line"># ......</span><br></pre></td></tr></table></figure>
<p>查看模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@dev filebeat]# filebeat modules list</span><br><span class="line">Enabled:</span><br><span class="line">system</span><br><span class="line"></span><br><span class="line">Disabled:</span><br><span class="line">apache2</span><br><span class="line">auditd</span><br><span class="line">elasticsearch</span><br><span class="line">haproxy</span><br><span class="line">icinga</span><br><span class="line">iis</span><br><span class="line">iptables</span><br><span class="line">kafka</span><br><span class="line">kibana</span><br><span class="line">logstash</span><br><span class="line">mongodb</span><br><span class="line">mysql</span><br><span class="line">nginx</span><br><span class="line">osquery</span><br><span class="line">postgresql</span><br><span class="line">redis</span><br><span class="line">suricata</span><br><span class="line">system</span><br><span class="line">traefik</span><br></pre></td></tr></table></figure>
<p>配置filebeat.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">filebeat:</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">    elasticsearch:</span><br><span class="line">      hosts: [&quot;localhost:9200&quot;]</span><br><span class="line"></span><br><span class="line">filebeat.config:</span><br><span class="line">  modules:</span><br><span class="line">    enabled: true</span><br><span class="line">    path: &#x2F;etc&#x2F;filebeat&#x2F;modules.d&#x2F;*.yml</span><br><span class="line">    reload.enabled: true</span><br><span class="line">    reload.period: 10s</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/09/04/Centos-7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8-Centos-7-upgrade-kernel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/04/Centos-7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8-Centos-7-upgrade-kernel/" class="post-title-link" itemprop="url">Centos 7 升级内核(Centos 7 upgrade kernel)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-04 15:23:20" itemprop="dateCreated datePublished" datetime="2019-09-04T15:23:20+08:00">2019-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:35" itemprop="dateModified" datetime="2020-03-22T16:16:35+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1、查看当前版本kernel (Show current version of kernel)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# uname -r</span><br><span class="line">3.10.0-957.el7.x86_64</span><br></pre></td></tr></table></figure>
<p>2、导入公钥 (Import the public key)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# rpm --import https:&#x2F;&#x2F;www.elrepo.org&#x2F;RPM-GPG-KEY-elrepo.org</span><br></pre></td></tr></table></figure>
<p>3、为CentOS-7安装ELRepo (install ELRepo for CentOS-7)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# yum install -y https:&#x2F;&#x2F;www.elrepo.org&#x2F;elrepo-release-7.0-4.el7.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>4、安装yum-plugin-fastestmirror (Install yum-plugin-fastestmirror)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# yum install -y yum-plugin-fastestmirror</span><br></pre></td></tr></table></figure>
<p>5、查看可以安装的kernel (Show the kernel that can be installed)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# yum --enablerepo&#x3D;elrepo-kernel provides kernel</span><br></pre></td></tr></table></figure>
<p>6、安装最新kernel，或安装执行版本的kernel (Install the latest kernel, or install the executable version of the kernel)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# yum --enablerepo&#x3D;elrepo-kernel install kernel-ml</span><br><span class="line">or</span><br><span class="line">[root@dev ~]# yum --enablerepo&#x3D;elrepo-kernel install kernel-lt-4.4.190-1.el7.elrepo.x86_64</span><br></pre></td></tr></table></figure>
<p>7、设置默认的启动内核 (Set the default boot kernel)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# cat &#x2F;boot&#x2F;grub2&#x2F;grub.cfg | grep &quot;CentOS Linux&quot;</span><br><span class="line">menuentry &#39;CentOS Linux (4.4.190-1.el7.elrepo.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-a66de569-ad95-4599-9f1e-37c19744ace0&#39; &#123;</span><br><span class="line">menuentry &#39;CentOS Linux (3.10.0-957.21.3.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-a66de569-ad95-4599-9f1e-37c19744ace0&#39; &#123;</span><br><span class="line">menuentry &#39;CentOS Linux (3.10.0-862.3.2.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-a66de569-ad95-4599-9f1e-37c19744ace0&#39; &#123;</span><br><span class="line">menuentry &#39;CentOS Linux (3.10.0-862.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-a66de569-ad95-4599-9f1e-37c19744ace0&#39; &#123;</span><br><span class="line">menuentry &#39;CentOS Linux (0-rescue-167a8b301e76475680ccb38e7d691aab) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-0-rescue-167a8b301e76475680ccb38e7d691aab-advanced-a66de569-ad95-4599-9f1e-37c19744ace0&#39; &#123;</span><br><span class="line"></span><br><span class="line">[root@dev ~]# grub2-set-default &quot;CentOS Linux (4.4.190-1.el7.elrepo.x86_64) 7 (Core)&quot;</span><br><span class="line"></span><br><span class="line">[root@dev ~]# grub2-editenv list</span><br><span class="line">saved_entry&#x3D;CentOS Linux (4.4.190-1.el7.elrepo.x86_64) 7 (Core)</span><br></pre></td></tr></table></figure>
<p>8、重启机器 (Restart the machine)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# reboot</span><br></pre></td></tr></table></figure>
<p>9、重启后验证是否成功 (Verify successful after reboot)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# uname -r</span><br><span class="line">4.4.190-1.el7.elrepo.x86_64</span><br></pre></td></tr></table></figure>
<p>10、删除老kernel，–count flag用于指定要在系统上保留的内核数 (Delete the old kernel, the –count flag is used to specify the number of cores to keep on the system)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">[root@dev ~]# package-cleanup --oldkernels --count&#x3D;2</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/28/LinuxCast-Linux%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/28/LinuxCast-Linux%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">[LinuxCast]Linux网络基础配置 - 笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-28 10:54:52" itemprop="dateCreated datePublished" datetime="2019-08-28T10:54:52+08:00">2019-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="以太网连接"><a href="#以太网连接" class="headerlink" title="以太网连接"></a>以太网连接</h1><ul>
<li><p>在Linux中，以太网接口被命名为：eth0、eth1等，0、1代表网卡编号。</p>
</li>
<li><p>通过lspci命令可以查看网卡硬件信息（如果是usb网卡，则可能需要使用lsusb命令）</p>
</li>
<li><p>命令ifconfig命令用来查看接口信息</p>
<p><code>ifconfig -a</code>         查看所有接口</p>
<p><code>ifconfig eth0</code>    查看特定接口</p>
</li>
<li><p>命令ifup、ifdown用来启用、禁用一个接口</p>
<p><code>ifup eth0</code></p>
<p><code>ifdown eht0</code></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@aio1 ~]# ifconfig ens33</span><br><span class="line">ens33: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9000</span><br><span class="line">        inet 192.168.46.200  netmask 255.255.255.0  broadcast 192.168.46.255</span><br><span class="line">        inet6 fe80::b3f5:7411:df98:1d00  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:1d:7b:de  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 16673  bytes 23150661 (22.0 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2645  bytes 223690 (218.4 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">RX packets 接收包数量</span><br><span class="line">TX packets 发送包数量</span><br></pre></td></tr></table></figure>
<h1 id="网络相关配置文件"><a href="#网络相关配置文件" class="headerlink" title="网络相关配置文件"></a>网络相关配置文件</h1><ul>
<li><p>网卡配置文件</p>
<p>/etc/sysconfig/network-scripts/ifcfg-ens8f0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE&#x3D;Ethernet									# 类型&#x3D;以太网</span><br><span class="line">PROXY_METHOD&#x3D;none								# </span><br><span class="line">BROWSER_ONLY&#x3D;no									# </span><br><span class="line">BOOTPROTO&#x3D;none									# 启动协议</span><br><span class="line">DEFROUTE&#x3D;yes									# </span><br><span class="line">IPV4_FAILURE_FATAL&#x3D;no							# </span><br><span class="line">IPV6INIT&#x3D;yes									# </span><br><span class="line">IPV6_AUTOCONF&#x3D;yes								# </span><br><span class="line">IPV6_DEFROUTE&#x3D;yes								# </span><br><span class="line">IPV6_FAILURE_FATAL&#x3D;no							# </span><br><span class="line">IPV6_ADDR_GEN_MODE&#x3D;stable-privacy				# </span><br><span class="line">NAME&#x3D;ens33										# </span><br><span class="line">UUID&#x3D;3434b388-c4db-4130-bf90-3e34115fe2d3		# UUID，统一标识符</span><br><span class="line">DEVICE&#x3D;ens33									# 设备名称</span><br><span class="line">ONBOOT&#x3D;yes										# 服务器启动时，自动启用</span><br><span class="line"></span><br><span class="line">IPADDR&#x3D;192.168.46.200							# IP地址</span><br><span class="line">NETMASK&#x3D;255.255.255.0							# 子网掩码</span><br><span class="line">GATEWAY&#x3D;192.168.46.2							# 网关</span><br><span class="line">DNS1&#x3D;192.168.46.2								# DNS</span><br></pre></td></tr></table></figure></li>
<li><p>DNS配置文件</p>
<p>/etc/resolv.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Generated by NetworkManager</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.46.2</span><br></pre></td></tr></table></figure></li>
<li><p>主机名配置文件</p>
<p>/etc/sysconfig/network</p>
</li>
<li><p>静态主机名配置文件</p>
<p>/etc/hosts</p>
</li>
</ul>
<h1 id="网络测试命令"><a href="#网络测试命令" class="headerlink" title="网络测试命令"></a>网络测试命令</h1><ul>
<li><p>测试网络连通性</p>
<p>ping 192.168.1.1</p>
<p>ping <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
</li>
<li><p>测试DNS解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bind-utils</span><br></pre></td></tr></table></figure>
<p>host <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">域名到IP地址的解析</span><br><span class="line">[root@dev ~]# host www.baidu.com</span><br><span class="line">www.baidu.com is an alias for www.a.shifen.com.</span><br><span class="line">www.a.shifen.com has address 61.135.169.125</span><br><span class="line">www.a.shifen.com has address 61.135.169.121</span><br></pre></td></tr></table></figure>
<p>dig <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
</li>
<li><p>显示路由表</p>
<p>ip route</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@aio1 ~]# ip route</span><br><span class="line">default via 192.168.46.2 dev ens33 proto static metric 100 #跟我不在一个网段的，发给default</span><br><span class="line">default via 192.168.46.2 dev ens34 proto static metric 101 </span><br><span class="line">default via 192.168.46.2 dev ens35 proto static metric 102 </span><br><span class="line">default via 192.168.46.2 dev ens36 proto dhcp metric 103 </span><br><span class="line">172.29.232.0&#x2F;22 dev br-dbaas proto kernel scope link src 172.29.232.100 </span><br><span class="line">192.168.46.0&#x2F;24 dev ens33 proto kernel scope link src 192.168.46.200 metric 100 </span><br><span class="line">192.168.46.0&#x2F;24 dev ens36 proto kernel scope link src 192.168.46.137 metric 103 </span><br><span class="line">192.168.46.2 dev ens34 proto static scope link metric 101 </span><br><span class="line">192.168.46.2 dev ens35 proto static scope link metric 102 </span><br><span class="line">192.168.100.0&#x2F;24 dev ens34 proto kernel scope link src 192.168.100.200 metric 101 </span><br><span class="line">192.168.200.0&#x2F;24 dev ens35 proto kernel scope link src 192.168.200.200 metric 102 </span><br></pre></td></tr></table></figure></li>
<li><p>追踪到达目标地址的网络路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y traceroute</span><br></pre></td></tr></table></figure>
<p>traceroute <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
</li>
<li><p>使用mtr进行网络质量测试（结合了traceroute和ping）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mtr</span><br></pre></td></tr></table></figure>
<p>mtr <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
</li>
</ul>
<h1 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h1><ul>
<li><p>实时修改主机名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname train.linuxcast.net</span><br></pre></td></tr></table></figure></li>
<li><p>永久性修改主机名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class="line"></span><br><span class="line">HOSTNAME&#x3D;train.linuxcast.net</span><br></pre></td></tr></table></figure>
<h1 id="故障排查"><a href="#故障排查" class="headerlink" title="故障排查"></a>故障排查</h1></li>
</ul>
<p>网络故障排查遵循从底层到高层、从自身到外部的流程进行</p>
<ul>
<li><p>先查看网络配置信息是否正确</p>
<p>IP地址</p>
<p>子网掩码</p>
<p>网关</p>
<p>DNS</p>
</li>
<li><p>查看到达网关是否连通</p>
<p>ping 网关IP地址</p>
</li>
<li><p>查看DNS解析是否正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host www.baidu.com</span><br></pre></td></tr></table></figure></li>
<li><p>traceroute <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/20/git-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/20/git-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">git 常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-20 21:12:49" itemprop="dateCreated datePublished" datetime="2019-08-20T21:12:49+08:00">2019-08-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>视频地址：<a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UCPhn2rCqhu0HdktsFjixahA">https://www.youtube.com/channel/UCPhn2rCqhu0HdktsFjixahA</a></p>
<p>原文地址：<a target="_blank" rel="noopener" href="https://github.com/twtrubiks/Git-Tutorials">https://github.com/twtrubiks/Git-Tutorials</a></p>
<p>本文档只作为学习笔记，方便自己速查，如果想系统学习请看沈老师的视频和github。</p>
<h1 id="如何加速大型repo-clone速度"><a href="#如何加速大型repo-clone速度" class="headerlink" title="如何加速大型repo clone速度"></a>如何加速大型repo clone速度</h1><ul>
<li>–depth参数：只下载最新1次commits log，默认会加–single-branch（只clone单分支，无法checkout）。如果想clone所有分支需要加–no-single-branch（git clone <a target="_blank" rel="noopener" href="https://github.com/ceph/ceph.git">https://github.com/ceph/ceph.git</a> –depth 1 –no-single-branch），可以checkout。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMacBook-Pro-13:test yujiang$ git clone https:&#x2F;&#x2F;github.com&#x2F;ceph&#x2F;ceph.git --depth 1</span><br><span class="line">Cloning into &#39;ceph&#39;...</span><br><span class="line">remote: Enumerating objects: 8395, done.</span><br><span class="line">remote: Counting objects: 100% (8395&#x2F;8395), done.</span><br><span class="line">remote: Compressing objects: 100% (7508&#x2F;7508), done.</span><br><span class="line">remote: Total 8395 (delta 1133), reused 2722 (delta 467), pack-reused 0</span><br><span class="line">Receiving objects: 100% (8395&#x2F;8395), 21.01 MiB | 1.52 MiB&#x2F;s, done.</span><br><span class="line">Resolving deltas: 100% (1133&#x2F;1133), done.</span><br><span class="line">Checking out files: 100% (8847&#x2F;8847), done.</span><br><span class="line">yujiangdeMacBook-Pro-13:test yujiang$ cd ceph&#x2F;</span><br><span class="line">yujiangdeMacBook-Pro-13:ceph yujiang$ git log</span><br><span class="line">commit 6b0ef5dc3c550cd8d17c830156541dd491e9a57a (grafted, HEAD -&gt; master, origin&#x2F;master, origin&#x2F;HEAD)</span><br><span class="line">Author: Alfredo Deza &lt;adeza@redhat.com&gt;</span><br><span class="line">Date:   Tue Aug 20 09:32:05 2019 -0400</span><br><span class="line"></span><br><span class="line">    Merge pull request #29762 from alfredodeza&#x2F;bz-1738379</span><br><span class="line">    </span><br><span class="line">    ceph-volume: use the OSD identifier when reporting success</span><br><span class="line">    </span><br><span class="line">    Reviewed-by: Jan Fajerski &lt;jfajerski@suse.com&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="git-subtree"><a href="#git-subtree" class="headerlink" title="git subtree"></a>git subtree</h1><p>git submodule是link的概念</p>
<p>git subtree是copy的概念</p>
<p><a target="_blank" rel="noopener" href="https://github.com/git/git/blob/master/contrib/subtree/git-subtree.txt">https://github.com/git/git/blob/master/contrib/subtree/git-subtree.txt</a></p>
<h3 id="create-git-subtree"><a href="#create-git-subtree" class="headerlink" title="create git subtree"></a>create git subtree</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、首先clone主repo</span><br><span class="line">git clone --recurse-submodules -j8 git@github.com:lnsyyj&#x2F;lnsyyj-ansible.git</span><br><span class="line">2、进入主repo</span><br><span class="line">cd lnsyyj-ansible</span><br><span class="line">3、添加子repo</span><br><span class="line">git subtree add --prefix&#x3D;roles&#x2F;elasticsearch --squash git@github.com:lnsyyj&#x2F;ansible-role-elasticsearch.git master</span><br><span class="line">git subtree add --prefix&#x3D;roles&#x2F;kibana --squash git@github.com:lnsyyj&#x2F;ansible-role-kibana.git master</span><br><span class="line"></span><br><span class="line">git subtree add --prefix&#x3D;roles&#x2F;cloudalchemy.node-exporter --squash git@github.com:cloudalchemy&#x2F;ansible-node-exporter.git master</span><br><span class="line">git subtree add --prefix&#x3D;roles&#x2F;cloudalchemy.prometheus --squash git@github.com:cloudalchemy&#x2F;ansible-prometheus.git master</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--squash  合并子repo的git log</span><br><span class="line">--prefix&#x3D; 指定copy到主repo的位置</span><br></pre></td></tr></table></figure>
<h3 id="push-git-subtree"><a href="#push-git-subtree" class="headerlink" title="push git subtree"></a>push git subtree</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="pull-git-subtree"><a href="#pull-git-subtree" class="headerlink" title="pull git subtree"></a>pull git subtree</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="常见问题1"><a href="#常见问题1" class="headerlink" title="常见问题1"></a>常见问题1</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fatal: early EOF</span><br><span class="line">fatal: the remote end hung up unexpectedly</span><br><span class="line">fatal: index-pack failed</span><br><span class="line">error: RPC failed; curl 18 transfer closed with outstanding read data remaining</span><br><span class="line"></span><br><span class="line">解决办法：</span><br><span class="line">git config --global http.postBuffer 5242880000</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;ansible&#x2F;ansible.git</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/20/centos%E5%88%9B%E5%BB%BA%E5%86%85%E9%83%A8mirror/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/20/centos%E5%88%9B%E5%BB%BA%E5%86%85%E9%83%A8mirror/" class="post-title-link" itemprop="url">centos创建内部mirror</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-20 11:10:09" itemprop="dateCreated datePublished" datetime="2019-08-20T11:10:09+08:00">2019-08-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>公司内部搭建mirror的好处：可以节省大量时间、控制版本、节省公司外网带宽（尤其是国内很多公司基于开源软件搞定制化二次开发），同时也可以纳入发布流程当中。</p>
<p>yum可以通过FTP或HTTP传输文件，这里只实验HTTP方式。</p>
<h1 id="server端（搭建的mirror端）"><a href="#server端（搭建的mirror端）" class="headerlink" title="server端（搭建的mirror端）"></a>server端（搭建的mirror端）</h1><p>1、首先安装Nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y epel-release &amp;&amp; sudo yum install -y nginx </span><br></pre></td></tr></table></figure>
<p>2、安装createrepo工具（负责将.rpm放到repomd repository）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y createrepo yum-utils</span><br></pre></td></tr></table></figure>
<p>3、在本地创建目录，存储repositories</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;repos&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;&#123;SRPMS,aarch64,noarch,x86_64&#125;</span><br></pre></td></tr></table></figure>
<p>4、修改centos源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;yum.repos.d&#x2F;ceph_163.repo </span><br><span class="line"></span><br><span class="line"># $basearch is x86_64, can be modified</span><br><span class="line">[ceph]</span><br><span class="line">baseurl &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;$basearch</span><br><span class="line">gpgcheck &#x3D; 0</span><br><span class="line">gpgkey &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;keys&#x2F;release.asc</span><br><span class="line">name &#x3D; Ceph Stable $basearch repo</span><br><span class="line">priority &#x3D; 2</span><br><span class="line"></span><br><span class="line">[noarch]</span><br><span class="line">baseurl &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;noarch</span><br><span class="line">gpgcheck &#x3D; 0</span><br><span class="line">gpgkey &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;keys&#x2F;release.asc</span><br><span class="line">name &#x3D; Ceph Stable noarch repo</span><br><span class="line">priority &#x3D; 2</span><br></pre></td></tr></table></figure>
<p>5、导入GPG Key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;keys&#x2F;release.asc | gpg --import -</span><br></pre></td></tr></table></figure>
<p>6、下载官方repositories到本地服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo reposync -g -l -d -m --repoid&#x3D;ceph --newest-only --download-metadata --download_path&#x3D;&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;repos&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;x86_64&#x2F;</span><br><span class="line">sudo reposync -g -l -d -m --repoid&#x3D;noarch --newest-only --download-metadata --download_path&#x3D;&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;repos&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;noarch&#x2F;</span><br><span class="line"></span><br><span class="line">同步后，目录层级会不同，在download_path后面会自动加一层repoid指定的名字，需要自行调整。</span><br></pre></td></tr></table></figure>
<p>7、创建new repository</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo createrepo &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;repos&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;x86_64&#x2F;</span><br><span class="line">sudo createrepo &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;repos&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;noarch&#x2F;</span><br><span class="line"></span><br><span class="line">这时会在相应的目录中生成repodata</span><br></pre></td></tr></table></figure>
<p>8、修改Nginx配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">	# 修改</span><br><span class="line">	autoindex on;</span><br><span class="line">	root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;repos&#x2F;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">启动nginx</span><br><span class="line">systemctl start nginx &amp;&amp; systemctl enable nginx</span><br></pre></td></tr></table></figure>
<h1 id="client端（使用mirror端）"><a href="#client端（使用mirror端）" class="headerlink" title="client端（使用mirror端）"></a>client端（使用mirror端）</h1><p>在/etc/yum.repos.d/中增加新的源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]# cat &#x2F;etc&#x2F;yum.repos.d&#x2F;ceph_stable.repo </span><br><span class="line">[ceph_stable]</span><br><span class="line">baseurl &#x3D; http:&#x2F;&#x2F;10.121.9.103&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;$basearch</span><br><span class="line">gpgcheck &#x3D; 1</span><br><span class="line">gpgkey &#x3D; https:&#x2F;&#x2F;download.ceph.com&#x2F;keys&#x2F;release.asc</span><br><span class="line">name &#x3D; Ceph Stable $basearch repo</span><br><span class="line">priority &#x3D; 2</span><br><span class="line"></span><br><span class="line">[ceph_stable_noarch]</span><br><span class="line">baseurl &#x3D; http:&#x2F;&#x2F;10.121.9.103&#x2F;ceph&#x2F;rpm-nautilus&#x2F;el7&#x2F;noarch</span><br><span class="line">gpgcheck &#x3D; 1</span><br><span class="line">gpgkey &#x3D; https:&#x2F;&#x2F;download.ceph.com&#x2F;keys&#x2F;release.asc</span><br><span class="line">name &#x3D; Ceph Stable noarch repo</span><br><span class="line">priority &#x3D; 2</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/16/ceph%E7%A4%BE%E5%8C%BA%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8ceph-volume%E4%BB%A3%E6%9B%BFceph-disk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/16/ceph%E7%A4%BE%E5%8C%BA%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8ceph-volume%E4%BB%A3%E6%9B%BFceph-disk/" class="post-title-link" itemprop="url">ceph社区为什么要使用ceph-volume代替ceph-disk</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-16 16:35:15" itemprop="dateCreated datePublished" datetime="2019-08-16T16:35:15+08:00">2019-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/ceph-volume/intro/#ceph-disk-replaced">原文地址</a></p>
<h1 id="OVERVIEW"><a href="#OVERVIEW" class="headerlink" title="OVERVIEW"></a>OVERVIEW</h1><p>ceph-volume旨在成为一个单一用途的命令行工具，将logical volumes部署为OSDs，在preparing, activating, 和creating OSDs时，试图维护与ceph-disk类似的API。</p>
<p>因为它不依赖于为CEPH安装的UDEV规则且没有交互，因此它背离了ceph-disk。这些rules允许自动检测先前设置的devices，这些devices又被送入ceph-disk以activate它们。</p>
<h1 id="REPLACING-CEPH-DISK"><a href="#REPLACING-CEPH-DISK" class="headerlink" title="REPLACING CEPH-DISK"></a>REPLACING <code>CEPH-DISK</code></h1><p>ceph-disk工具是在项目需要支持许多不同类型的init系统（upstart, sysvinit, etc…）时创建的，同时能够发现devices。这导致工具最初（以及后来）专注于GPT分区上。特别是在GPT GUID上，它以独特的方式标记device，以回答以下问题：</p>
<ul>
<li>device是否是Journal？</li>
<li>是否是encrypted data partition（加密数据分区）？</li>
<li>device是否已部分准备就绪？</li>
</ul>
<p><code>为了解决这些问题，它使用UDEV规则来匹配GUID，这些GUID将调用ceph-disk，最后在ceph-disk systemd unit和ceph-disk可执行文件之间来回切换。该过程非常不可靠且耗时（必须为每个OSD设置接近3小时的超时），并且会导致OSD 在节点的boot过程中根本不出现。</code></p>
<p>考虑到UDEV的异步行为，很难调试甚至复现这些问题。</p>
<p>由于ceph-disk的world-view必须是专门的GPT分区，这意味着它无法与其他技术（如LVM或类似的device mapper devices）一起使用。它最终决定创建一些模块化的东西，从LVM支持开始，并根据需要扩展其他技术。</p>
<h1 id="GPT-PARTITIONS-ARE-SIMPLE"><a href="#GPT-PARTITIONS-ARE-SIMPLE" class="headerlink" title="GPT PARTITIONS ARE SIMPLE?"></a>GPT PARTITIONS ARE SIMPLE?</h1><p>尽管分区通常很容易理解，但ceph-disk分区并不简单。它需要大量特殊标志才能使它们与device discovery工作流程一起正常工作。以下是创建数据分区的示例调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sbin&#x2F;sgdisk --largest-new&#x3D;1 --change-name&#x3D;1:ceph data --partition-guid&#x3D;1:f0fc39fd-eeb2-49f1-b922-a11939cf8a0f --typecode&#x3D;1:89c57f98-2fe5-4dc0-89c1-f3ad0ceff2be --mbrtogpt -- &#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure>
<p>创建这些不仅很难，而且这些分区要求device由 Ceph 独占。例如，在某些情况下，在device加密时将创建一个特殊分区，其中包含未加密的密钥。这是ceph-disk领域的知识，它不会转变对”GPT partitions are simple”的理解。下面是正在创建的特殊分区的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sbin&#x2F;sgdisk --new&#x3D;5:0:+10M --change-name&#x3D;5:ceph lockbox --partition-guid&#x3D;5:None --typecode&#x3D;5:fb3aabf9-d25f-47cc-bf5e-721d181642be --mbrtogpt -- &#x2F;dev&#x2F;sdad</span><br></pre></td></tr></table></figure>
<h1 id="MODULARITY"><a href="#MODULARITY" class="headerlink" title="MODULARITY"></a>MODULARITY</h1><p>ceph-volume被设计成一个模块化工具，因为我们预计人们会使用多种方式来配置硬件设备。目前已有两个情况：传统的ceph-disk devices仍然在使用并且有GPT分区（handled by <a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/ceph-volume/simple/#ceph-volume-simple">simple</a>）和lvm。</p>
<p>我们直接从用户空间管理NVMe devices的SPDK devices即将出现，LVM将无法在那里工作，因为根本不涉及内核。</p>
<h1 id="CEPH-VOLUME-LVM"><a href="#CEPH-VOLUME-LVM" class="headerlink" title="CEPH-VOLUME LVM"></a>CEPH-VOLUME LVM</h1><p>通过使用<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/glossary/#term-lvm-tags">LVM tags</a>，<a target="_blank" rel="noopener" href="https://docs.ceph.com/docs/master/ceph-volume/lvm/#ceph-volume-lvm">lvm</a>子命令能够保存并随后重新发现和查询与OSD相关联的devices，以便可以激活（activate）它们。 这包括对基于LVM的技术（如dm-cache）的支持。</p>
<p>对于ceph-volume，dm-cache的使用是透明的，对于工具没有区别，它将dm-cache视为普通logical volume。</p>
<h1 id="LVM-PERFORMANCE-PENALTY"><a href="#LVM-PERFORMANCE-PENALTY" class="headerlink" title="LVM PERFORMANCE PENALTY"></a>LVM PERFORMANCE PENALTY</h1><p>简而言之：我们未能注意到与LVM更改相关的任何重大性能损失。 通过与LVM合作，可以使用其他device mapper技术（例如dmcache）：处理任何位于Logical Volume以下的事情没有技术困难。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">110</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
