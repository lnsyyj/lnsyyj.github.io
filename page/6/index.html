<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/12/16/docker-3-docker-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/16/docker-3-docker-network/" class="post-title-link" itemprop="url">docker-3 docker network</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-16 01:05:49" itemprop="dateCreated datePublished" datetime="2018-12-16T01:05:49+08:00">2018-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>学习视频地址：<a target="_blank" rel="noopener" href="https://coding.imooc.com/class/189.html">https://coding.imooc.com/class/189.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">单机</span><br><span class="line">	Bridge Network</span><br><span class="line">	Host Network</span><br><span class="line">	None </span><br><span class="line">多机</span><br><span class="line">	Overlay Network</span><br></pre></td></tr></table></figure>
<p>抓包工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.wireshark.org</span><br></pre></td></tr></table></figure>
<h1 id="Vagrant创建两台主机"><a href="#Vagrant创建两台主机" class="headerlink" title="Vagrant创建两台主机"></a>Vagrant创建两台主机</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:docker-network yujiang$ cat Vagrantfile </span><br><span class="line"># -*- mode: ruby -*-</span><br><span class="line"># vi: set ft&#x3D;ruby :</span><br><span class="line"></span><br><span class="line">Vagrant.require_version &quot;&gt;&#x3D; 1.6.0&quot;</span><br><span class="line">boxes &#x3D; [</span><br><span class="line">    &#123;</span><br><span class="line">        :name &#x3D;&gt; &quot;docker-node1&quot;,</span><br><span class="line">        :eth1 &#x3D;&gt; &quot;192.168.56.61&quot;,</span><br><span class="line">        :mem &#x3D;&gt; &quot;1024&quot;,</span><br><span class="line">        :cpu &#x3D;&gt; &quot;1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        :name &#x3D;&gt; &quot;docker-node2&quot;,</span><br><span class="line">        :eth1 &#x3D;&gt; &quot;192.168.56.62&quot;,</span><br><span class="line">        :mem &#x3D;&gt; &quot;1024&quot;,</span><br><span class="line">        :cpu &#x3D;&gt; &quot;1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Vagrant.configure(2) do |config|</span><br><span class="line">    config.vm.box &#x3D; &quot;centos&#x2F;centos7&quot;</span><br><span class="line">    boxes.each do |opts|</span><br><span class="line">        config.vm.define opts[:name] do |config|</span><br><span class="line">            config.vm.hostname &#x3D; opts[:name]</span><br><span class="line">            config.vm.provider &quot;vmware_fusion&quot; do |v|</span><br><span class="line">                v.vmx[&quot;memsize&quot;] &#x3D; opts[:mem]</span><br><span class="line">                v.vmx[&quot;numvcpus&quot;] &#x3D; opts[:cpu]</span><br><span class="line">            end</span><br><span class="line">    </span><br><span class="line">            config.vm.provider &quot;virtualbox&quot; do |v|</span><br><span class="line">                v.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, opts[:mem]]</span><br><span class="line">                v.customize [&quot;modifyvm&quot;, :id, &quot;--cpus&quot;, opts[:cpu]]</span><br><span class="line">            end</span><br><span class="line">            config.vm.network :private_network, ip:opts[:eth1]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class="line">        sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux docker-engine-selinux docker-engine</span><br><span class="line">        sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">        sudo yum-config-manager --add-repo https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">        sudo yum install docker-ce -y</span><br><span class="line">        sudo systemctl start docker</span><br><span class="line">        sudo systemctl enable docker</span><br><span class="line">        sudo groupadd docker</span><br><span class="line">        sudo gpasswd -a vagrant docker</span><br><span class="line">    SHELL</span><br><span class="line"></span><br><span class="line">	# 问题 mount: unnown filesystem type &#39;vboxsf&#39;</span><br><span class="line">    #config.vm.synced_folder &quot;.&#x2F;share&quot;, &quot;&#x2F;Users&#x2F;yujiang&#x2F;Vagrant&#x2F;docker-network&quot;</span><br><span class="line">    #config.vm.provision &quot;shell&quot;, privileged: true, path: &quot;.&#x2F;setup.sh&quot;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h1 id="linux-network-namespace"><a href="#linux-network-namespace" class="headerlink" title="linux network namespace"></a>linux network namespace</h1><p><a target="_blank" rel="noopener" href="http://cizixs.com/2017/02/10/network-virtualization-network-namespace/">http://cizixs.com/2017/02/10/network-virtualization-network-namespace/</a></p>
<p><a target="_blank" rel="noopener" href="https://tonybai.com/2017/01/11/understanding-linux-network-namespace-for-docker-network/">https://tonybai.com/2017/01/11/understanding-linux-network-namespace-for-docker-network/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker run -d --name test1 busybox &#x2F;bin&#x2F;sh -c &quot;while true;do sleep 3600; done&quot;</span><br><span class="line">[vagrant@docker-node1 ~]$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">f9a344634aab        busybox             &quot;&#x2F;bin&#x2F;sh -c &#39;while t…&quot;   11 seconds ago      Up 10 seconds                           test1</span><br></pre></td></tr></table></figure>
<p>查看宿主机的network namespace</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns list</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns add test1</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns add test2</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns list</span><br><span class="line">test2</span><br><span class="line">test1</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip link set dev lo up</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip link add veth-test1 type veth peer name veth-test2</span><br><span class="line">[vagrant@docker-node1 ~]$ ip link</span><br><span class="line">5: veth-test2@veth-test1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 96:92:53:64:58:17 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: veth-test1@veth-test2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 3e:20:9c:b8:9c:2b brd ff:ff:ff:ff:ff:ff</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip link set veth-test1 netns test1</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip link</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">6: veth-test1@if5: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 3e:20:9c:b8:9c:2b brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[vagrant@docker-node1 ~]$ ip link</span><br><span class="line">5: veth-test2@if6: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 96:92:53:64:58:17 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip link set veth-test2 netns test2</span><br><span class="line">[vagrant@docker-node1 ~]$ ip link</span><br><span class="line">5: veth-test2@if6也不见了</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test2 ip link</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">5: veth-test2@if6: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 96:92:53:64:58:17 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"></span><br><span class="line">分配IP地址</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip addr add 192.168.1.2&#x2F;24 dev veth-test1</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test2 ip addr add 192.168.1.3&#x2F;24 dev veth-test2</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip link set dev veth-test1 up</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test2 ip link set dev veth-test2 up</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">6: veth-test1@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link&#x2F;ether 3e:20:9c:b8:9c:2b brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet 192.168.1.2&#x2F;24 scope global veth-test1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::3c20:9cff:feb8:9c2b&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">5: veth-test2@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link&#x2F;ether 96:92:53:64:58:17 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.1.3&#x2F;24 scope global veth-test2</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::9492:53ff:fe64:5817&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">互ping</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test1 ping 192.168.1.3</span><br><span class="line">PING 192.168.1.3 (192.168.1.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.3: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.051 ms</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo ip netns exec test2 ping 192.168.1.2</span><br><span class="line">PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.2: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.035 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Bridge0"><a href="#Bridge0" class="headerlink" title="Bridge0"></a>Bridge0</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">36c9fe545daf        bridge              bridge              local</span><br><span class="line">39385556d8cd        host                host                local</span><br><span class="line">7828c2433efd        none                null                local</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect 36c9fe545daf</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;36c9fe545daf2ab0917fce9b1a8edee5ebdd4cb375b1083439212506f3fe179c&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-15T19:24:36.985544361Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123; # test1这个container连到了bridge这个网络</span><br><span class="line">            &quot;f6c6d9b55defc79cf5a39feff1dde1da336f3aa29e68a7577428aefab0196f6b&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;12a9fa5786c42c486e46bb058e44eb811f8d293ca4a89e1203df134c393d0254&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[vagrant@docker-node1 ~]$ ip a</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link&#x2F;ether 02:42:42:8b:4b:10 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1&#x2F;16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:42ff:fe8b:4b10&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">8: veth2657408@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link&#x2F;ether a2:0b:d6:4a:77:e5 brd ff:ff:ff:ff:ff:ff link-netnsid 2</span><br><span class="line">    inet6 fe80::a00b:d6ff:fe4a:77e5&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2&#x2F;16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">veth2657408负责连到docker0，test1 container中有一个接口，test1 container中的eth0与外面的veth2657408是一对。</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo yum install bridge-utils -y</span><br><span class="line">[vagrant@docker-node1 ~]$ brctl show</span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">docker0		8000.0242428b4b10	no		veth2657408</span><br><span class="line">同一台宿主机上的container是通过docker0相互通信的。docker0通过NAT来使container访问Internet。</span><br></pre></td></tr></table></figure>
<h2 id="自建Bridge"><a href="#自建Bridge" class="headerlink" title="自建Bridge"></a>自建Bridge</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker network create -d bridge my-bridge</span><br><span class="line">7cbd844d6e4cf262eba12277a3e8b4c475a1fb6aa73b9ea312d113d6c519284a</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">36c9fe545daf        bridge              bridge              local</span><br><span class="line">39385556d8cd        host                host                local</span><br><span class="line">7cbd844d6e4c        my-bridge           bridge              local</span><br><span class="line">7828c2433efd        none                null                local</span><br><span class="line">[vagrant@docker-node1 ~]$ brctl show</span><br><span class="line">bridge name			bridge id			STP enabled		interfaces</span><br><span class="line">br-7cbd844d6e4c		8000.02425dd71cb3	no				</span><br><span class="line">docker0				8000.0242428b4b10	no				veth2657408</span><br><span class="line">														veth7687c87</span><br><span class="line">[vagrant@docker-node1 ~]$ docker run -d --name test3 --network my-bridge busybox &#x2F;bin&#x2F;sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line">[vagrant@docker-node1 ~]$ brctl show</span><br><span class="line">bridge name			bridge id			STP enabled		interfaces</span><br><span class="line">br-7cbd844d6e4c		8000.02425dd71cb3	no				vetha530f6b</span><br><span class="line">docker0				8000.0242428b4b10	no				veth2657408</span><br><span class="line">														veth7687c87</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">36c9fe545daf        bridge              bridge              local</span><br><span class="line">39385556d8cd        host                host                local</span><br><span class="line">7cbd844d6e4c        my-bridge           bridge              local</span><br><span class="line">7828c2433efd        none                null                local</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect 7cbd844d6e4c</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;my-bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;7cbd844d6e4cf262eba12277a3e8b4c475a1fb6aa73b9ea312d113d6c519284a&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-16T13:17:25.765613424Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.18.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;5adef860247e056b8f8d2fab89892e10573daff5ea598482f53cefe3152700e0&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test3&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;19f5d575ad3ff8602c7342f036f024e88c4b97c33a68efa206bd810128b82ddc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.18.0.2&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">连接到test2上</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network connect my-bridge test2</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect 7cbd844d6e4c</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;my-bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;7cbd844d6e4cf262eba12277a3e8b4c475a1fb6aa73b9ea312d113d6c519284a&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-16T13:17:25.765613424Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.18.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;4b7db28e2a457ea6102fd8f06b512041e502dcf54c6d7c362fc5e39f7a0cdf23&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test2&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;cf4a07fff8a8684cd179ae747630ceeef32ebd38b2fb5eb9db4d2d35759970fb&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.18.0.3&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;5adef860247e056b8f8d2fab89892e10573daff5ea598482f53cefe3152700e0&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test3&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;19f5d575ad3ff8602c7342f036f024e88c4b97c33a68efa206bd810128b82ddc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.18.0.2&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">查看默认的bridge，都有test2，说明test2 Container及连到了默认的bridge又连到了my-bridge。</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">36c9fe545daf        bridge              bridge              local</span><br><span class="line">39385556d8cd        host                host                local</span><br><span class="line">7cbd844d6e4c        my-bridge           bridge              local</span><br><span class="line">7828c2433efd        none                null                local</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect 36c9fe545daf</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;36c9fe545daf2ab0917fce9b1a8edee5ebdd4cb375b1083439212506f3fe179c&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-15T19:24:36.985544361Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;4b7db28e2a457ea6102fd8f06b512041e502dcf54c6d7c362fc5e39f7a0cdf23&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test2&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;4ba2bbe1ee63a797b528e25533fd09dda8921cf5f688d4a5a24db4efed7410e2&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;f6c6d9b55defc79cf5a39feff1dde1da336f3aa29e68a7577428aefab0196f6b&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;12a9fa5786c42c486e46bb058e44eb811f8d293ca4a89e1203df134c393d0254&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.3&#x2F;16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">14: eth1@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.3&#x2F;16 brd 172.18.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec -it test3 &#x2F;bin&#x2F;sh</span><br><span class="line">&#x2F; # ping 172.18.0.3</span><br><span class="line">PING 172.18.0.3 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.727 ms</span><br><span class="line">&#x2F; # ping test2</span><br><span class="line">PING test2 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.058 ms</span><br><span class="line">Container连接到用户自己创建的bridge上，默认是link好的。所以使用Container name也能通。如果连接到docker0则不是。</span><br></pre></td></tr></table></figure>
<h1 id="Container之间link"><a href="#Container之间link" class="headerlink" title="Container之间link"></a>Container之间link</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker run -d --name test1 busybox &#x2F;bin&#x2F;sh -c &quot;while true;do sleep 3600; done&quot;</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo docker run -d --name test2 --link test1 busybox &#x2F;bin&#x2F;sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2&#x2F;16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.3&#x2F;16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec -it test2 &#x2F;bin&#x2F;sh</span><br><span class="line">&#x2F; # ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.419 ms</span><br><span class="line">&#x2F; # ping test1     (ping Container名字也是通的)</span><br><span class="line">PING test1 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.082 ms</span><br></pre></td></tr></table></figure>
<h1 id="docker-端口映射"><a href="#docker-端口映射" class="headerlink" title="docker 端口映射"></a>docker 端口映射</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx -d -p &lt;容器中端口&gt;:&lt;宿主机端口&gt; nginx</span><br><span class="line">[vagrant@docker-node1 ~]$ docker run --name nginx -d -p 80:80 nginx</span><br><span class="line">[vagrant@docker-node1 ~]$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES</span><br><span class="line">82d01fa9a547        nginx               &quot;nginx -g &#39;daemon of…&quot;   14 seconds ago      Up 13 seconds       0.0.0.0:80-&gt;80&#x2F;tcp   nginx</span><br><span class="line">[vagrant@docker-node1 ~]$ curl 127.0.0.1</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;&#x2F;title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;nginx.org&#x2F;&quot;&gt;nginx.org&lt;&#x2F;a&gt;.&lt;br&#x2F;&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;nginx.com&#x2F;&quot;&gt;nginx.com&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<h1 id="HOST与NONE网络"><a href="#HOST与NONE网络" class="headerlink" title="HOST与NONE网络"></a>HOST与NONE网络</h1><p>NONE，只能使用docker exec来访问Container。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker run -d --name test1 --network none busybox &#x2F;bin&#x2F;sh -c &quot;while true;do sleep 3600;done&quot;</span><br><span class="line">005cd306dc9e51a50a9bff5a2f2a9c54297c2dfe786443787d54df1d0a10e8bb</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect none</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;7828c2433efde412a4e8d4ffa9a92e121fb6391a37687fda9e2b09f8304ff12b&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-15T18:17:04.614441655Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;null&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: []</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;005cd306dc9e51a50a9bff5a2f2a9c54297c2dfe786443787d54df1d0a10e8bb&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;46a077f2a809d0073a6c9251897e4dd1e47dd785c6f13f32056dfb13e32f0ded&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<p>HOST，与宿主机IP相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker run -d --name test1 --network host busybox &#x2F;bin&#x2F;sh -c &quot;while true;do sleep 3600;done&quot;</span><br><span class="line">0bf2514b4ce329a56491409d6470b0bc8374824be805bec6c5e387ecbb10713f</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect host</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;host&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;39385556d8cda0864b8911f06c7c0b79d1858f2d16b6b31fd34e5e87cb8ac08b&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-15T18:17:04.625179187Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;host&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: []</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;0bf2514b4ce329a56491409d6470b0bc8374824be805bec6c5e387ecbb10713f&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;adfa701db6a153c3fafd4b9fb4d10b35b47872afd9f7595f0b5ee7b9089d59df&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[vagrant@docker-node1 ~]$ docker  exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000</span><br><span class="line">    link&#x2F;ether 52:54:00:47:2c:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15&#x2F;24 brd 10.0.2.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 84405sec preferred_lft 84405sec</span><br><span class="line">    inet6 fe80::5054:ff:fe47:2c0d&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:20:4d:38:8a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1&#x2F;16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:20ff:fe4d:388a&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: br-7cbd844d6e4c: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:be:6a:02:b8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1&#x2F;16 brd 172.18.255.255 scope global br-7cbd844d6e4c</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:2a:89:41 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.61&#x2F;24 brd 192.168.56.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a00:27ff:fe2a:8941&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: vethd963769@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue master docker0 </span><br><span class="line">    link&#x2F;ether ee:f6:51:e6:91:e3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::ecf6:51ff:fee6:91e3&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<h1 id="多机通信-Overlay"><a href="#多机通信-Overlay" class="headerlink" title="多机通信 Overlay"></a>多机通信 Overlay</h1><p>参考资料：<a target="_blank" rel="noopener" href="https://github.com/docker/labs/blob/master/networking/concepts/06-overlay-networks.md">https://github.com/docker/labs/blob/master/networking/concepts/06-overlay-networks.md</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Overlay</span><br><span class="line"> +</span><br><span class="line">VXLAN(VXLAN，https:&#x2F;&#x2F;cizixs.com&#x2F;2017&#x2F;09&#x2F;25&#x2F;vxlan-protocol-introduction&#x2F;)</span><br><span class="line"> +</span><br><span class="line">隧道(Ethernet、IPV4、UDP)</span><br></pre></td></tr></table></figure>
<p>需要借用etcd，记录多机上的Container没有重复IP。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">搭建etcd集群</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo yum install wget -y &amp;&amp; wget https:&#x2F;&#x2F;github.com&#x2F;etcd-io&#x2F;etcd&#x2F;releases&#x2F;download&#x2F;v3.3.10&#x2F;etcd-v3.3.10-linux-amd64.tar.gz &amp;&amp; tar zxvf etcd-v3.3.10-linux-amd64.tar.gz &amp;&amp; cd etcd-v3.3.10-linux-amd64&#x2F;</span><br><span class="line">[vagrant@docker-node2 ~]$ sudo yum install wget -y &amp;&amp; wget https:&#x2F;&#x2F;github.com&#x2F;etcd-io&#x2F;etcd&#x2F;releases&#x2F;download&#x2F;v3.3.10&#x2F;etcd-v3.3.10-linux-amd64.tar.gz &amp;&amp; tar zxvf etcd-v3.3.10-linux-amd64.tar.gz &amp;&amp; cd etcd-v3.3.10-linux-amd64&#x2F;</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 etcd-v3.3.10-linux-amd64]$ nohup .&#x2F;etcd --name docker-node1 \</span><br><span class="line">--initial-advertise-peer-urls http:&#x2F;&#x2F;192.168.56.61:2380 \</span><br><span class="line">--listen-peer-urls http:&#x2F;&#x2F;192.168.56.61:2380 \</span><br><span class="line">--listen-client-urls http:&#x2F;&#x2F;192.168.56.61:2379,http:&#x2F;&#x2F;127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls http:&#x2F;&#x2F;192.168.56.61:2379 \</span><br><span class="line">--initial-cluster-token etcd-cluster \</span><br><span class="line">--initial-cluster docker-node1&#x3D;http:&#x2F;&#x2F;192.168.56.61:2380,docker-node2&#x3D;http:&#x2F;&#x2F;192.168.56.62:2380 \</span><br><span class="line">--initial-cluster-state new&amp;</span><br><span class="line">[vagrant@docker-node2 etcd-v3.3.10-linux-amd64]$ nohup .&#x2F;etcd --name docker-node2 \</span><br><span class="line">--initial-advertise-peer-urls http:&#x2F;&#x2F;192.168.56.62:2380 \</span><br><span class="line">--listen-peer-urls http:&#x2F;&#x2F;192.168.56.62:2380 \</span><br><span class="line">--listen-client-urls http:&#x2F;&#x2F;192.168.56.62:2379,http:&#x2F;&#x2F;127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls http:&#x2F;&#x2F;192.168.56.62:2379 \</span><br><span class="line">--initial-cluster-token etcd-cluster \</span><br><span class="line">--initial-cluster docker-node1&#x3D;http:&#x2F;&#x2F;192.168.56.61:2380,docker-node2&#x3D;http:&#x2F;&#x2F;192.168.56.62:2380 \</span><br><span class="line">--initial-cluster-state new&amp;</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 etcd-v3.3.10-linux-amd64]$ .&#x2F;etcdctl cluster-health</span><br><span class="line">member 14192bed1b668a6 is healthy: got healthy result from http:&#x2F;&#x2F;192.168.56.61:2379</span><br><span class="line">member 80c395b734da48f6 is healthy: got healthy result from http:&#x2F;&#x2F;192.168.56.62:2379</span><br><span class="line">cluster is healthy</span><br><span class="line">[vagrant@docker-node2 etcd-v3.3.10-linux-amd64]$ .&#x2F;etcdctl cluster-health</span><br><span class="line">member 14192bed1b668a6 is healthy: got healthy result from http:&#x2F;&#x2F;192.168.56.61:2379</span><br><span class="line">member 80c395b734da48f6 is healthy: got healthy result from http:&#x2F;&#x2F;192.168.56.62:2379</span><br><span class="line">cluster is healthy</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 etcd-v3.3.10-linux-amd64]$ sudo service docker stop</span><br><span class="line">[vagrant@docker-node1 etcd-v3.3.10-linux-amd64]$ sudo &#x2F;usr&#x2F;bin&#x2F;dockerd -H tcp:&#x2F;&#x2F;0.0.0.0:2375 -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock --cluster-store&#x3D;etcd:&#x2F;&#x2F;192.168.56.61:2379 --cluster-advertise&#x3D;192.168.56.61:2375&amp;</span><br><span class="line">[vagrant@docker-node1 etcd-v3.3.10-linux-amd64]$ sudo docker version</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node2 etcd-v3.3.10-linux-amd64]$ sudo service docker stop</span><br><span class="line">[vagrant@docker-node2 etcd-v3.3.10-linux-amd64]$ sudo &#x2F;usr&#x2F;bin&#x2F;dockerd -H tcp:&#x2F;&#x2F;0.0.0.0:2375 -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock --cluster-store&#x3D;etcd:&#x2F;&#x2F;192.168.56.62:2379 --cluster-advertise&#x3D;192.168.56.62:2375&amp;</span><br><span class="line">[vagrant@docker-node2 etcd-v3.3.10-linux-amd64]$ sudo docker version</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">6a9dcf7a7d0a        bridge              bridge              local</span><br><span class="line">39385556d8cd        host                host                local</span><br><span class="line">7828c2433efd        none                null                local</span><br><span class="line">[vagrant@docker-node2 ~]$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">e93dec4d4089        bridge              bridge              local</span><br><span class="line">199f9936292d        host                host                local</span><br><span class="line">4a55973792c6        none                null                local</span><br><span class="line">在docker-node1机器上创建overlay网络，名字为demo。会自动同步到docker-node2机器上，这个就是etcd做的。</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo docker network create -d overlay demo</span><br><span class="line">d0cf99b69499e384b52854e852b0c734ebae3f039fdacd762e5347de18454fda</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">6a9dcf7a7d0a        bridge              bridge              local</span><br><span class="line">d0cf99b69499        demo                overlay             global</span><br><span class="line">39385556d8cd        host                host                local</span><br><span class="line">7828c2433efd        none                null                local</span><br><span class="line">[vagrant@docker-node2 ~]$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">e93dec4d4089        bridge              bridge              local</span><br><span class="line">d0cf99b69499        demo                overlay             global</span><br><span class="line">199f9936292d        host                host                local</span><br><span class="line">4a55973792c6        none                null                local</span><br><span class="line">[vagrant@docker-node1 etcd-v3.3.10-linux-amd64]$ .&#x2F;etcdctl ls &#x2F;docker&#x2F;network&#x2F;v1.0&#x2F;network</span><br><span class="line">&#x2F;docker&#x2F;network&#x2F;v1.0&#x2F;network&#x2F;d0cf99b69499e384b52854e852b0c734ebae3f039fdacd762e5347de18454fda</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect demo</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;demo&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;d0cf99b69499e384b52854e852b0c734ebae3f039fdacd762e5347de18454fda&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-17T15:00:39.903457425Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;global&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;10.0.0.0&#x2F;24&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;10.0.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">创建Container测试，在不同的机器上创建相同名字的Container会有报错，当在第二个机器上创建test1 Container时，会去etcd中查找。</span><br><span class="line">[vagrant@docker-node1 ~]$ sudo docker run -d --name test1 --net demo busybox sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line">fabfd6aab82b692d0d59ba5ca61d0315fced0fa459510ebe1d17fe8eacd71882</span><br><span class="line">[vagrant@docker-node2 ~]$ sudo docker run -d --name test1 --net demo busybox sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line">docker: Error response from daemon: Conflict. The container name &quot;&#x2F;test1&quot; is already in use by container &quot;74d40e80850ca8b95f6c43b7c78f755811e71892116428b1108a1f62553dbf7f&quot;. You have to remove (or rename) that container to be able to reuse that name.</span><br><span class="line">See &#39;docker run --help&#39;.</span><br><span class="line">[vagrant@docker-node2 ~]$ sudo docker run -d --name test2 --net demo busybox sh -c &quot;while true; do sleep 3600; done&quot;</span><br><span class="line">09ab0bd6131b7bebbadf7183a4ab6179fd4fea2fe1322c38437e2043bf7b0b43</span><br><span class="line">再次查看网络信息</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network inspect demo</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;demo&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;d0cf99b69499e384b52854e852b0c734ebae3f039fdacd762e5347de18454fda&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-17T15:00:39.903457425Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;global&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;10.0.0.0&#x2F;24&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;10.0.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;ep-596086a2ecffec95d85529df2e24016ac62c8448466f60454e61567482faf02f&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test2&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;596086a2ecffec95d85529df2e24016ac62c8448466f60454e61567482faf02f&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:0a:00:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;10.0.0.3&#x2F;24&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;fabfd6aab82b692d0d59ba5ca61d0315fced0fa459510ebe1d17fe8eacd71882&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;test1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;36027fb8100351e24db8e5691a70420413a5e02d6f397af3794cb2eabdc71fb8&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:0a:00:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;10.0.0.2&#x2F;24&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">12: eth0@if13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1450 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:0a:00:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.2&#x2F;24 brd 10.0.0.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: eth1@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.0.2&#x2F;16 brd 172.19.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[vagrant@docker-node2 ~]$ docker exec test2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1450 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:0a:00:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.3&#x2F;24 brd 10.0.0.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">10: eth1@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.2&#x2F;16 brd 172.18.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">每个Container中两个接口，这时docker network会多出一个docker_gwbridge，Container内其中一个接口连接的就是docker_gwbridge。</span><br><span class="line">[vagrant@docker-node1 ~]$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">d0cf99b69499        demo                overlay             global</span><br><span class="line">c43108631ed7        docker_gwbridge     bridge              local</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test1 ping 10.0.0.3</span><br><span class="line">PING 10.0.0.3 (10.0.0.3): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;10.259 ms</span><br><span class="line">[vagrant@docker-node1 ~]$ docker exec test1 ping test2</span><br><span class="line">PING test2 (10.0.0.3): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;5.188 ms</span><br><span class="line"></span><br><span class="line">[vagrant@docker-node2 ~]$ docker exec test2 ping 10.0.0.2</span><br><span class="line">PING 10.0.0.2 (10.0.0.2): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;8.995 ms</span><br><span class="line">[vagrant@docker-node2 ~]$ docker exec test2 ping test1</span><br><span class="line">PING test1 (10.0.0.2): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;5.485 ms</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/12/14/docker-2-%E4%BB%8E%E9%9B%B6%E5%88%B6%E4%BD%9CBase-Image/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/14/docker-2-%E4%BB%8E%E9%9B%B6%E5%88%B6%E4%BD%9CBase-Image/" class="post-title-link" itemprop="url">docker-2 从零制作Base Image</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-14 00:20:04" itemprop="dateCreated datePublished" datetime="2018-12-14T00:20:04+08:00">2018-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>学习视频地址：<a target="_blank" rel="noopener" href="https://coding.imooc.com/class/189.html">https://coding.imooc.com/class/189.html</a></p>
<h1 id="从零制作Base-Image"><a href="#从零制作Base-Image" class="headerlink" title="从零制作Base Image"></a>从零制作Base Image</h1><p>1、编写一个Demo程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ sudo yum install glibc-static gcc -y</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ cat helloworld.c </span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    printf(&quot;hello world!\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 不加-static编译，docker run会报错，为什么？后续再查... ...</span><br><span class="line"># standard_init_linux.go:190: exec user process caused &quot;no such file or directory&quot;</span><br><span class="line">[vagrant@localhost ~]$ gcc -static helloworld.c -o helloworld</span><br></pre></td></tr></table></figure>
<p>2、编写Dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ cat Dockerfile </span><br><span class="line">FROM scratch</span><br><span class="line">ADD helloworld &#x2F;</span><br><span class="line">CMD [&quot;&#x2F;helloworld&quot;]</span><br></pre></td></tr></table></figure>
<p>3、build镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ docker build -t yujiang&#x2F;helloworld .</span><br><span class="line">Sending build context to Docker daemon  19.97kB</span><br><span class="line">Step 1&#x2F;3 : FROM scratch</span><br><span class="line"> ---&gt; </span><br><span class="line">Step 2&#x2F;3 : ADD helloworld &#x2F;</span><br><span class="line"> ---&gt; 2949199fbdb8</span><br><span class="line">Step 3&#x2F;3 : CMD [&quot;&#x2F;helloworld&quot;]</span><br><span class="line"> ---&gt; Running in 3af2e910629e</span><br><span class="line">Removing intermediate container 3af2e910629e</span><br><span class="line"> ---&gt; b898a6498b21</span><br><span class="line">Successfully built b898a6498b21</span><br><span class="line">Successfully tagged yujiang&#x2F;helloworld:latest</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker image ls</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">yujiang&#x2F;helloworld   latest              b898a6498b21        21 seconds ago      857kB</span><br><span class="line"></span><br><span class="line">查看分层</span><br><span class="line">[vagrant@localhost ~]$ docker history yujiang&#x2F;helloworld</span><br><span class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</span><br><span class="line">b898a6498b21        About a minute ago   &#x2F;bin&#x2F;sh -c #(nop)  CMD [&quot;&#x2F;helloworld&quot;]          0B                  </span><br><span class="line">2949199fbdb8        About a minute ago   &#x2F;bin&#x2F;sh -c #(nop) ADD file:5e0b91d4866514aa0…   857kB              </span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ ll -h</span><br><span class="line">total 848K</span><br><span class="line">-rw-rw-r--. 1 vagrant vagrant   50 Dec 13 16:41 Dockerfile</span><br><span class="line">-rwxrwxr-x. 1 vagrant vagrant 837K Dec 13 16:47 helloworld</span><br><span class="line">-rw-rw-r--. 1 vagrant vagrant   79 Dec 13 16:11 helloworld.c</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker run yujiang&#x2F;helloworld</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure>
<h1 id="使用docker-commit制作image"><a href="#使用docker-commit制作image" class="headerlink" title="使用docker commit制作image"></a>使用docker commit制作image</h1><p>当container已经存在时，并对容器中进行了一些变化（如安装了某一个软件）。可以把已经改变的container commit一个新的image，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container commit</span><br></pre></td></tr></table></figure>
<p>1、启动一个容器并安装vim</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ docker run -it centos</span><br><span class="line">[root@b2985a1be234 &#x2F;]# yum install vim -y</span><br><span class="line">[root@b2985a1be234 &#x2F;]# exit</span><br><span class="line">[vagrant@localhost ~]$ docker container ls -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                          PORTS               NAMES</span><br><span class="line">b2985a1be234        centos              &quot;&#x2F;bin&#x2F;bash&quot;         3 minutes ago       Exited (0) About a minute ago                       nervous_haslett</span><br></pre></td></tr></table></figure>
<p>2、使用docker commit创建image</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ docker commit b2985a1be234 yujiang&#x2F;centos-vim</span><br><span class="line">sha256:d0a8856e664eb754f9854c0c27a92c7d01623d2087a77269fbd12ba5021e6e13</span><br><span class="line">[vagrant@localhost ~]$ docker image ls</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">yujiang&#x2F;centos-vim    latest              d0a8856e664e        59 seconds ago      327MB</span><br><span class="line">centos                latest              1e1148e4cc2c        7 days ago          202MB</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker history 1e1148e4cc2c</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">1e1148e4cc2c        7 days ago          &#x2F;bin&#x2F;sh -c #(nop)  CMD [&quot;&#x2F;bin&#x2F;bash&quot;]            0B                  </span><br><span class="line">&lt;missing&gt;           7 days ago          &#x2F;bin&#x2F;sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class="line">&lt;missing&gt;           7 days ago          &#x2F;bin&#x2F;sh -c #(nop) ADD file:6f877549795f4798a…   202MB               </span><br><span class="line">[vagrant@localhost ~]$ docker history d0a8856e664e</span><br><span class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</span><br><span class="line">d0a8856e664e        About a minute ago   &#x2F;bin&#x2F;bash                                       126MB               </span><br><span class="line">1e1148e4cc2c        7 days ago           &#x2F;bin&#x2F;sh -c #(nop)  CMD [&quot;&#x2F;bin&#x2F;bash&quot;]            0B                  </span><br><span class="line">&lt;missing&gt;           7 days ago           &#x2F;bin&#x2F;sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class="line">&lt;missing&gt;           7 days ago           &#x2F;bin&#x2F;sh -c #(nop) ADD file:6f877549795f4798a…   202MB </span><br></pre></td></tr></table></figure>
<p>这样发布image是不安全的，因为其他人不知道你对镜像做了哪些修改。不提倡。</p>
<h1 id="使用docker-build制作image"><a href="#使用docker-build制作image" class="headerlink" title="使用docker build制作image"></a>使用docker build制作image</h1><p>1、创建centos-vim目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ mkdir centos-vim &amp;&amp; cd centos-vim</span><br></pre></td></tr></table></figure>
<p>2、编写Dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost centos-vim]$ vim Dockerfile</span><br><span class="line">FROM centos</span><br><span class="line">RUN yum install vim -y	</span><br></pre></td></tr></table></figure>
<p>3、使用docker build创建image</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost centos-vim]$ docker build -t yujiang&#x2F;centos-vim .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1&#x2F;2 : FROM centos</span><br><span class="line"> ---&gt; 1e1148e4cc2c</span><br><span class="line">Step 2&#x2F;2 : RUN yum install vim -y</span><br><span class="line"> ---&gt; Running in 8122262ff02a</span><br><span class="line"></span><br><span class="line">...安装过程省略...</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 8122262ff02a</span><br><span class="line"> ---&gt; e00635baf672</span><br><span class="line">Successfully built e00635baf672</span><br><span class="line">Successfully tagged yujiang&#x2F;centos-vim:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Step 1&#x2F;2 直接引用centos这层image(1e1148e4cc2c)</span><br><span class="line">Step 2&#x2F;2 生成了一个临时的image(8122262ff02a)，在临时的image里面通过yum安装vim，安装完以后临时的image会被remove掉（Removing intermediate container 8122262ff02a），最后根据刚才临时的image commit成为一个新的image。如果build过程中报错，可以使用这个debug(docker run -it 8122262ff02a &#x2F;bin&#x2F;bash)</span><br><span class="line"></span><br><span class="line">[vagrant@localhost centos-vim]$ docker image ls</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">yujiang&#x2F;centos-vim    latest              e00635baf672        6 minutes ago       327MB</span><br><span class="line">centos                latest              1e1148e4cc2c        7 days ago          202MB</span><br></pre></td></tr></table></figure>
<p>推荐使用docker build来构建image。</p>
<h1 id="Dockerfile语法"><a href="#Dockerfile语法" class="headerlink" title="Dockerfile语法"></a>Dockerfile语法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">官方文档：https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;builder&#x2F;</span><br></pre></td></tr></table></figure>
<p>FROM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM scratch		# 制作base image</span><br><span class="line">FROM centos			# 使用base image</span><br><span class="line">FROM ubuntu:14.04	</span><br><span class="line">尽量使用官方的image作为base image</span><br></pre></td></tr></table></figure>
<p>LABEL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LABEL maintainer&#x3D;&quot;lnsyyj@xxx.com&quot;</span><br><span class="line">LABEL version&#x3D;&quot;1.0&quot;</span><br><span class="line">LABEL description&#x3D;&quot;Tish is description&quot;</span><br><span class="line">定义image的metadata</span><br></pre></td></tr></table></figure>
<p>RUN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RUN yum update &amp;&amp; yum install -y vim \</span><br><span class="line">	python-devel # 反斜线换行</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y perl \</span><br><span class="line">	pwgen --no-install-recommends &amp;&amp; rm -rf \</span><br><span class="line">	&#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;* # 注意清理cache</span><br><span class="line">RUN &#x2F;bin&#x2F;bash -c &#39;source $HOME&#x2F;.bashrc; echo $HOME&#39;</span><br><span class="line">为了美观，复杂的RUN请用反斜杠换行，避免无用分层，合并多条命令成一行。</span><br></pre></td></tr></table></figure>
<p>WORKDIR</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR &#x2F;root</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;test	# 如果没有会自动创建test目录</span><br><span class="line">WORKDIR demo</span><br><span class="line">RUN pwd		# 输出结果应该是&#x2F;test&#x2F;demo</span><br><span class="line">用WORKDIR，不要用RUN cd，尽量使用绝对路径！</span><br></pre></td></tr></table></figure>
<p>ADD 和 COPY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ADD hello &#x2F;</span><br><span class="line"></span><br><span class="line">ADD test.tar.gz &#x2F;	# 添加到根目录并解压</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;root</span><br><span class="line">ADD hello test&#x2F;		# &#x2F;root&#x2F;test&#x2F;hello</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;root</span><br><span class="line">COPY hello test&#x2F;</span><br><span class="line">大部分情况，COPY优于ADD！ADD除了COPY还有额外功能(解压)！添加远程文件&#x2F;目录请使用curl或者wget下载到docker中！</span><br></pre></td></tr></table></figure>
<p>ENV</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ENV MYSQL_VERSION 5.6	# 设置常量</span><br><span class="line">RUN apt-get install -y mysql-server&#x3D;&quot;$&#123;MYSQL_VERSION&#125;&quot; \</span><br><span class="line">	&amp;&amp; rm -rf &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;*	# 引用常量</span><br><span class="line">尽量使用ENV增加可维护性！</span><br></pre></td></tr></table></figure>
<p>VOLUME 和 EXPOSE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（存储和网络），后面我们单独讲！</span><br></pre></td></tr></table></figure>
<p>CMD 和 ENTRYPOINT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后面我们单独讲！</span><br></pre></td></tr></table></figure>
<h1 id="RUN-vs-CMD-vs-ENTRYPOINT"><a href="#RUN-vs-CMD-vs-ENTRYPOINT" class="headerlink" title="RUN vs CMD vs ENTRYPOINT"></a>RUN vs CMD vs ENTRYPOINT</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN：执行命令并创建新的Image Layer</span><br><span class="line">CMD：设置容器启动后默认执行的命令和参数</span><br><span class="line">ENTRYPOINT：设置容器启动时运行的命令</span><br></pre></td></tr></table></figure>
<h2 id="Shell和Exec格式"><a href="#Shell和Exec格式" class="headerlink" title="Shell和Exec格式"></a>Shell和Exec格式</h2><p>Shell格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get install -y vim</span><br><span class="line">CMD echo &quot;hello docker&quot;</span><br><span class="line">ENTRYPOINT echo &quot;hello docker&quot;</span><br></pre></td></tr></table></figure>
<p>Exec格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN [ &quot;apt-get&quot;, &quot;install&quot;, &quot;-y&quot;, &quot;vim&quot; ]</span><br><span class="line">CMD [ &quot;&#x2F;bin&#x2F;echo&quot;, &quot;hello docker&quot; ]</span><br><span class="line">ENTRYPOINT [ &quot;&#x2F;bin&#x2F;echo&quot;, &quot;hello docker&quot; ]</span><br></pre></td></tr></table></figure>
<p>DEMO</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Dockerfile1：</span><br><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT echo &quot;hello $name&quot;</span><br><span class="line"></span><br><span class="line">Dockerfile2：</span><br><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT [ &quot;&#x2F;bin&#x2F;echo&quot;, &quot;hello $name&quot; ]</span><br><span class="line"></span><br><span class="line">Dockerfile2会原样输出&quot;hello $name&quot;，不会像Dockerfile1那样输出&quot;hello Docker&quot;。如何使Dockerfile2像Dockerfile1那样输出的？请看Dockerfile3</span><br><span class="line"></span><br><span class="line">Dockerfile3：</span><br><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">ENTRYPOINT [ &quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo hello $name&quot; ] # 指定-c参数，后面的命令需要放在一个&quot;&quot;中，作为一条命令</span><br></pre></td></tr></table></figure>
<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><ul>
<li><p>容器启动时默认执行的命令</p>
</li>
<li><p>如果docker run指定了其他命令，CMD命令被忽略</p>
</li>
<li><p>如果定义了多个CMD，只有最后一个会执行</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENV name Docker</span><br><span class="line">CMD echo &quot;hello $name&quot;</span><br><span class="line"></span><br><span class="line">docker run [image]输出？打印&quot;hello Docker&quot;</span><br><span class="line">Docker run -it [image] &#x2F;bin&#x2F;bash输出？不会打印&quot;hello Docker&quot;，&#x2F;bin&#x2F;bash覆盖了CMD</span><br></pre></td></tr></table></figure>
<h2 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h2><ul>
<li><p>让容器以应用程序或者服务的形式运行</p>
</li>
<li><p>不会被忽略，一定会执行</p>
</li>
<li><p>最佳实践：写一个shell脚本作为entrypoint</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">COPY docker-entrypoint.sh &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line">ENTRYPOINT [ &quot;docker-entrypoint.sh&quot; ]</span><br><span class="line"></span><br><span class="line">EXPOSE 27017</span><br><span class="line">CMD [ &quot;mongod&quot; ]</span><br></pre></td></tr></table></figure>
<h1 id="镜像存放"><a href="#镜像存放" class="headerlink" title="镜像存放"></a>镜像存放</h1><h2 id="公有镜像"><a href="#公有镜像" class="headerlink" title="公有镜像"></a>公有镜像</h2><p><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ docker build -t lnsyyj&#x2F;helloworld .</span><br><span class="line">[vagrant@localhost ~]$ docker images</span><br><span class="line">lnsyyj&#x2F;helloworld     latest              1a8620e6d6de        46 hours ago        857kB</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https:&#x2F;&#x2F;hub.docker.com to create one.</span><br><span class="line">Username: lnsyyj</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker push lnsyyj&#x2F;helloworld:latest</span><br><span class="line">The push refers to repository [docker.io&#x2F;lnsyyj&#x2F;helloworld]</span><br><span class="line">a9094ec14918: Pushed </span><br><span class="line">latest: digest: sha256:dd740db962a1e3a8fb74461505f539248b7c88de80b133db612c22e80d7b2d17 size: 527</span><br><span class="line"></span><br><span class="line">删除本地镜像，测试下载镜像</span><br><span class="line">[vagrant@localhost ~]$ docker rmi lnsyyj&#x2F;helloworld</span><br><span class="line">[vagrant@localhost ~]$ docker pull lnsyyj&#x2F;helloworld</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以link到github，github中的Repositories中有Dockerfile，dockehub会自动build镜像</li>
</ul>
<h2 id="私有镜像"><a href="#私有镜像" class="headerlink" title="私有镜像"></a>私有镜像</h2><p>搭建docker registry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;hub.docker.com&#x2F;_&#x2F;registry</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker run -d -p 5000:5000 --restart always --name registry registry:2</span><br><span class="line">Unable to find image &#39;registry:2&#39; locally</span><br><span class="line">2: Pulling from library&#x2F;registry</span><br><span class="line">d6a5679aa3cf: Pull complete </span><br><span class="line">ad0eac849f8f: Pull complete </span><br><span class="line">2261ba058a15: Pull complete </span><br><span class="line">f296fda86f10: Pull complete </span><br><span class="line">bcd4a541795b: Pull complete </span><br><span class="line">Digest: sha256:5a156ff125e5a12ac7fdec2b90b7e2ae5120fa249cf62248337b6d04abc574c8</span><br><span class="line">Status: Downloaded newer image for registry:2</span><br><span class="line">2707d472d3dba19f366c7ca51e621b83a63975492152880e01268a326d34bf50</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker build -t 10.0.2.15:5000&#x2F;helloworld .</span><br><span class="line">Sending build context to Docker daemon  873.5kB</span><br><span class="line">Step 1&#x2F;3 : FROM scratch</span><br><span class="line"> ---&gt; </span><br><span class="line">Step 2&#x2F;3 : ADD helloworld &#x2F;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 1b468168e95e</span><br><span class="line">Step 3&#x2F;3 : CMD [&quot;&#x2F;helloworld&quot;]</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 1a8620e6d6de</span><br><span class="line">Successfully built 1a8620e6d6de</span><br><span class="line">Successfully tagged 10.0.2.15:5000&#x2F;helloworld:latest</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ cat &#x2F;etc&#x2F;docker&#x2F;daemon.json </span><br><span class="line">&#123; &quot;insecure-registries&quot;: [&quot;10.0.2.15:5000&quot;] &#125;</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ sudo vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service </span><br><span class="line">添加</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">[vagrant@localhost ~]$ sudo systemctl daemon-reload</span><br><span class="line">[vagrant@localhost ~]$ service docker restart</span><br><span class="line"></span><br><span class="line">push到私有镜像仓库</span><br><span class="line">[vagrant@localhost ~]$ docker images</span><br><span class="line">10.0.2.15:5000&#x2F;helloworld   latest              1a8620e6d6de        47 hours ago        857kB</span><br><span class="line">[vagrant@localhost ~]$ curl http:&#x2F;&#x2F;10.0.2.15:5000&#x2F;v2&#x2F;_catalog</span><br><span class="line">&#123;&quot;repositories&quot;:[]&#125;</span><br><span class="line">[vagrant@localhost ~]$ docker push 10.0.2.15:5000&#x2F;helloworld</span><br><span class="line">The push refers to repository [10.0.2.15:5000&#x2F;helloworld]</span><br><span class="line">a9094ec14918: Pushed </span><br><span class="line">latest: digest: sha256:dd740db962a1e3a8fb74461505f539248b7c88de80b133db612c22e80d7b2d17 size: 527</span><br><span class="line">[vagrant@localhost ~]$ curl http:&#x2F;&#x2F;10.0.2.15:5000&#x2F;v2&#x2F;_catalog</span><br><span class="line">&#123;&quot;repositories&quot;:[&quot;helloworld&quot;]&#125;</span><br><span class="line">验证</span><br><span class="line">[vagrant@localhost ~]$ docker rmi 10.0.2.15:5000&#x2F;helloworld</span><br><span class="line">[vagrant@localhost ~]$ docker pull 10.0.2.15:5000&#x2F;helloworld</span><br></pre></td></tr></table></figure>
<h1 id="container常用命令"><a href="#container常用命令" class="headerlink" title="container常用命令"></a>container常用命令</h1><p>docker exec，进入运行中的容器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it &lt;container ID&gt; &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<p>docker stop，停止运行中的容器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop &lt;container ID&gt;</span><br></pre></td></tr></table></figure>
<p>docker inspect，查看容器的详细信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect &lt;container ID&gt;</span><br></pre></td></tr></table></figure>
<p>docker logs，查看容器的log。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;container ID&gt;</span><br></pre></td></tr></table></figure>
<h1 id="linux压力测试工具stress"><a href="#linux压力测试工具stress" class="headerlink" title="linux压力测试工具stress"></a>linux压力测试工具stress</h1><p>docker build命令行程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ mkdir stress &amp;&amp; cd stress&#x2F;</span><br><span class="line">[vagrant@localhost stress]$ cat Dockerfile </span><br><span class="line">FROM ubuntu</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y stress</span><br><span class="line">ENTRYPOINT [&quot;&#x2F;usr&#x2F;bin&#x2F;stress&quot;]</span><br><span class="line">CMD []</span><br><span class="line">[vagrant@localhost stress]$ docker build -t lnsyyj&#x2F;ubuntu-stress  .</span><br><span class="line"></span><br><span class="line">[vagrant@localhost stress]$ docker run -it lnsyyj&#x2F;ubuntu-stress --vm 1 --verbose</span><br><span class="line">stress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd</span><br><span class="line">stress: dbug: [1] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [1] --&gt; hogvm worker 1 [6] forked</span><br><span class="line">stress: dbug: [6] allocating 268435456 bytes ...</span><br><span class="line">stress: dbug: [6] touching bytes in strides of 4096 bytes ...</span><br><span class="line">stress: dbug: [6] freed 268435456 bytes</span><br><span class="line">stress: dbug: [6] allocating 268435456 bytes ...</span><br><span class="line">stress: dbug: [6] touching bytes in strides of 4096 bytes ...</span><br><span class="line">stress: dbug: [6] freed 268435456 bytes</span><br><span class="line"></span><br><span class="line">--vm 1 --verbose是通过Dockerfile中的CMD []接收的。ENTRYPOINT+CMD这种方式是非常流行的。</span><br></pre></td></tr></table></figure>
<h1 id="对一个容器进行资源限制"><a href="#对一个容器进行资源限制" class="headerlink" title="对一个容器进行资源限制"></a>对一个容器进行资源限制</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost stress]$ docker run --memory&#x3D;200M  -it lnsyyj&#x2F;ubuntu-stress --vm 1 --vm-bytes 500M --verbose</span><br><span class="line">stress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd</span><br><span class="line">stress: dbug: [1] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [1] --&gt; hogvm worker 1 [6] forked</span><br><span class="line">stress: dbug: [6] allocating 524288000 bytes ...</span><br><span class="line">stress: dbug: [6] touching bytes in strides of 4096 bytes ...</span><br><span class="line">stress: FAIL: [1] (415) &lt;-- worker 6 got signal 9</span><br><span class="line">stress: WARN: [1] (417) now reaping child worker processes</span><br><span class="line">stress: FAIL: [1] (421) kill error: No such process</span><br><span class="line">stress: FAIL: [1] (451) failed run completed in 1s</span><br></pre></td></tr></table></figure>
<h1 id="docker-底层技术支持"><a href="#docker-底层技术支持" class="headerlink" title="docker 底层技术支持"></a>docker 底层技术支持</h1><ul>
<li><p>namespaces：做隔离pid、net、ipc、mnt、uts</p>
</li>
<li><p>control groups：做资源限制</p>
</li>
<li><p>union file systems：container和image的分层</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/12/12/docker-1-Docker-installed-on-centos7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/12/docker-1-Docker-installed-on-centos7/" class="post-title-link" itemprop="url">docker-1 Docker installed on centos7</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-12 23:01:20" itemprop="dateCreated datePublished" datetime="2018-12-12T23:01:20+08:00">2018-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>学习视频地址：<a target="_blank" rel="noopener" href="https://coding.imooc.com/class/189.html">https://coding.imooc.com/class/189.html</a></p>
<h1 id="在centos7上安装docker"><a href="#在centos7上安装docker" class="headerlink" title="在centos7上安装docker"></a>在centos7上安装docker</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;install&#x2F;linux&#x2F;docker-ce&#x2F;centos&#x2F;</span><br></pre></td></tr></table></figure>
<p>新建docker用户，并安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# adduser docker</span><br><span class="line">[root@docker ~]# hostnamectl set-hostname docker</span><br><span class="line">[root@docker ~]# vi &#x2F;etc&#x2F;sudoers</span><br><span class="line">添加</span><br><span class="line">docker  ALL&#x3D;(ALL)       ALL</span><br><span class="line">[root@docker ~]# su - docker</span><br><span class="line">上一次登录：三 12月 12 10:26:46 EST 2018pts&#x2F;0 上</span><br><span class="line">[docker@docker ~]$ </span><br><span class="line">[docker@docker ~]$ sudo yum install epel-release vim -y</span><br></pre></td></tr></table></figure>
<p>安装社区版</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">卸载已安装的docker</span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line">安装required packages</span><br><span class="line">sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line"></span><br><span class="line">安装docker源</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"></span><br><span class="line">安装docker</span><br><span class="line">[docker@docker ~]$ sudo yum install docker-ce -y</span><br><span class="line"></span><br><span class="line">启动docker进程，并设置开机启动</span><br><span class="line">[docker@docker ~]$ sudo systemctl start docker</span><br><span class="line">[docker@docker ~]$ sudo systemctl enable docker</span><br><span class="line">Created symlink from &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;docker.service to &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service.</span><br><span class="line"></span><br><span class="line">测试docker安装</span><br><span class="line">[docker@docker ~]$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<h1 id="Vagrant建立虚拟机，并在虚拟机中安装docker"><a href="#Vagrant建立虚拟机，并在虚拟机中安装docker" class="headerlink" title="Vagrant建立虚拟机，并在虚拟机中安装docker"></a>Vagrant建立虚拟机，并在虚拟机中安装docker</h1><p>1、安装VirtualBox然后安装Vagrant</p>
<p>2、下载Vagrant box</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:centos7 yujiang$ ls ~&#x2F;.vagrant.d&#x2F;downloadboxes&#x2F;centos7&#x2F;</span><br><span class="line">virtualbox.box</span><br></pre></td></tr></table></figure>
<p>3、添加Vagrant box到镜像列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:centos7 yujiang$ vagrant box add centos&#x2F;centos7 ~&#x2F;.vagrant.d&#x2F;downloadboxes&#x2F;centos7&#x2F;virtualbox.box </span><br><span class="line">&#x3D;&#x3D;&gt; box: Box file was not detected as metadata. Adding it directly...</span><br><span class="line">&#x3D;&#x3D;&gt; box: Adding box &#39;centos&#x2F;centos7&#39; (v0) for provider: </span><br><span class="line">    box: Unpacking necessary files from: file:&#x2F;&#x2F;&#x2F;Users&#x2F;yujiang&#x2F;.vagrant.d&#x2F;downloadboxes&#x2F;centos7&#x2F;virtualbox.box</span><br><span class="line">&#x3D;&#x3D;&gt; box: Successfully added box &#39;centos&#x2F;centos7&#39; (v0) for &#39;virtualbox&#39;!</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:centos7 yujiang$ vagrant box list</span><br><span class="line">centos&#x2F;centos7 (virtualbox, 0)</span><br></pre></td></tr></table></figure>
<p>4、创建Vagrant虚拟机目录并启动虚拟机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:~ yujiang$ mkdir Vagrant &amp;&amp; cd Vagrant&#x2F;</span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant init centos&#x2F;centos7</span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant up</span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant ssh</span><br><span class="line">[vagrant@localhost ~]$ exit</span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant destroy</span><br></pre></td></tr></table></figure>
<p>5、之后使用《在centos7上安装docker》安装docker</p>
<h2 id="编辑Vagrantfile，启动虚拟机时自动安装docker"><a href="#编辑Vagrantfile，启动虚拟机时自动安装docker" class="headerlink" title="编辑Vagrantfile，启动虚拟机时自动安装docker"></a>编辑Vagrantfile，启动虚拟机时自动安装docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># -*- mode: ruby -*-</span><br><span class="line">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class="line">  config.vm.box &#x3D; &quot;centos&#x2F;centos7&quot;</span><br><span class="line">  config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class="line">  sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux docker-engine-selinux docker-engine</span><br><span class="line">  sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">  sudo yum-config-manager --add-repo https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">  sudo yum install docker-ce -y</span><br><span class="line">  sudo systemctl start docker</span><br><span class="line">  sudo systemctl enable docker</span><br><span class="line">  sudo groupadd docker</span><br><span class="line">  sudo gpasswd -a vagrant docker</span><br><span class="line">  SHELL</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant up</span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant ssh</span><br><span class="line">[vagrant@localhost ~]$ sudo docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.09.0</span><br><span class="line"> API version:       1.39</span><br><span class="line"> Go version:        go1.10.4</span><br><span class="line"> Git commit:        4d60db4</span><br><span class="line"> Built:             Wed Nov  7 00:48:22 2018</span><br><span class="line"> OS&#x2F;Arch:           linux&#x2F;amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.09.0</span><br><span class="line">  API version:      1.39 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.4</span><br><span class="line">  Git commit:       4d60db4</span><br><span class="line">  Built:            Wed Nov  7 00:19:08 2018</span><br><span class="line">  OS&#x2F;Arch:          linux&#x2F;amd64</span><br><span class="line">  Experimental:     false</span><br></pre></td></tr></table></figure>
<h2 id="使用docker命令时，去掉sudo"><a href="#使用docker命令时，去掉sudo" class="headerlink" title="使用docker命令时，去掉sudo"></a>使用docker命令时，去掉sudo</h2><p>1、添加docker group</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ sudo groupadd docker</span><br><span class="line">groupadd: group &#39;docker&#39; already exists</span><br></pre></td></tr></table></figure>
<p>2、添加当前用户到docker group</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ sudo gpasswd -a vagrant docker</span><br><span class="line">Adding user vagrant to group docker</span><br></pre></td></tr></table></figure>
<p>3、退出当前终端，重新连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$ exit</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:Vagrant yujiang$ vagrant ssh</span><br><span class="line"></span><br><span class="line">[vagrant@localhost ~]$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.09.0</span><br><span class="line"> API version:       1.39</span><br><span class="line"> Go version:        go1.10.4</span><br><span class="line"> Git commit:        4d60db4</span><br><span class="line"> Built:             Wed Nov  7 00:48:22 2018</span><br><span class="line"> OS&#x2F;Arch:           linux&#x2F;amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.09.0</span><br><span class="line">  API version:      1.39 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.4</span><br><span class="line">  Git commit:       4d60db4</span><br><span class="line">  Built:            Wed Nov  7 00:19:08 2018</span><br><span class="line">  OS&#x2F;Arch:          linux&#x2F;amd64</span><br><span class="line">  Experimental:     false</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/12/03/gitlab-jenkins-ci/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/03/gitlab-jenkins-ci/" class="post-title-link" itemprop="url">gitlab jenkins ci</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-03 00:13:42" itemprop="dateCreated datePublished" datetime="2018-12-03T00:13:42+08:00">2018-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="搭建jenkins（centos-7）"><a href="#搭建jenkins（centos-7）" class="headerlink" title="搭建jenkins（centos 7）"></a>搭建jenkins（centos 7）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">安装jenkins</span><br><span class="line">sudo yum install wget -y</span><br><span class="line">sudo wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;jenkins.repo http:&#x2F;&#x2F;pkg.jenkins-ci.org&#x2F;redhat&#x2F;jenkins.repo</span><br><span class="line">sudo rpm --import https:&#x2F;&#x2F;jenkins-ci.org&#x2F;redhat&#x2F;jenkins-ci.org.key</span><br><span class="line">sudo yum install jenkins java -y</span><br><span class="line"></span><br><span class="line">启动jenkins</span><br><span class="line">sudo systemctl start jenkins</span><br><span class="line">sudo systemctl enable jenkins</span><br><span class="line">sudo systemctl status jenkins</span><br><span class="line"></span><br><span class="line">设置防火墙</span><br><span class="line">sudo firewall-cmd --permanent --new-service&#x3D;jenkins</span><br><span class="line">sudo firewall-cmd --permanent --service&#x3D;jenkins --set-short&#x3D;&quot;Jenkins Service Ports&quot;</span><br><span class="line">sudo firewall-cmd --permanent --service&#x3D;jenkins --set-description&#x3D;&quot;Jenkins service firewalld port exceptions&quot;</span><br><span class="line">sudo firewall-cmd --permanent --service&#x3D;jenkins --add-port&#x3D;8080&#x2F;tcp</span><br><span class="line">sudo firewall-cmd --permanent --add-service&#x3D;jenkins</span><br><span class="line">sudo firewall-cmd --zone&#x3D;public --add-service&#x3D;http --permanent</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>


<h1 id="搭建gitlab"><a href="#搭建gitlab" class="headerlink" title="搭建gitlab"></a>搭建gitlab</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl enable sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line">sudo firewall-cmd --permanent --add-service&#x3D;http</span><br><span class="line">sudo firewall-cmd --permanent --add-service&#x3D;httpsudo systemctl reload firewalld</span><br><span class="line">sudo systemctl reload firewalld</span><br><span class="line"></span><br><span class="line">安装Postfix以发送通知电子邮件</span><br><span class="line">sudo yum install postfix</span><br><span class="line">sudo systemctl enable postfix</span><br><span class="line">sudo systemctl start postfix</span><br><span class="line"></span><br><span class="line">安装gitbla</span><br><span class="line">wget https:&#x2F;&#x2F;mirror.tuna.tsinghua.edu.cn&#x2F;gitlab-ce&#x2F;yum&#x2F;el7&#x2F;gitlab-ce-11.5.1-ce.0.el7.x86_64.rpm</span><br><span class="line">rpm -i gitlab-ce-11.5.1-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb</span><br><span class="line">unicorn[&#39;port&#39;] &#x3D; 80</span><br><span class="line"></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br><span class="line"></span><br></pre></td></tr></table></figure>






<h1 id="配置jenkins-gitlab-ci"><a href="#配置jenkins-gitlab-ci" class="headerlink" title="配置jenkins gitlab ci"></a>配置jenkins gitlab ci</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/26/%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2ceph/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/26/%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2ceph/" class="post-title-link" itemprop="url">手动部署ceph</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-26 18:47:23" itemprop="dateCreated datePublished" datetime="2018-11-26T18:47:23+08:00">2018-11-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>手动部署ceph是看懂官方ansible或ceph-deploy的关键，了解部署步骤和相关组件才能更好的理解代码，理解OSD的挂载流程，所以个人认为需要做此实验。</p>
<p>官方文档：<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/install/manual-deployment/">http://docs.ceph.com/docs/master/install/manual-deployment/</a></p>
<h1 id="MANUAL-DEPLOYMENT"><a href="#MANUAL-DEPLOYMENT" class="headerlink" title="MANUAL DEPLOYMENT"></a>MANUAL DEPLOYMENT</h1><p>所有Ceph集群都需要至少一个monitor，并且至少需要与集群中存储对象副本一样多的OSD。引导初始monitor(s)是部署Ceph存储集群的第一步。monitor部署还为整个集群设置了重要准则，例如pool的副本数，每个OSD的placement groups数（PG数），心跳间隔，是否需要身份验证等。这些值中的大多数都是默认设置的，因此在设置生产环境集群时，了解它们很有用。<br>遵循与<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/start/">安装（快速）</a>相同的配置，我们将设置一个集群，其中node1作为监控节点，node2和node3作为OSD节点</p>
<p><img src="http://docs.ceph.com/docs/master/_images/ditaa-b67d58275cae03a5573d36907b437e36df685600.png"></p>
<h2 id="MONITOR-BOOTSTRAPPING"><a href="#MONITOR-BOOTSTRAPPING" class="headerlink" title="MONITOR BOOTSTRAPPING"></a>MONITOR BOOTSTRAPPING</h2><p>引导monitor需要许多东西：</p>
<ul>
<li><p>Unique Identifier（唯一标识符）: fsid是集群的唯一标识符，它是 Ceph 作为文件系统时的文件系统标识符。现在Ceph也支持原生接口，块设备和对象存储网关接口，因此fsid有点不恰当的。</p>
</li>
<li><p>Cluster Name（集群名称）: Ceph集群有一个集群名称，这是一个没有空格的字符串。默认集群名称为ceph，但您可以指定其他集群名称。当您使用多个集群并且需要清楚地了解正在使用哪个集群时，覆盖默认集群名称尤其有用。</p>
<p>例如，在<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/radosgw/multisite/#multisite">multisite configuration</a>中运行多个集群时，集群名称（例如，us-west，us-east）标识当前CLI会话的集群。注意：要在CLI标识集群名称，请使用集群名称指定Ceph配置文件（例如，ceph.conf，us-west.conf，us-east.conf等）。另请参阅CLI用法（ceph –cluster {cluster-name}）。</p>
</li>
<li><p>Monitor Name: 集群中的每个monitor实例都具有唯一的名称。通常，Ceph Monitor名称是主机名（我们建议独立一台主机运行Ceph Monitor，而不要将Ceph OSD Daemons与Ceph Monitors混合部署在一台机器上）。您可以使用hostname -s检索短主机名。</p>
</li>
<li><p>Monitor Map: 引导初始monitor(s)需要您生成monitor map。monitor map需要fsid，cluster name，以及至少一个host name及其IP地址。</p>
</li>
<li><p>Monitor Keyring: Monitors通过secret key相互通信。您必须生成带有monitor secret的keyring，并在引导初始monitor(s)时提供它。</p>
</li>
<li><p>Administrator Keyring: 要使用ceph CLI tools，您必须具有client.admin用户。因此，您必须生成admin用户和相应keyring，并且还必须将client.admin用户添加到monitor keyring。</p>
</li>
</ul>
<p>上述要求并不意味着创建Ceph配置文件。但是，作为最佳实践，我们建议创建一个Ceph配置文件，并使用fsid，mon initial members和mon host填充它。</p>
<p>您也可以在运行时获取并设置所有monitor settings。但是，Ceph配置文件可能只包含覆盖默认值的那些settings。将settings添加到Ceph配置文件时，这些settings会覆盖默认settings。在Ceph配置文件中维护这些settings可以使您更轻松地维护集群。</p>
<p>过程如下：</p>
<p>1、登录monitor节点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh node1</span><br></pre></td></tr></table></figure>
<p>2、确保您有Ceph配置文件的目录。 默认情况下，Ceph使用/etc/ceph。 安装ceph时，安装程序将自动创建/etc/ceph目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls &#x2F;etc&#x2F;ceph</span><br></pre></td></tr></table></figure>
<p>注意：部署工具可能在清除集群时删除此目录（例如，ceph-deploy purgedata {node-name}，ceph-deploy purge {node-name}）。</p>
<p>3、创建Ceph配置文件。 默认情况下，Ceph使用ceph.conf，其中ceph反映了集群名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim &#x2F;etc&#x2F;ceph&#x2F;ceph.conf</span><br></pre></td></tr></table></figure>
<p>4、为您的集群生成唯一ID（即fsid）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uuidgen</span><br></pre></td></tr></table></figure>
<p>5、将唯一ID添加到Ceph配置文件中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsid &#x3D; &#123;UUID&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsid &#x3D; a7f64266-0894-4f1e-a635-d0aeaca0e993</span><br></pre></td></tr></table></figure>
<p>6、将初始monitor(s)添加到Ceph配置文件中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mon initial members &#x3D; &#123;hostname&#125;[,&#123;hostname&#125;]</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mon initial members &#x3D; node1</span><br></pre></td></tr></table></figure>
<p>7、将初始monitor(s)的IP地址添加到Ceph配置文件并保存文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mon host &#x3D; &#123;ip-address&#125;[,&#123;ip-address&#125;]</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mon host &#x3D; 192.168.0.1</span><br></pre></td></tr></table></figure>
<p>注意：您可以使用IPv6地址而不是IPv4地址，但必须将ms bind ipv6设置为true。有关网络配置的详细信息，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/configuration/network-config-ref">网络配置参考</a>。</p>
<p>8、为集群创建keyring并生成monitor secret key。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph-authtool --create-keyring &#x2F;tmp&#x2F;ceph.mon.keyring --gen-key -n mon. --cap mon &#39;allow *&#39;</span><br></pre></td></tr></table></figure>
<p>9、生成administrator keyring，生成client.admin用户并将用户添加到keyring。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-authtool --create-keyring &#x2F;etc&#x2F;ceph&#x2F;ceph.client.admin.keyring --gen-key -n client.admin --cap mon &#39;allow *&#39; --cap osd &#39;allow *&#39; --cap mds &#39;allow *&#39; --cap mgr &#39;allow *&#39;</span><br></pre></td></tr></table></figure>
<p>10、生成bootstrap-osd keyring，生成client.bootstrap-osd用户并将用户添加到keyring。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-authtool --create-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring --gen-key -n client.bootstrap-osd --cap mon &#39;profile bootstrap-osd&#39;</span><br></pre></td></tr></table></figure>
<p>11、将生成的keys添加到ceph.mon.keyring。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-authtool &#x2F;tmp&#x2F;ceph.mon.keyring --import-keyring &#x2F;etc&#x2F;ceph&#x2F;ceph.client.admin.keyring</span><br><span class="line">sudo ceph-authtool &#x2F;tmp&#x2F;ceph.mon.keyring --import-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring</span><br></pre></td></tr></table></figure>
<p>12、使用主机名，主机IP地址和FSID生成monitor map。将其另存为/tmp/monmap。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monmaptool --create --add &#123;hostname&#125; &#123;ip-address&#125; --fsid &#123;uuid&#125; &#x2F;tmp&#x2F;monmap</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monmaptool --create --add node1 192.168.0.1 --fsid a7f64266-0894-4f1e-a635-d0aeaca0e993 &#x2F;tmp&#x2F;monmap</span><br></pre></td></tr></table></figure>
<p>13、在monitor主机上创建默认数据目录（或多个目录）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;mon&#x2F;&#123;cluster-name&#125;-&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u ceph mkdir &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;mon&#x2F;ceph-node1</span><br></pre></td></tr></table></figure>
<p>有关详细信息，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/configuration/mon-config-ref#data">Monitor Config Reference - Data</a>。</p>
<p>14、使用monitor map和keyring填充monitor daemon(s)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u ceph ceph-mon [--cluster &#123;cluster-name&#125;] --mkfs -i &#123;hostname&#125; --monmap &#x2F;tmp&#x2F;monmap --keyring &#x2F;tmp&#x2F;ceph.mon.keyring</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u ceph ceph-mon --mkfs -i node1 --monmap &#x2F;tmp&#x2F;monmap --keyring &#x2F;tmp&#x2F;ceph.mon.keyring</span><br></pre></td></tr></table></figure>
<p>15、考虑Ceph配置文件的settings，常见settings包括以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">fsid &#x3D; &#123;cluster-id&#125;</span><br><span class="line">mon initial members &#x3D; &#123;hostname&#125;[, &#123;hostname&#125;]</span><br><span class="line">mon host &#x3D; &#123;ip-address&#125;[, &#123;ip-address&#125;]</span><br><span class="line">public network &#x3D; &#123;network&#125;[, &#123;network&#125;]</span><br><span class="line">cluster network &#x3D; &#123;network&#125;[, &#123;network&#125;]</span><br><span class="line">auth cluster required &#x3D; cephx</span><br><span class="line">auth service required &#x3D; cephx</span><br><span class="line">auth client required &#x3D; cephx</span><br><span class="line">osd journal size &#x3D; &#123;n&#125;</span><br><span class="line">osd pool default size &#x3D; &#123;n&#125;  # Write an object n times.</span><br><span class="line">osd pool default min size &#x3D; &#123;n&#125; # Allow writing n copies in a degraded state.</span><br><span class="line">osd pool default pg num &#x3D; &#123;n&#125;</span><br><span class="line">osd pool default pgp num &#x3D; &#123;n&#125;</span><br><span class="line">osd crush chooseleaf type &#x3D; &#123;n&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，配置的[global]部分可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">fsid &#x3D; a7f64266-0894-4f1e-a635-d0aeaca0e993</span><br><span class="line">mon initial members &#x3D; node1</span><br><span class="line">mon host &#x3D; 192.168.0.1</span><br><span class="line">public network &#x3D; 192.168.0.0&#x2F;24</span><br><span class="line">auth cluster required &#x3D; cephx</span><br><span class="line">auth service required &#x3D; cephx</span><br><span class="line">auth client required &#x3D; cephx</span><br><span class="line">osd journal size &#x3D; 1024</span><br><span class="line">osd pool default size &#x3D; 3</span><br><span class="line">osd pool default min size &#x3D; 2</span><br><span class="line">osd pool default pg num &#x3D; 333</span><br><span class="line">osd pool default pgp num &#x3D; 333</span><br><span class="line">osd crush chooseleaf type &#x3D; 1</span><br></pre></td></tr></table></figure>
<p>16、启动monitor(s)。</p>
<p>对于大多数linux发行版，services通过systemd启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start ceph-mon@node1</span><br></pre></td></tr></table></figure>
<p>对于较旧的Debian/CentOS/RHEL，请使用sysvinit：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;ceph start mon.node1</span><br></pre></td></tr></table></figure>
<p>17、验证monitor是否正在运行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph -s</span><br></pre></td></tr></table></figure>
<p>您应该看到monitor已启动并打印运行的输出，并且您应该看到一个运行状况错误，提示placement groups（PG）处于inactive状态。看起来像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cluster:</span><br><span class="line">  id:     a7f64266-0894-4f1e-a635-d0aeaca0e993</span><br><span class="line">  health: HEALTH_OK</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  mon: 1 daemons, quorum node1</span><br><span class="line">  mgr: node1(active)</span><br><span class="line">  osd: 0 osds: 0 up, 0 in</span><br><span class="line"></span><br><span class="line">data:</span><br><span class="line">  pools:   0 pools, 0 pgs</span><br><span class="line">  objects: 0 objects, 0 bytes</span><br><span class="line">  usage:   0 kB used, 0 kB &#x2F; 0 kB avail</span><br><span class="line">  pgs:</span><br></pre></td></tr></table></figure>
<p>注意：添加OSD并启动它们后，placement group（PG）错误应该消失。有关详细信息，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/install/manual-deployment/#adding-osds">添加OSD</a>。</p>
<h2 id="MANAGER-DAEMON-CONFIGURATION"><a href="#MANAGER-DAEMON-CONFIGURATION" class="headerlink" title="MANAGER DAEMON CONFIGURATION"></a>MANAGER DAEMON CONFIGURATION</h2><p>在运行ceph-mon daemon的每个节点上，还应该设置ceph-mgr daemon。</p>
<p>请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/mgr/administrator/#mgr-administrator-guide">ceph-mgr管理员指南</a>。</p>
<h2 id="ADDING-OSDS"><a href="#ADDING-OSDS" class="headerlink" title="ADDING OSDS"></a>ADDING OSDS</h2><p>初始monitor(s)运行后，应添加OSD。在有足够的OSD来处理对象的副本数量之前，您的集群无法达到active + clean状态（例如，osd pool default size = 2需要至少两个OSD）。</p>
<p>引导monitor后，您的集群具有默认的CRUSH map，但是，CRUSH map没有映射到Ceph节点的任何Ceph OSD Daemons。</p>
<h3 id="SHORT-FORM（简写）"><a href="#SHORT-FORM（简写）" class="headerlink" title="SHORT FORM（简写）"></a>SHORT FORM（简写）</h3><p>Ceph提供了ceph-volume实用程序，它可以prepare logical volume，disk或partition，以便与ceph一起使用。 ceph-volume实用程序通过递增索引来创建OSD ID。 此外，ceph-volume会将新OSD添加到CRUSH map中的host下。执行ceph-volume -h以获取CLI详细信息。ceph-volume实用程序自动执行下面的<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/install/manual-deployment/#long-form">Long Form</a>的步骤。要使用short form过程创建前两个OSD，请在node2和node3上执行以下操作：</p>
<h3 id="BLUESTORE"><a href="#BLUESTORE" class="headerlink" title="BLUESTORE"></a>BLUESTORE</h3><p>1、创建OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;node-name&#125;</span><br><span class="line">sudo ceph-volume lvm create --data &#123;data-path&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh node1</span><br><span class="line">sudo ceph-volume lvm create --data &#x2F;dev&#x2F;hdd1</span><br></pre></td></tr></table></figure>
<p>或者，创建过程可以分为两个阶段（prepare和activate）：</p>
<p>1、Prepare the OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;node-name&#125;</span><br><span class="line">sudo ceph-volume lvm prepare --data &#123;data-path&#125; &#123;data-path&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh node1</span><br><span class="line">sudo ceph-volume lvm prepare --data &#x2F;dev&#x2F;hdd1</span><br></pre></td></tr></table></figure>
<p>prepare后，激活prepare后的OSD的ID和FSID。这些可以通过列出当前服务器中的OSD来获得：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-volume lvm list</span><br></pre></td></tr></table></figure>
<p>2、Activate the OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-volume lvm activate &#123;ID&#125; &#123;FSID&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-volume lvm activate 0 a7f64266-0894-4f1e-a635-d0aeaca0e993</span><br></pre></td></tr></table></figure>
<h3 id="FILESTORE"><a href="#FILESTORE" class="headerlink" title="FILESTORE"></a>FILESTORE</h3><p>1、Create the OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;node-name&#125;</span><br><span class="line">sudo ceph-volume lvm create --filestore --data &#123;data-path&#125; --journal &#123;journal-path&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh node1</span><br><span class="line">sudo ceph-volume lvm create --filestore --data &#x2F;dev&#x2F;hdd1 --journal &#x2F;dev&#x2F;hdd2</span><br></pre></td></tr></table></figure>
<p>或者，创建过程可以分为两个阶段（prepare和activate）：</p>
<p>1、Prepare the OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;node-name&#125;</span><br><span class="line">sudo ceph-volume lvm prepare --filestore --data &#123;data-path&#125; --journal &#123;journal-path&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh node1</span><br><span class="line">sudo ceph-volume lvm prepare --filestore --data &#x2F;dev&#x2F;hdd1 --journal &#x2F;dev&#x2F;hdd2</span><br></pre></td></tr></table></figure>
<p>prepare后，激活prepare后的OSD的ID和FSID。这些可以通过列出当前服务器中的OSD来获得：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-volume lvm list</span><br></pre></td></tr></table></figure>
<p>2、Activate the OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-volume lvm activate --filestore &#123;ID&#125; &#123;FSID&#125;</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ceph-volume lvm activate --filestore 0 a7f64266-0894-4f1e-a635-d0aeaca0e993</span><br></pre></td></tr></table></figure>
<h3 id="LONG-FORM"><a href="#LONG-FORM" class="headerlink" title="LONG FORM"></a>LONG FORM</h3><p>如果没有任何helper实用程序，请创建一个OSD并使用以下步骤将其添加到集群和CRUSH map中。要使用long form方式创建前两个OSD，请对每个OSD执行以下步骤。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：此过程没有描述使用dm-crypt“lockbox”在dm-crypt之上的部署。</span><br></pre></td></tr></table></figure>
<p>1、连接到OSD主机并变为root用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;node-name&#125;</span><br><span class="line">sudo bash</span><br></pre></td></tr></table></figure>
<p>2、为OSD生成UUID。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID&#x3D;$(uuidgen)</span><br></pre></td></tr></table></figure>
<p>3、为OSD生成cephx key。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OSD_SECRET&#x3D;$(ceph-authtool --gen-print-key)</span><br></pre></td></tr></table></figure>
<p>4、创建OSD。 请注意，如果您需要重用之前销毁的OSD ID，可以提供OSD ID作为ceph osd new的附加参数。我们假设机器上存在client.bootstrap-osd key。您也可以在拥有该key的其他主机上以client.admin身份执行此命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID&#x3D;$(echo &quot;&#123;\&quot;cephx_secret\&quot;: \&quot;$OSD_SECRET\&quot;&#125;&quot; | \</span><br><span class="line">   ceph osd new $UUID -i - \</span><br><span class="line">   -n client.bootstrap-osd -k &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring)</span><br></pre></td></tr></table></figure>
<p>也可以在JSON中包含crush_device_class属性，以设置默认值以外的initial class（基于自动检测到的设备类型，ssd或hdd）。</p>
<p>5、在新OSD上创建默认目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID</span><br></pre></td></tr></table></figure>
<p>6、如果OSD使用操作系统以外的drive，先创建文件系统，并将其mount到刚刚创建的目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs &#x2F;dev&#x2F;&#123;DEV&#125;</span><br><span class="line">mount &#x2F;dev&#x2F;&#123;DEV&#125; &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID</span><br></pre></td></tr></table></figure>
<p>7、将secret写入OSD keyring文件中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-authtool --create-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID&#x2F;keyring \</span><br><span class="line">     --name osd.$ID --add-key $OSD_SECRET</span><br></pre></td></tr></table></figure>
<p>8、初始化OSD数据目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph-osd -i $ID --mkfs --osd-uuid $UUID</span><br></pre></td></tr></table></figure>
<p>9、修复所有权。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R ceph:ceph &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID</span><br></pre></td></tr></table></figure>
<p>10、将OSD添加到Ceph后，OSD就在您的配置中。但是，它还没有运行。必须先启动新的OSD才能开始接收数据。</p>
<p>systemd方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable ceph-osd@$ID</span><br><span class="line">systemctl start ceph-osd@$ID</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable ceph-osd@12</span><br><span class="line">systemctl start ceph-osd@12</span><br></pre></td></tr></table></figure>
<h2 id="ADDING-MDS"><a href="#ADDING-MDS" class="headerlink" title="ADDING MDS"></a>ADDING MDS</h2><p>在以下说明中，{id}是任意名称，例如计算机的hostname。</p>
<p>1、创建mds数据目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;mds&#x2F;&#123;cluster-name&#125;-&#123;id&#125;</span><br></pre></td></tr></table></figure>
<p>2、创建一个keyring：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph-authtool --create-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;mds&#x2F;&#123;cluster-name&#125;-&#123;id&#125;&#x2F;keyring --gen-key -n mds.&#123;id&#125;</span><br></pre></td></tr></table></figure>
<p>3、导入keyring并设置caps：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph auth add mds.&#123;id&#125; osd &quot;allow rwx&quot; mds &quot;allow&quot; mon &quot;allow profile mds&quot; -i &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;mds&#x2F;&#123;cluster&#125;-&#123;id&#125;&#x2F;keyring</span><br></pre></td></tr></table></figure>
<p>4、添加到ceph.conf：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mds.&#123;id&#125;]</span><br><span class="line">host &#x3D; &#123;id&#125;</span><br></pre></td></tr></table></figure>
<p>5、以手动方式启动daemon：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph-mds --cluster &#123;cluster-name&#125; -i &#123;id&#125; -m &#123;mon-hostname&#125;:&#123;mon-port&#125; [-f]</span><br></pre></td></tr></table></figure>
<p>6、以正确的方式启动daemon（使用ceph.conf entry）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service ceph start</span><br></pre></td></tr></table></figure>
<p>7、如果启动daemon失败并显示以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mds.-1.0 ERROR: failed to authenticate: (22) Invalid argument</span><br></pre></td></tr></table></figure>
<p>那么，需要确认你没有在ceph.conf的global section中设置keyring；并将其移至client section。或添加特定于此mds daemon的keyring设置。并验证您是否在mds data目录中看到相同的key，并且与ceph auth get mds.{id}命令的输出相同。</p>
<p>8、现在您已准备好<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/cephfs/createfs/">创建Ceph filesystem</a>。</p>
<h2 id="SUMMARY"><a href="#SUMMARY" class="headerlink" title="SUMMARY"></a>SUMMARY</h2><p>一旦您的monitor和两个OSD启动并运行，可以通过执行以下操作来观察placement groups peer：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph -w</span><br></pre></td></tr></table></figure>
<p>要查看tree，请执行以下操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph osd tree</span><br></pre></td></tr></table></figure>
<p>你应该看到像这样的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># id    weight  type name       up&#x2F;down reweight</span><br><span class="line">-1      2       root default</span><br><span class="line">-2      2               host node1</span><br><span class="line">0       1                       osd.0   up      1</span><br><span class="line">-3      1               host node2</span><br><span class="line">1       1                       osd.1   up      1</span><br></pre></td></tr></table></figure>
<p>要添加（或删除）其他monitors，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/operations/add-or-rm-mons/">Add/Remove Monitors</a>。要添加（或删除）其他Ceph OSD Daemons，请参阅<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/operations/add-or-rm-osds/">Add/Remove OSDs</a>。</p>
<h1 id="部署实验"><a href="#部署实验" class="headerlink" title="部署实验"></a>部署实验</h1><h2 id="monitor部署实验"><a href="#monitor部署实验" class="headerlink" title="monitor部署实验"></a>monitor部署实验</h2><p>1、添加ceph源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# vi &#x2F;etc&#x2F;yum.repos.d&#x2F;ceph.repo </span><br><span class="line">[ceph]</span><br><span class="line">name&#x3D;Ceph</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;rpm-luminous&#x2F;el7&#x2F;x86_64&#x2F;</span><br><span class="line"># baseurl&#x3D;https:&#x2F;&#x2F;download.ceph.com&#x2F;rpm-luminous&#x2F;el7&#x2F;x86_64&#x2F;</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">type&#x3D;rpm-md</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;ceph&#x2F;keys&#x2F;release.asc</span><br><span class="line"># gpgkey&#x3D;https:&#x2F;&#x2F;download.ceph.com&#x2F;keys&#x2F;release.asc</span><br></pre></td></tr></table></figure>
<p>2、安装epel与ceph</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1]epel参考：https:&#x2F;&#x2F;blog.csdn.net&#x2F;yasi_xi&#x2F;article&#x2F;details&#x2F;11746255</span><br><span class="line">EPEL的全称叫 Extra Packages for Enterprise Linux 。EPEL是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。装上了 EPEL之后，就相当于添加了一个第三方源。</span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# yum install epel-release -y &amp;&amp; yum install ceph -y</span><br></pre></td></tr></table></figure>
<p>3、为集群创建keyring并生成monitor secret key。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# ceph-authtool --create-keyring &#x2F;tmp&#x2F;ceph.mon.keyring --gen-key -n mon. --cap mon &#39;allow *&#39;</span><br><span class="line">creating &#x2F;tmp&#x2F;ceph.mon.keyring</span><br><span class="line">[root@cephlm ~]# cat &#x2F;tmp&#x2F;ceph.mon.keyring</span><br><span class="line">[mon.]</span><br><span class="line">	key &#x3D; AQAgbv1bc62FBBAAvuCz2a5EDtbAmy9ep1Dxxw&#x3D;&#x3D;</span><br><span class="line">	caps mon &#x3D; &quot;allow *&quot;</span><br></pre></td></tr></table></figure>
<p>4、生成administrator keyring，生成client.admin用户并将用户添加到keyring。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# sudo ceph-authtool --create-keyring &#x2F;etc&#x2F;ceph&#x2F;ceph.client.admin.keyring --gen-key -n client.admin --cap mon &#39;allow *&#39; --cap osd &#39;allow *&#39; --cap mds &#39;allow *&#39; --cap mgr &#39;allow *&#39;</span><br><span class="line">creating &#x2F;etc&#x2F;ceph&#x2F;ceph.client.admin.keyring</span><br><span class="line">[root@cephlm ~]# cat &#x2F;etc&#x2F;ceph&#x2F;ceph.client.admin.keyring</span><br><span class="line">[client.admin]</span><br><span class="line">	key &#x3D; AQBFbv1bImaJCxAAYUiUCuia&#x2F;&#x2F;zZSMIPyOHJuA&#x3D;&#x3D;</span><br><span class="line">	caps mds &#x3D; &quot;allow *&quot;</span><br><span class="line">	caps mgr &#x3D; &quot;allow *&quot;</span><br><span class="line">	caps mon &#x3D; &quot;allow *&quot;</span><br><span class="line">	caps osd &#x3D; &quot;allow *&quot;</span><br></pre></td></tr></table></figure>
<p>5、生成bootstrap-osd keyring，生成client.bootstrap-osd用户并将用户添加到keyring。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# sudo ceph-authtool --create-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring --gen-key -n client.bootstrap-osd --cap mon &#39;profile bootstrap-osd&#39;</span><br><span class="line">creating &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring</span><br><span class="line">[root@cephlm ~]# cat &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring</span><br><span class="line">[client.bootstrap-osd]</span><br><span class="line">	key &#x3D; AQBQbv1bXv0WAhAAo&#x2F;hv7OOaftMHOovHNeyOFg&#x3D;&#x3D;</span><br><span class="line">	caps mon &#x3D; &quot;profile bootstrap-osd&quot;</span><br></pre></td></tr></table></figure>
<p>6、将生成的keys添加到ceph.mon.keyring。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# sudo ceph-authtool &#x2F;tmp&#x2F;ceph.mon.keyring --import-keyring &#x2F;etc&#x2F;ceph&#x2F;ceph.client.admin.keyring</span><br><span class="line">[root@cephlm ~]# sudo ceph-authtool &#x2F;tmp&#x2F;ceph.mon.keyring --import-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring</span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# cat &#x2F;tmp&#x2F;ceph.mon.keyring</span><br><span class="line">[mon.]</span><br><span class="line">	key &#x3D; AQAgbv1bc62FBBAAvuCz2a5EDtbAmy9ep1Dxxw&#x3D;&#x3D;</span><br><span class="line">	caps mon &#x3D; &quot;allow *&quot;</span><br><span class="line">[client.admin]</span><br><span class="line">	key &#x3D; AQBFbv1bImaJCxAAYUiUCuia&#x2F;&#x2F;zZSMIPyOHJuA&#x3D;&#x3D;</span><br><span class="line">	caps mds &#x3D; &quot;allow *&quot;</span><br><span class="line">	caps mgr &#x3D; &quot;allow *&quot;</span><br><span class="line">	caps mon &#x3D; &quot;allow *&quot;</span><br><span class="line">	caps osd &#x3D; &quot;allow *&quot;</span><br><span class="line">[client.bootstrap-osd]</span><br><span class="line">	key &#x3D; AQBQbv1bXv0WAhAAo&#x2F;hv7OOaftMHOovHNeyOFg&#x3D;&#x3D;</span><br><span class="line">	caps mon &#x3D; &quot;profile bootstrap-osd&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>7、使用主机名，主机IP地址和FSID生成monitor map。将其另存为/tmp/monmap。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# monmaptool --create --add cephlm 192.168.0.10 --fsid c8b0b137-1ba7-4c1f-a514-281139c35233 &#x2F;tmp&#x2F;monmap</span><br><span class="line">monmaptool: monmap file &#x2F;tmp&#x2F;monmap</span><br><span class="line">monmaptool: set fsid to c8b0b137-1ba7-4c1f-a514-281139c35233</span><br><span class="line">monmaptool: writing epoch 0 to &#x2F;tmp&#x2F;monmap (1 monitors)</span><br><span class="line"></span><br><span class="line">更改权限，可是使ceph用户有读该文件的权限</span><br><span class="line">[root@cephlm ~]# chmod +r &#x2F;tmp&#x2F;monmap &amp;&amp; chmod +r &#x2F;tmp&#x2F;ceph.mon.keyring</span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# monmaptool --print &#x2F;tmp&#x2F;monmap</span><br><span class="line">monmaptool: monmap file &#x2F;tmp&#x2F;monmap</span><br><span class="line">epoch 0</span><br><span class="line">fsid c8b0b137-1ba7-4c1f-a514-281139c35233</span><br><span class="line">last_changed 2018-11-28 10:55:11.677288</span><br><span class="line">created 2018-11-28 10:55:11.677288</span><br><span class="line">0: 192.168.56.205:6789&#x2F;0 mon.cephlm</span><br></pre></td></tr></table></figure>
<p>8、创建配置文件文件<code>&lt;集群名&gt;.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# vi &#x2F;etc&#x2F;ceph&#x2F;ceph.conf </span><br><span class="line">[global]</span><br><span class="line">fsid &#x3D; c8b0b137-1ba7-4c1f-a514-281139c35233</span><br><span class="line">mon initial members &#x3D; cephlm</span><br><span class="line">mon host &#x3D; 192.168.0.10</span><br><span class="line">public network &#x3D; 192.168.0.0&#x2F;24</span><br><span class="line">cluster network &#x3D; 192.168.0.0&#x2F;24</span><br><span class="line">auth cluster required &#x3D; cephx</span><br><span class="line">auth service required &#x3D; cephx</span><br><span class="line">auth client required &#x3D; cephx</span><br><span class="line">osd pool default size &#x3D; 1</span><br><span class="line">osd pool default min size &#x3D; 1</span><br><span class="line">osd pool default pg num &#x3D; 16</span><br><span class="line">osd pool default pgp num &#x3D; 16</span><br></pre></td></tr></table></figure>
<p>9、使用monitor map和keyring填充monitor daemon(s)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# sudo -u ceph ceph-mon --cluster ceph --mkfs -i cephlm --monmap &#x2F;tmp&#x2F;monmap --keyring &#x2F;tmp&#x2F;ceph.mon.keyring</span><br></pre></td></tr></table></figure>
<p>10、启动ceph-mon服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@cephlm ~]# systemctl enable ceph-mon@cephlm</span><br><span class="line">[root@cephlm ~]# systemctl start ceph-mon@cephlm</span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c8b0b137-1ba7-4c1f-a514-281139c35233</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 1 daemons, quorum cephlm</span><br><span class="line">    mgr: no daemons active</span><br><span class="line">    osd: 0 osds: 0 up, 0 in</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   0 pools, 0 pgs</span><br><span class="line">    objects: 0 objects, 0B</span><br><span class="line">    usage:   0B used, 0B &#x2F; 0B avail</span><br><span class="line">    pgs:     </span><br></pre></td></tr></table></figure>
<h2 id="osd部署实验"><a href="#osd部署实验" class="headerlink" title="osd部署实验"></a>osd部署实验</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br></pre></td><td class="code"><pre><span class="line">1、为OSD生成UUID。</span><br><span class="line">[root@cephlm ~]# UUID&#x3D;$(uuidgen)</span><br><span class="line">[root@cephlm ~]# echo $&#123;UUID&#125;</span><br><span class="line">265b6807-fa12-46f7-8e25-ce8b03dc2a2d</span><br><span class="line"></span><br><span class="line">2、为OSD生成cephx key。</span><br><span class="line">[root@cephlm ~]# OSD_SECRET&#x3D;$(ceph-authtool --gen-print-key)</span><br><span class="line">[root@cephlm ~]# echo $&#123;OSD_SECRET&#125;</span><br><span class="line">AQDljwhcB8MxBxAATx&#x2F;pqYOv0uRhQI9Tey5UeQ&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">3、为OSD生成cephx key（秘钥）。</span><br><span class="line">[root@cephlm ~]# ID&#x3D;$(echo &quot;&#123;\&quot;cephx_secret\&quot;: \&quot;$OSD_SECRET\&quot;&#125;&quot; | \</span><br><span class="line">     ceph osd new $UUID -i - \&#x2F;*</span><br><span class="line">     -n client.bootstrap-osd -k &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;bootstrap-osd&#x2F;ceph.keyring)</span><br><span class="line">[root@cephlm ~]# echo $&#123;ID&#125;</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">4、</span><br><span class="line">[root@cephlm ~]# mkdir &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID</span><br><span class="line"></span><br><span class="line">5、</span><br><span class="line">[root@cephlm ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">vda    253:0    0  20G  0 disk </span><br><span class="line">├─vda1 253:1    0   1G  0 part &#x2F;boot</span><br><span class="line">├─vda2 253:2    0   4G  0 part [SWAP]</span><br><span class="line">└─vda3 253:3    0  15G  0 part &#x2F;</span><br><span class="line">vdb    253:16   0  50G  0 disk </span><br><span class="line">vdc    253:32   0  50G  0 disk </span><br><span class="line">vdd    253:48   0  50G  0 disk </span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# ll &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x 2 root root 6 12月  6 11:03 ceph-0</span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# mkfs.xfs &#x2F;dev&#x2F;vdb -f</span><br><span class="line">meta-data&#x3D;&#x2F;dev&#x2F;vdb               isize&#x3D;512    agcount&#x3D;4, agsize&#x3D;3276800 blks</span><br><span class="line">         &#x3D;                       sectsz&#x3D;512   attr&#x3D;2, projid32bit&#x3D;1</span><br><span class="line">         &#x3D;                       crc&#x3D;1        finobt&#x3D;0, sparse&#x3D;0</span><br><span class="line">data     &#x3D;                       bsize&#x3D;4096   blocks&#x3D;13107200, imaxpct&#x3D;25</span><br><span class="line">         &#x3D;                       sunit&#x3D;0      swidth&#x3D;0 blks</span><br><span class="line">naming   &#x3D;version 2              bsize&#x3D;4096   ascii-ci&#x3D;0 ftype&#x3D;1</span><br><span class="line">log      &#x3D;internal log           bsize&#x3D;4096   blocks&#x3D;6400, version&#x3D;2</span><br><span class="line">         &#x3D;                       sectsz&#x3D;512   sunit&#x3D;0 blks, lazy-count&#x3D;1</span><br><span class="line">realtime &#x3D;none                   extsz&#x3D;4096   blocks&#x3D;0, rtextents&#x3D;0</span><br><span class="line"></span><br><span class="line">[root@cephlm ~]# mount &#x2F;dev&#x2F;vdb &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID&#x2F;</span><br><span class="line">[root@cephlm ~]# df -Th</span><br><span class="line">文件系统       类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">&#x2F;dev&#x2F;vda3      xfs        15G  1.6G   14G   11% &#x2F;</span><br><span class="line">devtmpfs       devtmpfs  1.9G     0  1.9G    0% &#x2F;dev</span><br><span class="line">tmpfs          tmpfs     1.9G     0  1.9G    0% &#x2F;dev&#x2F;shm</span><br><span class="line">tmpfs          tmpfs     1.9G  8.6M  1.9G    1% &#x2F;run</span><br><span class="line">tmpfs          tmpfs     1.9G     0  1.9G    0% &#x2F;sys&#x2F;fs&#x2F;cgroup</span><br><span class="line">&#x2F;dev&#x2F;vda1      xfs      1014M  172M  843M   17% &#x2F;boot</span><br><span class="line">tmpfs          tmpfs     379M     0  379M    0% &#x2F;run&#x2F;user&#x2F;0</span><br><span class="line">&#x2F;dev&#x2F;vdb       xfs        50G   33M   50G    1% &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-0</span><br><span class="line"></span><br><span class="line">6、将secret写入OSD keyring文件。</span><br><span class="line">[root@cephlm ~]# ceph-authtool --create-keyring &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID&#x2F;keyring --name osd.$ID --add-key $OSD_SECRET</span><br><span class="line">creating &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-0&#x2F;keyring</span><br><span class="line">added entity osd.0 auth auth(auid &#x3D; 18446744073709551615 key&#x3D;AQDljwhcB8MxBxAATx&#x2F;pqYOv0uRhQI9Tey5UeQ&#x3D;&#x3D; with 0 caps)</span><br><span class="line"></span><br><span class="line">7、初始化OSD数据目录</span><br><span class="line">[root@cephlm ~]# ceph-osd -i $ID --mkfs --osd-uuid $UUID</span><br><span class="line">2019-08-02 18:07:34.990087 7f41b6680d80 -1 journal FileJournal::_open: disabling aio for non-block journal.  Use journal_force_aio to force use of aio anyway</span><br><span class="line">2019-08-02 18:07:35.061501 7f41b6680d80 -1 journal FileJournal::_open: disabling aio for non-block journal.  Use journal_force_aio to force use of aio anyway</span><br><span class="line">2019-08-02 18:07:35.062969 7f41b6680d80 -1 journal do_read_entry(4096): bad header magic</span><br><span class="line">2019-08-02 18:07:35.062993 7f41b6680d80 -1 journal do_read_entry(4096): bad header magic</span><br><span class="line">2019-08-02 18:07:35.063581 7f41b6680d80 -1 read_settings error reading settings: (2) No such file or directory</span><br><span class="line">2019-08-02 18:07:35.146735 7f41b6680d80 -1 created object store &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-0 for osd.0 fsid c8b0b137-1ba7-4c1f-a514-281139c35233</span><br><span class="line"></span><br><span class="line">8、</span><br><span class="line">[root@cephlm ~]# chown -R ceph:ceph &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-$ID</span><br><span class="line"></span><br><span class="line">9、</span><br><span class="line">[root@cephlm ~]# systemctl enable ceph-osd@$ID</span><br><span class="line">[root@cephlm ~]# systemctl start ceph-osd@$ID</span><br><span class="line">10、</span><br><span class="line">[root@sds-ceph-1 ~]# ceph osd pool create rbd 16</span><br><span class="line">[root@sds-ceph-1 ~]# rados bench -p rbd 10 write --no-cleanup</span><br><span class="line"></span><br><span class="line">[root@sds-ceph-1 ~]# tree -h  &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-0&#x2F;current&#x2F;</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;ceph-0&#x2F;current&#x2F;</span><br><span class="line">├── [4.0K]  1.0_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject126__head_314B9110__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject138__head_F0F776D0__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject149__head_9DC23D60__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject154__head_03D0DB50__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject179__head_E33CA580__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject209__head_3BFDF2F0__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject211__head_DECF96B0__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject212__head_5CED1CF0__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject217__head_1319A430__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject220__head_524D4D00__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject229__head_F40C7DE0__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject22__head_1686F940__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject235__head_516A6B20__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject236__head_12CA1390__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject73__head_397FC990__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject77__head_ADAEA100__1</span><br><span class="line">│   └── [   0]  __head_00000000__1</span><br><span class="line">├── [   6]  1.0_TEMP</span><br><span class="line">├── [4.0K]  1.1_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject102__head_862AA4F1__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject129__head_F5965891__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject151__head_98E52B51__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject184__head_E52D8D41__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject1__head_F5F320A1__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject234__head_00E8BB81__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject244__head_2363F6E1__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject25__head_581DDE31__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject32__head_324147A1__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject35__head_34FABC91__1</span><br><span class="line">│   └── [   0]  __head_00000001__1</span><br><span class="line">├── [   6]  1.1_TEMP</span><br><span class="line">├── [4.0K]  1.2_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject104__head_413DA2B2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject117__head_C0124C02__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject125__head_9DBB0642__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject153__head_37933452__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject167__head_0AE2CE12__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject173__head_821A3292__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject175__head_734C3FB2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject180__head_74A8D2D2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject195__head_7A482B82__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject214__head_C62A3262__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject227__head_FBA5E8D2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject230__head_F81DABF2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject240__head_96D571D2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject251__head_8C210072__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject28__head_8D1859C2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject43__head_9D4243F2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject4__head_6D94E022__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject53__head_F31A17D2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject74__head_BA8C88D2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject93__head_26EE91D2__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject97__head_1025B4F2__1</span><br><span class="line">│   └── [   0]  __head_00000002__1</span><br><span class="line">├── [   6]  1.2_TEMP</span><br><span class="line">├── [4.0K]  1.3_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject114__head_C05EC3E3__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject145__head_BB9B5383__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject187__head_7F2D3B93__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject20__head_FB09C543__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject222__head_CA878AF3__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject223__head_45D47B63__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject249__head_EB2C03F3__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject2__head_E1BEFAD3__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject48__head_C2ABBF03__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject58__head_73A784F3__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject66__head_7D1C7D23__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject68__head_64431003__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject75__head_EFA44023__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject7__head_1EDC2B13__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject83__head_56DE9F23__1</span><br><span class="line">│   └── [   0]  __head_00000003__1</span><br><span class="line">├── [   6]  1.3_TEMP</span><br><span class="line">├── [4.0K]  1.4_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject0__head_F8BC28D4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject160__head_866C8F94__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject162__head_02475BD4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject164__head_26707F24__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject16__head_3B6FF704__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject174__head_ECF6CC74__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject18__head_7CB94CE4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject202__head_503B6AE4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject237__head_1AF8F074__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject247__head_A70993B4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject31__head_09DBA9F4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject36__head_ABBB7824__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject39__head_E1727904__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject3__head_E0FE6334__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject46__head_9E9B4204__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject51__head_8C1E0DC4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject56__head_7065C2F4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject62__head_DB32DD24__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject87__head_BDBE9FC4__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject90__head_A1654F74__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject96__head_FC6F33F4__1</span><br><span class="line">│   └── [   0]  __head_00000004__1</span><br><span class="line">├── [   6]  1.4_TEMP</span><br><span class="line">├── [4.0K]  1.5_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject118__head_7B842745__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject123__head_5CEFA465__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject183__head_10F85FE5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject186__head_3000C235__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject191__head_BC532EE5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject224__head_92A1E3C5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject29__head_027ADDC5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject67__head_5BDDDAA5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject82__head_A64A01D5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject8__head_F68FCDE5__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject94__head_ECE61315__1</span><br><span class="line">│   └── [   0]  __head_00000005__1</span><br><span class="line">├── [   6]  1.5_TEMP</span><br><span class="line">├── [4.0K]  1.6_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject121__head_3F39BC76__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject12__head_88A43B86__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject13__head_FD5483D6__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject141__head_CDACF3C6__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject157__head_E56D1786__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject197__head_804A2DC6__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject207__head_A3266F06__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject216__head_DE5D3A76__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject226__head_CAFCCF66__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject44__head_0544C586__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject45__head_65E3FAB6__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject61__head_A2704176__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject72__head_6E3BA9D6__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject80__head_1B1E6F16__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject85__head_A0756156__1</span><br><span class="line">│   └── [   0]  __head_00000006__1</span><br><span class="line">├── [   6]  1.6_TEMP</span><br><span class="line">├── [4.0K]  1.7_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject100__head_EF2E6867__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject139__head_5E961CE7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject142__head_01BCFCA7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject143__head_A3CDD177__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject144__head_74883667__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject158__head_F5DD1EA7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject165__head_031366F7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject168__head_9BE47967__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject169__head_E96B49F7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject182__head_7119D257__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject194__head_D3C65A17__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject250__head_E9F80417__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject41__head_9295C277__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject55__head_70B967B7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject78__head_367C2607__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject89__head_7CDE0FC7__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject98__head_96668A47__1</span><br><span class="line">│   └── [   0]  __head_00000007__1</span><br><span class="line">├── [   6]  1.7_TEMP</span><br><span class="line">├── [4.0K]  1.8_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject116__head_F4318178__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject128__head_32ED4D38__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject134__head_486DF128__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject156__head_F2E7C068__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject190__head_5AAF63A8__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject219__head_50799E88__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject225__head_9EB9D0C8__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject242__head_F2EC42B8__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject33__head_64C2C558__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject34__head_65F25F38__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject38__head_D38CB608__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject49__head_FF4A4208__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject50__head_0F3F77A8__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject52__head_0F2A0548__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject69__head_BDEA5548__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject71__head_EA5383B8__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject76__head_02238F98__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject88__head_45AB4318__1</span><br><span class="line">│   └── [   0]  __head_00000008__1</span><br><span class="line">├── [   6]  1.8_TEMP</span><br><span class="line">├── [4.0K]  1.9_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject110__head_CE2B10A9__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject136__head_04EDA809__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject163__head_37F8AE49__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject177__head_5F771509__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject193__head_23935A99__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject215__head_15DEBEA9__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject21__head_11518C29__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject248__head_FAFE5689__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject27__head_5B7D7369__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject60__head_64B13949__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject70__head_F3A64E09__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject91__head_31511109__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject99__head_8A68E509__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject9__head_FC52C009__1</span><br><span class="line">│   └── [   0]  __head_00000009__1</span><br><span class="line">├── [   6]  1.9_TEMP</span><br><span class="line">├── [4.0K]  1.a_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject112__head_FF4D01DA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject113__head_CADF065A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject119__head_A72F161A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject122__head_BF4A0A6A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject124__head_5BC12E2A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject140__head_37A19CDA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject14__head_64FC3EDA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject152__head_14C2CA0A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject166__head_C47A6B0A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject171__head_79A2CFEA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject17__head_2A4A393A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject185__head_1D2DDDDA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject188__head_7FBA73AA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject204__head_AB1FBD8A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject205__head_B24EE76A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject206__head_9891B01A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject208__head_C07981EA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject210__head_1227C4DA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject228__head_0B9B39AA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject238__head_C56F1D5A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject23__head_4F279EBA__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject26__head_CCB3C59A__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject86__head_5ED418EA__1</span><br><span class="line">│   └── [   0]  __head_0000000A__1</span><br><span class="line">├── [   6]  1.a_TEMP</span><br><span class="line">├── [4.0K]  1.b_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject103__head_F8EF0F1B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject107__head_F3693ABB__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject108__head_13D4D0EB__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject109__head_11C8A99B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject132__head_227AA5FB__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject137__head_5D82744B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject148__head_989FE31B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject159__head_422DA2AB__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject178__head_01C4C3CB__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject181__head_0DC3436B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject213__head_05B8BA6B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject246__head_2140121B__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject24__head_5B8169AB__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject64__head_CC62D71B__1</span><br><span class="line">│   └── [   0]  __head_0000000B__1</span><br><span class="line">├── [   6]  1.b_TEMP</span><br><span class="line">├── [4.0K]  1.c_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject101__head_7711D38C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject11__head_0218B38C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject127__head_9A51BCDC__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject133__head_7E6B67EC__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject135__head_C67A3E8C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject150__head_8635CA6C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject161__head_3A42EA3C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject170__head_612CFAFC__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject172__head_EB33BB8C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject196__head_475FC6BC__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject19__head_D21864EC__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject200__head_52F1139C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject201__head_14AC036C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject243__head_3E9C237C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject245__head_DABE713C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject5__head_7CE3E36C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject65__head_86389E8C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject6__head_1FBF833C__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject81__head_05B34FAC__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject92__head_3988A13C__1</span><br><span class="line">│   └── [   0]  __head_0000000C__1</span><br><span class="line">├── [   6]  1.c_TEMP</span><br><span class="line">├── [4.0K]  1.d_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject111__head_66CE6C0D__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject115__head_71F498AD__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject120__head_1BFD990D__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject130__head_301FC3CD__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject232__head_320DC13D__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject37__head_AC68B41D__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject40__head_423D9AAD__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject47__head_0951C33D__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject84__head_5EB447DD__1</span><br><span class="line">│   ├── [  24]  benchmark\\ulast\\umetadata__head_8E7A861D__1</span><br><span class="line">│   └── [   0]  __head_0000000D__1</span><br><span class="line">├── [   6]  1.d_TEMP</span><br><span class="line">├── [4.0K]  1.e_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject105__head_C439984E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject10__head_1BF35FCE__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject131__head_DBAC810E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject146__head_6153061E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject176__head_80C2B02E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject189__head_4F8A59BE__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject199__head_5ACCE8EE__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject203__head_D77F59BE__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject221__head_C3ADCA4E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject231__head_0C48675E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject233__head_F01E13EE__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject30__head_9464F9BE__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject54__head_B1E1B44E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject59__head_CE84DF4E__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject79__head_CAFFBC0E__1</span><br><span class="line">│   └── [   0]  __head_0000000E__1</span><br><span class="line">├── [   6]  1.e_TEMP</span><br><span class="line">├── [4.0K]  1.f_head</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject106__head_48E9311F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject147__head_7211B38F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject155__head_551133AF__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject15__head_58EF207F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject192__head_9E2A248F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject198__head_D7D45B1F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject218__head_F2A93B5F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject239__head_2FC0444F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject241__head_286B4E0F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject42__head_6FF5EA1F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject57__head_2A0A792F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject63__head_2685437F__1</span><br><span class="line">│   ├── [4.0M]  benchmark\\udata\\usds-ceph-1.novalocal\\u12560\\uobject95__head_1786F82F__1</span><br><span class="line">│   └── [   0]  __head_0000000F__1</span><br><span class="line">├── [   6]  1.f_TEMP</span><br><span class="line">├── [   4]  commit_op_seq</span><br><span class="line">├── [4.0K]  meta</span><br><span class="line">│   ├── [ 802]  inc\\uosdmap.1__0_B65F4306__none</span><br><span class="line">│   ├── [ 232]  inc\\uosdmap.2__0_B65F40D6__none</span><br><span class="line">│   ├── [ 635]  inc\\uosdmap.3__0_B65F4066__none</span><br><span class="line">│   ├── [ 763]  inc\\uosdmap.4__0_B65F4136__none</span><br><span class="line">│   ├── [ 406]  inc\\uosdmap.5__0_B65F46C6__none</span><br><span class="line">│   ├── [ 454]  inc\\uosdmap.6__0_B65F4796__none</span><br><span class="line">│   ├── [ 212]  inc\\uosdmap.7__0_B65F4726__none</span><br><span class="line">│   ├── [ 204]  inc\\uosdmap.8__0_B65F44F6__none</span><br><span class="line">│   ├── [ 598]  osdmap.1__0_FD6E49B1__none</span><br><span class="line">│   ├── [ 869]  osdmap.2__0_FD6E4941__none</span><br><span class="line">│   ├── [ 960]  osdmap.3__0_FD6E4E11__none</span><br><span class="line">│   ├── [1.1K]  osdmap.4__0_FD6E4FA1__none</span><br><span class="line">│   ├── [1.0K]  osdmap.5__0_FD6E4F71__none</span><br><span class="line">│   ├── [1.3K]  osdmap.6__0_FD6E4C01__none</span><br><span class="line">│   ├── [1.3K]  osdmap.7__0_FD6E4DD1__none</span><br><span class="line">│   ├── [1.3K]  osdmap.8__0_FD6E4D61__none</span><br><span class="line">│   ├── [ 511]  osd\\usuperblock__0_23C2FCDE__none</span><br><span class="line">│   └── [   0]  snapmapper__0_A468EC03__none</span><br><span class="line">├── [   0]  nosnap</span><br><span class="line">└── [ 179]  omap</span><br><span class="line">    ├── [1002]  000007.sst</span><br><span class="line">    ├── [208K]  000009.log</span><br><span class="line">    ├── [  16]  CURRENT</span><br><span class="line">    ├── [  37]  IDENTITY</span><br><span class="line">    ├── [   0]  LOCK</span><br><span class="line">    ├── [ 15K]  LOG</span><br><span class="line">    ├── [ 108]  MANIFEST-000008</span><br><span class="line">    ├── [4.1K]  OPTIONS-000008</span><br><span class="line">    ├── [4.1K]  OPTIONS-000011</span><br><span class="line">    └── [  37]  osd_uuid</span><br><span class="line"></span><br><span class="line">34 directories, 299 files</span><br><span class="line"></span><br><span class="line">[root@sds-ceph-1 ~]# rados ls -p rbd</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object77</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object220</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object179</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object22</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object235</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object149</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object229</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object126</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object73</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object236</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object154</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object138</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object217</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object211</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object212</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object209</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object49</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object38</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object219</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object52</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object69</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object225</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object134</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object190</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object50</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object156</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object88</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object76</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object33</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object128</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object34</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object242</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object71</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object116</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object46</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object39</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object16</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object51</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object87</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object36</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object62</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object164</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object18</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object202</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object160</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object0</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object162</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object3</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object247</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object237</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object174</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object90</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object56</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object31</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object96</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object65</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object135</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object101</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object11</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object172</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object81</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object150</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object201</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object5</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object19</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object133</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object200</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object127</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object161</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object92</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object245</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object6</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object196</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object243</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object170</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object117</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object195</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object125</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object28</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object4</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object214</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object167</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object173</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object153</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object74</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object227</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object180</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object93</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object240</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object53</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object104</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object175</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object251</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object97</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object43</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object230</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object152</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object166</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object204</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object124</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object228</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object188</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object122</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object205</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object86</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object208</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object171</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object206</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object119</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object26</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object113</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object238</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object210</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object140</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object14</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object112</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object185</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object17</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object23</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object207</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object44</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object12</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object157</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object197</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object141</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object226</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object80</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object85</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object72</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object13</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object45</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object121</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object216</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object61</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object79</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object131</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object105</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object54</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object221</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object59</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object10</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object176</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object199</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object233</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object146</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object231</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object189</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object203</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object30</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object234</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object184</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object1</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object32</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object244</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object129</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object35</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object151</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object25</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object102</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object9</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object136</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object70</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object91</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object99</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object177</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object248</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object163</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object60</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object21</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object110</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object215</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object27</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object193</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object118</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object29</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object224</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object67</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object123</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object191</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object8</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object183</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object94</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object82</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object186</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object111</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object120</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object130</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object115</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object40</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object37</span><br><span class="line">benchmark_last_metadata</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object84</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object232</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object47</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object68</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object48</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object145</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object20</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object75</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object66</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object83</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object223</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object114</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object7</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object187</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object2</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object58</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object222</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object249</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object137</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object178</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object159</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object24</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object213</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object181</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object108</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object246</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object148</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object64</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object103</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object109</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object107</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object132</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object78</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object98</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object89</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object142</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object158</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object100</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object144</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object168</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object139</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object250</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object194</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object182</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object55</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object41</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object143</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object165</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object169</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object241</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object192</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object147</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object239</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object95</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object57</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object155</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object42</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object106</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object198</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object218</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object15</span><br><span class="line">benchmark_data_sds-ceph-1.novalocal_12560_object63</span><br><span class="line"></span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/24/deploy-k8s-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/24/deploy-k8s-test/" class="post-title-link" itemprop="url">deploy k8s test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-24 17:09:30" itemprop="dateCreated datePublished" datetime="2018-11-24T17:09:30+08:00">2018-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>部署kubernetes有多种方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、不借助任何工具，从基本的CLI操作开始部署k8s集群，可以学习k8s各个组件</span><br><span class="line">	https:&#x2F;&#x2F;github.com&#x2F;kelseyhightower&#x2F;kubernetes-the-hard-way</span><br><span class="line">2、部署单节点k8s集群，适合快速学习</span><br><span class="line">	https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;minikube</span><br><span class="line">3、部署多节点k8s集群</span><br><span class="line">	https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubeadm</span><br><span class="line">4、在cloud上部署k8s集群</span><br><span class="line">	https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kops</span><br><span class="line">5、coreos的工具，大于十个节点收费，小于等于十个节点免费</span><br><span class="line">	https:&#x2F;&#x2F;coreos.com&#x2F;tectonic&#x2F;</span><br><span class="line">6、实验环境</span><br><span class="line">	https:&#x2F;&#x2F;labs.play-with-k8s.com&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="安装minikube"><a href="#安装minikube" class="headerlink" title="安装minikube"></a>安装minikube</h1><h2 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">1、安装kubectl，文档https:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;tasks&#x2F;tools&#x2F;install-kubectl&#x2F;</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ brew install kubernetes-cli</span><br><span class="line"></span><br><span class="line">2、安装minikube，文档https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;minikube&#x2F;releases</span><br><span class="line">0.32.0版本在minikube start时遇到了Starting cluster components失败，在网上查找资料需要降级0.25.2。如果想使用新版本，还是找台虚拟机试一下。</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ curl -Lo minikube https:&#x2F;&#x2F;storage.googleapis.com&#x2F;minikube&#x2F;releases&#x2F;v0.25.2&#x2F;minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo cp minikube &#x2F;usr&#x2F;local&#x2F;bin&#x2F; &amp;&amp; rm minikube</span><br><span class="line"></span><br><span class="line">如果已经安装了0.32.0版本的minikube，降级方法请看链接：https:&#x2F;&#x2F;coding.m.imooc.com&#x2F;questiondetail.html?qid&#x3D;57784</span><br><span class="line"></span><br><span class="line">3、安装virtualbox</span><br><span class="line"></span><br><span class="line">4、启动minikube单节点k8s(https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;a7620f73c7f3)</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ minikube start </span><br><span class="line">Starting local Kubernetes v1.9.4 cluster...</span><br><span class="line">Starting VM...</span><br><span class="line">Getting VM IP address...</span><br><span class="line">Moving files into cluster...</span><br><span class="line">Setting up certs...</span><br><span class="line">Connecting to cluster...</span><br><span class="line">Setting up kubeconfig...</span><br><span class="line">Starting cluster components...</span><br><span class="line">Kubectl is now configured to use the cluster.</span><br><span class="line">Loading cached images from config file.</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;以下为测试，有坑，不需要执行。</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ rm -rf ~&#x2F;.minikube&#x2F;machines&#x2F;minikube&#x2F;</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ minikube start</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ minikube start --kubernetes-version v1.8.0 --bootstrapper kubeadm</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;以上为测试，有坑，不需要执行。</span><br><span class="line"></span><br><span class="line">minikube start命令创建一个名为“minikube”的“kubectl context”。这个context包含与Minikube群集通信的配置。Minikube会自动将此context设置为默认值，但如果您以后需要切换回它，请运行：kubectl config use-context minikube,或者传递每个命令的context，如下所示：kubectl get pods --context&#x3D;minikube。可以使用不同的context连接不同的k8s集群。</span><br><span class="line"></span><br><span class="line">查看当前config</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ kubectl config view</span><br><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    certificate-authority: &#x2F;Users&#x2F;yujiang&#x2F;.minikube&#x2F;ca.crt</span><br><span class="line">    server: https:&#x2F;&#x2F;192.168.99.101:8443</span><br><span class="line">  name: minikube</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: minikube</span><br><span class="line">    user: minikube</span><br><span class="line">  name: minikube</span><br><span class="line">current-context: minikube</span><br><span class="line">kind: Config</span><br><span class="line">preferences: &#123;&#125;</span><br><span class="line">users:</span><br><span class="line">- name: minikube</span><br><span class="line">  user:</span><br><span class="line">    client-certificate: &#x2F;Users&#x2F;yujiang&#x2F;.minikube&#x2F;client.crt</span><br><span class="line">    client-key: &#x2F;Users&#x2F;yujiang&#x2F;.minikube&#x2F;client.key</span><br><span class="line"></span><br><span class="line">查看当前context</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ kubectl config get-contexts</span><br><span class="line">CURRENT   NAME       CLUSTER    AUTHINFO   NAMESPACE</span><br><span class="line">*         minikube   minikube   minikube   </span><br><span class="line"></span><br><span class="line">查看当前k8s集群情况</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ kubectl cluster-info</span><br><span class="line">Kubernetes master is running at https:&#x2F;&#x2F;192.168.99.100:8443</span><br><span class="line"></span><br><span class="line">进入minikube虚拟机</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ minikube ssh</span><br><span class="line"></span><br><span class="line">设置代理（ss-ng），否则无法pull docker镜像(https:&#x2F;&#x2F;blog.zhesih.com&#x2F;2018&#x2F;06&#x2F;24&#x2F;k8s-minikube-setup&#x2F;)</span><br><span class="line">$ sudo vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d&#x2F;http-proxy.conf</span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">$ sudo systemctl restart docker</span><br><span class="line">$ systemctl show --property&#x3D;Environment docker</span><br><span class="line">Environment&#x3D;DOCKER_RAMDISK&#x3D;yes HTTP_PROXY&#x3D;http:&#x2F;&#x2F;192.168.199.165:1087 HTTPS_PROXY&#x3D;https:&#x2F;&#x2F;192.168.199.165:1087</span><br></pre></td></tr></table></figure>
<h3 id="实验一（kind-Pod）"><a href="#实验一（kind-Pod）" class="headerlink" title="实验一（kind: Pod）"></a>实验一（kind: Pod）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">Pod是k8s调度的最小单位，一个Pod中可以有多个Container</span><br><span class="line">1、创建一个Pod</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ cat pod_nginx.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">        name: nginx</span><br><span class="line">        labels:</span><br><span class="line">                app: nginx</span><br><span class="line">spec:</span><br><span class="line">        containers:</span><br><span class="line">        - name: nginx</span><br><span class="line">          image: nginx</span><br><span class="line">          ports:</span><br><span class="line">          - containerPort: 80</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl create -f pod_nginx.yml </span><br><span class="line">pod&#x2F;nginx created</span><br><span class="line"></span><br><span class="line">2、查看Pod</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pod --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">default       nginx                                   1&#x2F;1     Running   0          20m</span><br><span class="line">kube-system   kube-addon-manager-minikube             1&#x2F;1     Running   8          60m</span><br><span class="line">kube-system   kube-dns-54cccfbdf8-kr847               3&#x2F;3     Running   12         57m</span><br><span class="line">kube-system   kubernetes-dashboard-77d8b98585-vq77b   1&#x2F;1     Running   4          57m</span><br><span class="line">kube-system   storage-provisioner                     1&#x2F;1     Running   5          57m</span><br><span class="line"></span><br><span class="line">3、查看Pod的详细信息，可以看到Pod运行在哪台机器上</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pods -o wide</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx   1&#x2F;1     Running   0          31m   172.17.0.2   minikube   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">4、打开dashboard</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ minikube dashboard</span><br><span class="line"></span><br><span class="line">5、查询nginx IP</span><br><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">fb08befd952b        bridge              bridge              local</span><br><span class="line">2de0a434731f        host                host                local</span><br><span class="line">4cd7f4c7083c        none                null                local</span><br><span class="line"></span><br><span class="line">$ docker network inspect bridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;fb08befd952b4448e86e491f271a1e6a50056b5a18bdfb8a3e930edde2ac44da&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-12-24T17:23:11.618994916Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;25e63a3ff8a091319fdec698f554f1b47c3e019fbdda9b06709d15630003ee6e&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;k8s_POD_kube-dns-54cccfbdf8-kr847_kube-system_69d32f1a-0799-11e9-be08-080027bea66e_8&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;004b9a81ab36cd4e0aba21572b4736b8d85d5541c3533571a67383e5d07e34b6&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;4138eeb8348781495987d47f6683138515111d2b6afa6fc7352d5f98d4a0858b&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;k8s_POD_kubernetes-dashboard-77d8b98585-vq77b_kube-system_69b46ed4-0799-11e9-be08-080027bea66e_8&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;bb31db755c5a5cd8f36bec35d89c73267d3d283ba8caa691b58ba504b0d6fabc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.4&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;6874ee85f9257b5b0dfdf808ebf92df9c3c677079a778980956e4655abf23507&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;k8s_POD_nginx_default_9e0d9ffc-079e-11e9-be08-080027bea66e_0&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;040a5616a76665ff9e35bb6cef2388f8db443b2db94b67282a7496b9803acc20&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2&#x2F;16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ curl 172.17.0.2</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;&#x2F;title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;nginx.org&#x2F;&quot;&gt;nginx.org&lt;&#x2F;a&gt;.&lt;br&#x2F;&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;nginx.com&#x2F;&quot;&gt;nginx.com&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">6、指定Pod名，进入Container(默认进入第1个Container)。如果Pod中有多个Container，可以加&quot;-c&quot;参数指定进入哪个Container。</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl exec -it nginx sh</span><br><span class="line"></span><br><span class="line">7、打印nginx Pod的详细信息</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl describe pod nginx</span><br><span class="line"></span><br><span class="line">8、怎样把nginx的端口映射出来？</span><br><span class="line">有两种方法：</span><br><span class="line">	(1)port-forward</span><br><span class="line">		yujiangdeMBP-13:k8s_yaml yujiang$ kubectl port-forward nginx 8080:80</span><br><span class="line">		打开浏览器：http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="实验二（kind-ReplicationController）"><a href="#实验二（kind-ReplicationController）" class="headerlink" title="实验二（kind: ReplicationController）"></a>实验二（kind: ReplicationController）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ cat rc_nginx.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ReplicationController</span><br><span class="line">metadata:</span><br><span class="line">        name: nginx</span><br><span class="line">spec:</span><br><span class="line">        replicas: 3</span><br><span class="line">        selector:</span><br><span class="line">                app: nginx</span><br><span class="line">        template:</span><br><span class="line">                metadata:</span><br><span class="line">                        name: nginx</span><br><span class="line">                        labels:</span><br><span class="line">                                app: nginx</span><br><span class="line">                spec:</span><br><span class="line">                        containers:</span><br><span class="line">                        - name: nginx</span><br><span class="line">                          image: nginx</span><br><span class="line">                          ports:</span><br><span class="line">                          - containerPort: 80</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl create -f rc_nginx.yml </span><br><span class="line">replicationcontroller&#x2F;nginx created</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pod </span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-prlfw   1&#x2F;1     Running   0          19s</span><br><span class="line">nginx-szrh8   1&#x2F;1     Running   0          19s</span><br><span class="line">nginx-z59kd   1&#x2F;1     Running   0          19s</span><br><span class="line"></span><br><span class="line"># 修改横向扩展数量</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl scale rc nginx --replicas&#x3D;2</span><br><span class="line">replicationcontroller&#x2F;nginx scaled</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pods</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-szrh8   1&#x2F;1     Running   1          21h</span><br><span class="line">nginx-z59kd   1&#x2F;1     Running   1          21h</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get rc</span><br><span class="line">NAME    DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx   2         2         2       21h</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pods -o wide</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx-szrh8   1&#x2F;1     Running   1          21h   172.17.0.4   minikube   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-z59kd   1&#x2F;1     Running   1          21h   172.17.0.6   minikube   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>
<h3 id="实验三（kind-ReplicaSet）"><a href="#实验三（kind-ReplicaSet）" class="headerlink" title="实验三（kind: ReplicaSet）"></a>实验三（kind: ReplicaSet）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: ReplicaSet</span><br><span class="line">metadata:</span><br><span class="line">        name: nginx</span><br><span class="line">        labels:</span><br><span class="line">                tier: frontend</span><br><span class="line">spec:</span><br><span class="line">        replicas: 3</span><br><span class="line">        selector:</span><br><span class="line">                matchLabels:</span><br><span class="line">                        tier: frontend</span><br><span class="line">        template:</span><br><span class="line">                metadata:</span><br><span class="line">                        name: nginx</span><br><span class="line">                        labels:</span><br><span class="line">                                tier: frontend</span><br><span class="line">                spec:</span><br><span class="line">                        containers:</span><br><span class="line">                        - name: nginx</span><br><span class="line">                          image: nginx</span><br><span class="line">                          ports:</span><br><span class="line">                          - containerPort: 80</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl create -f rs_nginx.yml </span><br><span class="line">replicaset.apps&#x2F;nginx created</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get rs</span><br><span class="line">NAME    DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx   3         3         3       52s</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pods</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-brtzk   1&#x2F;1     Running   0          81s</span><br><span class="line">nginx-m5xgq   1&#x2F;1     Running   0          81s</span><br><span class="line">nginx-qvdq6   1&#x2F;1     Running   0          81s</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl scale rs nginx --replicas&#x3D;2</span><br><span class="line">replicaset.extensions&#x2F;nginx scaled</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get rs</span><br><span class="line">NAME    DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx   2         2         2       2m32s</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="实验四（kind-Deployment）"><a href="#实验四（kind-Deployment）" class="headerlink" title="实验四（kind: Deployment）"></a>实验四（kind: Deployment）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ cat deployment_nginx.yml </span><br><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">        name: nginx-deployment</span><br><span class="line">        labels:</span><br><span class="line">                app: nginx</span><br><span class="line">spec:</span><br><span class="line">        replicas: 3</span><br><span class="line">        selector:</span><br><span class="line">                matchLabels:</span><br><span class="line">                        app: nginx</span><br><span class="line">        template:</span><br><span class="line">                metadata:</span><br><span class="line">                        labels:</span><br><span class="line">                                app: nginx</span><br><span class="line">                spec:</span><br><span class="line">                        containers:</span><br><span class="line">                                - name: nginx</span><br><span class="line">                                  image: nginx:1.12.2</span><br><span class="line">                                  ports:</span><br><span class="line">                                  - containerPort: 80</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl create -f deployment_nginx.yml</span><br><span class="line">deployment.apps&#x2F;nginx-deployment created</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get deployment</span><br><span class="line">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deployment   3&#x2F;3     3            3           5m31s</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get rs</span><br><span class="line">NAME                         DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-deployment-9898d9674   3         3         3       6m6s</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pods</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deployment-9898d9674-2mrdl   1&#x2F;1     Running   0          6m31s</span><br><span class="line">nginx-deployment-9898d9674-ndblx   1&#x2F;1     Running   0          6m31s</span><br><span class="line">nginx-deployment-9898d9674-t8ngw   1&#x2F;1     Running   0          6m31s</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get deployment -o wide</span><br><span class="line">NAME               READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES         SELECTOR</span><br><span class="line">nginx-deployment   3&#x2F;3     3            3           7m31s   nginx        nginx:1.12.2   app&#x3D;nginx</span><br><span class="line"></span><br><span class="line"># 更新nginx</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl set image deployment nginx-deployment nginx&#x3D;nginx:1.13</span><br><span class="line">deployment.extensions&#x2F;nginx-deployment image updated</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get deployment</span><br><span class="line">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deployment   3&#x2F;3     3            3           12m</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get deployment -o wide</span><br><span class="line">NAME               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES       SELECTOR</span><br><span class="line">nginx-deployment   3&#x2F;3     3            3           12m   nginx        nginx:1.13   app&#x3D;nginx</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get rs</span><br><span class="line">NAME                         DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-deployment-9898d9674   0         0         0       13m</span><br><span class="line">nginx-deployment-d8d99448f   3         3         3       3m42s</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get pods</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deployment-d8d99448f-fzfdw   1&#x2F;1     Running   0          3m59s</span><br><span class="line">nginx-deployment-d8d99448f-l8m8w   1&#x2F;1     Running   0          72s</span><br><span class="line">nginx-deployment-d8d99448f-pbnml   1&#x2F;1     Running   0          73s</span><br><span class="line"></span><br><span class="line"># 回滚到上一次更新前</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl rollout history deployment nginx-deployment</span><br><span class="line">deployment.extensions&#x2F;nginx-deployment </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl rollout undo deployment nginx-deployment</span><br><span class="line">deployment.extensions&#x2F;nginx-deployment rolled back</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get deployment -o wide</span><br><span class="line">NAME               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR</span><br><span class="line">nginx-deployment   3&#x2F;3     3            3           15m   nginx        nginx:1.12.2   app&#x3D;nginx</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl rollout history deployment nginx-deployment</span><br><span class="line">deployment.extensions&#x2F;nginx-deployment </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">3         &lt;none&gt;</span><br><span class="line"></span><br><span class="line"># 暴露nginx Container端口到宿主机(node节点)</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get node -o wide</span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE            KERNEL-VERSION   CONTAINER-RUNTIME</span><br><span class="line">minikube   Ready    &lt;none&gt;   23h   v1.9.4    192.168.99.100   &lt;none&gt;        Buildroot 2017.11   4.9.64           docker:&#x2F;&#x2F;17.9.0</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl expose deployment nginx-deployment --type&#x3D;NodePort </span><br><span class="line">service&#x2F;nginx-deployment exposed</span><br><span class="line">yujiangdeMBP-13:k8s_yaml yujiang$ kubectl get svc</span><br><span class="line">NAME               TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes         ClusterIP   10.96.0.1     &lt;none&gt;        443&#x2F;TCP        23h</span><br><span class="line">nginx-deployment   NodePort    10.98.51.33   &lt;none&gt;        80:30233&#x2F;TCP   68s</span><br><span class="line"># 打开浏览器http:&#x2F;&#x2F;192.168.99.100:30233&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="实验五（kubectl自动补全）"><a href="#实验五（kubectl自动补全）" class="headerlink" title="实验五（kubectl自动补全）"></a>实验五（kubectl自动补全）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;tasks&#x2F;tools&#x2F;install-kubectl&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a>kubeadm</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"># 1、创建kubernetes虚拟机，并关闭防火墙，关闭SELinux(所有节点执行)</span><br><span class="line">systemctl disable firewalld.service &amp;&amp; systemctl stop firewalld.service</span><br><span class="line">setenforce 0</span><br><span class="line"># 2、</span><br><span class="line">cat &lt;&lt;EOF &gt;  &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sysctl --system</span><br><span class="line"></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">yum install -y https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;docker-ce-selinux-17.03.1.ce-1.el7.centos.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum install -y docker-ce-&lt;17.03.1.ce-1.el7.centos&gt; </span><br><span class="line"></span><br><span class="line">systemctl enable docker.service</span><br><span class="line">systemctl start docker.service</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name&#x3D;Kubernetes</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">repo_gpgcheck&#x3D;0</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg</span><br><span class="line">http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y kubelet-1.11.0-0 kubeadm-1.11.0-0 kubectl-1.11.0-0</span><br><span class="line">systemctl enable kubelet.service</span><br><span class="line">systemctl start kubelet.service</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;kubelet</span><br><span class="line">KUBELET_EXTRA_ARGS&#x3D;&quot;--cgroup-driver&#x3D;cgroupfs --pod-infra-container-image&#x3D;registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;pause-amd64:3.1&quot;</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kubelet.service</span><br><span class="line"></span><br><span class="line">docker pull quay.io&#x2F;calico&#x2F;typha:v0.7.4</span><br><span class="line">docker pull quay.io&#x2F;calico&#x2F;node:v3.1.3</span><br><span class="line">docker pull quay.io&#x2F;calico&#x2F;cni:v3.1.3</span><br><span class="line"></span><br><span class="line">vi kubeadm-master.config</span><br><span class="line">apiVersion: kubeadm.k8s.io&#x2F;v1alpha2</span><br><span class="line">kind: MasterConfiguration</span><br><span class="line">kubernetesVersion: v1.11.0</span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers</span><br><span class="line">api:</span><br><span class="line">  advertiseAddress: &lt;10.0.90.217&gt;</span><br><span class="line">controllerManagerExtraArgs:</span><br><span class="line">  node-monitor-grace-period: 10s</span><br><span class="line">  pod-eviction-timeout: 10s</span><br><span class="line">networking:</span><br><span class="line">  podSubnet: &lt;10.211.0.0&gt;&#x2F;16</span><br><span class="line">  serviceSubnet: &lt;10.96.0.0&gt;&#x2F;16</span><br><span class="line">kubeProxy:</span><br><span class="line">  config:</span><br><span class="line">    mode: iptables</span><br><span class="line"></span><br><span class="line">kubeadm config images pull --config kubeadm-master.config</span><br><span class="line"></span><br><span class="line"># 执行此CLI会输出token，需要保存该token</span><br><span class="line">kubeadm init --config kubeadm-master.config</span><br><span class="line">kubeadm reset</span><br><span class="line">swapoff -a</span><br><span class="line">sudo systemctl status kubelet.service</span><br><span class="line"></span><br><span class="line">kubectl get pod --all-namespaces -o wide</span><br><span class="line"></span><br><span class="line">添加node</span><br><span class="line">kubeadm join 192.168.56.201:6443 --token mzbbw0.5z6zpgauylva58na --discovery-token-ca-cert-hash sha256:932a24f271bd2c14cb41d6698e9781c1fcede848b7b9fe4a0731b9c54f275df2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Vagrantfile"><a href="#Vagrantfile" class="headerlink" title="Vagrantfile"></a>Vagrantfile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMacBook-Pro-13:docker-k8s yujiang$ cat Vagrantfile </span><br><span class="line"># -*- mode: ruby -*-</span><br><span class="line"># vi: set ft&#x3D;ruby :</span><br><span class="line"></span><br><span class="line">Vagrant.require_version &quot;&gt;&#x3D; 1.6.0&quot;</span><br><span class="line">boxes &#x3D; [</span><br><span class="line">    &#123;</span><br><span class="line">        :name &#x3D;&gt; &quot;k8s-node-1&quot;,</span><br><span class="line">        :eth1 &#x3D;&gt; &quot;192.168.56.61&quot;,</span><br><span class="line">        :mem &#x3D;&gt; &quot;2048&quot;,</span><br><span class="line">        :cpu &#x3D;&gt; &quot;2&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        :name &#x3D;&gt; &quot;k8s-node-2&quot;,</span><br><span class="line">        :eth1 &#x3D;&gt; &quot;192.168.56.62&quot;,</span><br><span class="line">        :mem &#x3D;&gt; &quot;2048&quot;,</span><br><span class="line">        :cpu &#x3D;&gt; &quot;2&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Vagrant.configure(2) do |config|</span><br><span class="line">    config.vm.box &#x3D; &quot;centos&#x2F;centos7&quot;</span><br><span class="line">    boxes.each do |opts|</span><br><span class="line">        config.vm.define opts[:name] do |config|</span><br><span class="line">            config.vm.hostname &#x3D; opts[:name]</span><br><span class="line">            config.vm.provider &quot;vmware_fusion&quot; do |v|</span><br><span class="line">                v.vmx[&quot;memsize&quot;] &#x3D; opts[:mem]</span><br><span class="line">                v.vmx[&quot;numvcpus&quot;] &#x3D; opts[:cpu]</span><br><span class="line">            end</span><br><span class="line">    </span><br><span class="line">            config.vm.provider &quot;virtualbox&quot; do |v|</span><br><span class="line">                v.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, opts[:mem]]</span><br><span class="line">                v.customize [&quot;modifyvm&quot;, :id, &quot;--cpus&quot;, opts[:cpu]]</span><br><span class="line">            end</span><br><span class="line">            config.vm.network :private_network, ip:opts[:eth1]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class="line">	# install dependent</span><br><span class="line">	systemctl disable firewalld.service &amp;&amp; systemctl stop firewalld.service &amp;&amp; setenforce 0</span><br><span class="line">	sed -i &quot;s&#x2F;\(SELINUX&#x3D;\).*&#x2F;\1disabled&#x2F;g&quot; &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">	# close swapoff</span><br><span class="line"> 	swapoff -a</span><br><span class="line"></span><br><span class="line">	# install docker</span><br><span class="line">	cat &lt;&lt;-&#39;EOF&#39; &gt;  &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line">	net.bridge.bridge-nf-call-ip6tables &#x3D; 1</span><br><span class="line">	net.bridge.bridge-nf-call-iptables &#x3D; 1</span><br><span class="line">	net.ipv4.ip_forward &#x3D; 1</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	modprobe br_netfilter</span><br><span class="line">	sysctl -p &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line"></span><br><span class="line">	yum install -y ipset ipvsadm</span><br><span class="line">	cat &lt;&lt;-&#39;EOF&#39; &gt; &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</span><br><span class="line">	\#!&#x2F;bin&#x2F;bash</span><br><span class="line">	modprobe -- ip_vs</span><br><span class="line">	modprobe -- ip_vs_rr</span><br><span class="line">	modprobe -- ip_vs_wrr</span><br><span class="line">	modprobe -- ip_vs_sh</span><br><span class="line">	modprobe -- nf_conntrack_ipv4</span><br><span class="line">	EOF</span><br><span class="line">	chmod 755 &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules &amp;&amp; bash &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line">	yum install -y yum-utils device-mapper-persistent-data lvm2 &amp;&amp; yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo &amp;&amp; yum makecache &amp;&amp; yum install -y https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;docker-ce-selinux-17.03.1.ce-1.el7.centos.noarch.rpm &amp;&amp; yum install -y docker-ce-17.03.1.ce-1.el7.centos</span><br><span class="line">	systemctl enable docker.service &amp;&amp; systemctl start docker.service</span><br><span class="line">	</span><br><span class="line">	# install k8s</span><br><span class="line">	cat &lt;&lt;-&#39;EOF&#39; &gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo</span><br><span class="line">	[kubernetes]</span><br><span class="line">	name&#x3D;Kubernetes</span><br><span class="line">	baseurl&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64</span><br><span class="line">	enabled&#x3D;1</span><br><span class="line">	gpgcheck&#x3D;0</span><br><span class="line">	repo_gpgcheck&#x3D;0</span><br><span class="line">	gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg</span><br><span class="line">	http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg</span><br><span class="line">	EOF</span><br><span class="line"></span><br><span class="line">	yum install -y kubelet-1.11.0-0 kubeadm-1.11.0-0 kubectl-1.11.0-0</span><br><span class="line">	</span><br><span class="line">	cat &lt;&lt;-&#39;EOF&#39; &gt; &#x2F;etc&#x2F;sysconfig&#x2F;kubelet</span><br><span class="line">	KUBELET_EXTRA_ARGS&#x3D;&quot;--cgroup-driver&#x3D;cgroupfs --pod-infra-container-image&#x3D;registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;pause-amd64:3.1&quot;</span><br><span class="line">	EOF</span><br><span class="line">	</span><br><span class="line">	systemctl enable kubelet.service &amp;&amp; systemctl start kubelet.service</span><br><span class="line"></span><br><span class="line">	docker pull quay.io&#x2F;calico&#x2F;typha:v0.7.4</span><br><span class="line">	docker pull quay.io&#x2F;calico&#x2F;node:v3.1.3</span><br><span class="line">	docker pull quay.io&#x2F;calico&#x2F;cni:v3.1.3</span><br><span class="line"></span><br><span class="line">    SHELL</span><br><span class="line">end</span><br></pre></td></tr></table></figure>















      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/11/13/nginx-rtmp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/13/nginx-rtmp/" class="post-title-link" itemprop="url">nginx rtmp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-13 22:47:28" itemprop="dateCreated datePublished" datetime="2018-11-13T22:47:28+08:00">2018-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">克隆nginx项目与nginx-rtmp-module</span><br><span class="line"></span><br><span class="line">[root@cephJ ~]# yum install gcc pcre-devel openssl-devel epel-release -y</span><br><span class="line"></span><br><span class="line">[root@cephJ ~]# rpm --import http:&#x2F;&#x2F;li.nux.ro&#x2F;download&#x2F;nux&#x2F;RPM-GPG-KEY-nux.ro</span><br><span class="line">[root@cephJ ~]# rpm -Uvh http:&#x2F;&#x2F;li.nux.ro&#x2F;download&#x2F;nux&#x2F;dextop&#x2F;el7&#x2F;x86_64&#x2F;nux-dextop-release-0-5.el7.nux.noarch.rpm</span><br><span class="line">[root@cephJ ~]# yum -y install ffmpeg ffmpeg-devel</span><br><span class="line"></span><br><span class="line">[root@cephJ ~]# cd github&#x2F;</span><br><span class="line">[root@cephJ github]# git clone https:&#x2F;&#x2F;github.com&#x2F;nginx&#x2F;nginx.git</span><br><span class="line">[root@cephJ github]# cd nginx</span><br><span class="line">[root@cephJ github]# git checkout -b myrelease-1.15.6 release-1.15.6</span><br><span class="line"></span><br><span class="line">[root@cephJ github]# git clone https:&#x2F;&#x2F;github.com&#x2F;arut&#x2F;nginx-rtmp-module.git</span><br><span class="line">[root@cephJ github]# cd nginx-rtmp-module</span><br><span class="line">[root@cephJ github]# git checkout -b myv1.2.1 v1.2.1</span><br><span class="line"></span><br><span class="line">[root@cephJ ~]# tree github&#x2F; -L 1</span><br><span class="line">github&#x2F;</span><br><span class="line">├── nginx</span><br><span class="line">└── nginx-rtmp-module</span><br><span class="line"></span><br><span class="line">[root@cephJ ~]# cd github&#x2F;nginx</span><br><span class="line">[root@cephJ nginx]# .&#x2F;auto&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;bin&#x2F; --add-module&#x3D;..&#x2F;nginx-rtmp-module&#x2F; --with-http_ssl_module --with-debug</span><br><span class="line">[root@cephJ nginx]# make -j 8</span><br><span class="line">[root@cephJ nginx]# make install</span><br></pre></td></tr></table></figure>


<h2 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@cephJ ~]# vim &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line"># 添加如下配置</span><br><span class="line">rtmp &#123;                          # RTMP服务</span><br><span class="line">   server &#123;</span><br><span class="line">       listen 1935;             # 服务端口</span><br><span class="line">       chunk_size 4096;         # 数据传输块的大小</span><br><span class="line">       application vod &#123;</span><br><span class="line">           play &#x2F;root&#x2F;videos&#x2F;;  # 视频文件存放位置</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动nginx</span><br><span class="line">[root@cephJ ~]# &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</span><br><span class="line">[root@cephJ ~]# ps -ef | grep nginx</span><br><span class="line">root     20015     1  0 11:24 ?        00:00:00 nginx: master process &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</span><br><span class="line">nobody   20016 20015  0 11:24 ?        00:00:00 nginx: worker process</span><br><span class="line">root     20019 12686  0 11:24 pts&#x2F;2    00:00:00 grep --color&#x3D;auto nginx</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="FFmpeg"><a href="#FFmpeg" class="headerlink" title="FFmpeg"></a>FFmpeg</h3><p>FFmpeg 是一个库和工具的集合，用于处理多媒体，如音频、视频、字幕和相关元数据。（FF指的是Fast Forward ——快速前进）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">相关链接：</span><br><span class="line">【1】https:&#x2F;&#x2F;zh.wikipedia.org&#x2F;wiki&#x2F;FFmpeg</span><br><span class="line">【2】https:&#x2F;&#x2F;github.com&#x2F;FFmpeg&#x2F;FFmpeg</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/10/29/Generic-Block-Device-Tuning-Parameters-read-ahead-kb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/29/Generic-Block-Device-Tuning-Parameters-read-ahead-kb/" class="post-title-link" itemprop="url">Generic Block Device Tuning Parameters - read_ahead_kb</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-29 15:09:41" itemprop="dateCreated datePublished" datetime="2018-10-29T15:09:41+08:00">2018-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:35" itemprop="dateModified" datetime="2020-03-22T16:16:35+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>read_ahead_kb</li>
</ul>
<p>定义sequential read operation期间OS可以预读的最大千字节数（kb）。因此，可能需要的信息已存在于kernel page cache中，以便进行下一次sequential read，从而提高read I/O性能。</p>
<p>Device mappers通常受益于高read_ahead_kb值。每个要mapped的设备128 KB是一个很好的起点，但将read_ahead_kb值增加到4-8 MB可能会提高sequential read大文件应用程序的性能。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/10/28/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/28/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">慕课网-使用Beego构建完整web项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-28 16:25:42" itemprop="dateCreated datePublished" datetime="2018-10-28T16:25:42+08:00">2018-10-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="课程介绍"><a href="#课程介绍" class="headerlink" title="课程介绍"></a>课程介绍</h2><ul>
<li>go语言简介</li>
<li>beego框架介绍</li>
<li>beego环境搭建</li>
<li>应用实践 —— 看图猜电影项目</li>
<li>项目部署与发布</li>
<li>项目总结</li>
</ul>
<h2 id="go简介"><a href="#go简介" class="headerlink" title="go简介"></a>go简介</h2><ul>
<li>语法简明紧凑<ul>
<li>语法一致</li>
<li>噪音少</li>
</ul>
</li>
<li>简洁的并发<ul>
<li>go在语言级并发抽象</li>
<li>简洁优雅</li>
</ul>
</li>
<li>执行速度与开发效率兼优<ul>
<li>编译型语言</li>
<li>语法简明</li>
</ul>
</li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="beego安装"><a href="#beego安装" class="headerlink" title="beego安装"></a>beego安装</h3><ul>
<li>beego的安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:~ yujiang$ go get -u -v github.com&#x2F;astaxie&#x2F;beego</span><br></pre></td></tr></table></figure>
<ul>
<li>bee工具安装</li>
</ul>
<p>bee工具是什么？</p>
<p>​    一个工具包，为了协助快速开发beego项目而创建的项目。（beego项目创建、热编译、开发测试、部署）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:~ yujiang$ go get -u -v github.com&#x2F;beego&#x2F;bee</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:~ yujiang$ bee version</span><br><span class="line">______</span><br><span class="line">| ___ \</span><br><span class="line">| |_&#x2F; &#x2F;  ___   ___</span><br><span class="line">| ___ \ &#x2F; _ \ &#x2F; _ \</span><br><span class="line">| |_&#x2F; &#x2F;|  __&#x2F;|  __&#x2F;</span><br><span class="line">\____&#x2F;  \___| \___| v1.10.0</span><br><span class="line"></span><br><span class="line">├── Beego     : 1.10.1</span><br><span class="line">├── GoVersion : go1.10</span><br><span class="line">├── GOOS      : darwin</span><br><span class="line">├── GOARCH    : amd64</span><br><span class="line">├── NumCPU    : 4</span><br><span class="line">├── GOPATH    : &#x2F;Users&#x2F;yujiang&#x2F;go</span><br><span class="line">├── GOROOT    : &#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line">├── Compiler  : gc</span><br><span class="line">└── Date      : Sunday, 28 Oct 2018</span><br></pre></td></tr></table></figure>
<h2 id="beego框架介绍"><a href="#beego框架介绍" class="headerlink" title="beego框架介绍"></a>beego框架介绍</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li><p>快速开发</p>
</li>
<li><p>MVC架构</p>
</li>
<li><p>文档齐全，社区活跃</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-framework.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-cache.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-config.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-context.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-httplibs.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-logs.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-%E5%85%B6%E4%BB%96.png"></p>
<h2 id="bee工具应用"><a href="#bee工具应用" class="headerlink" title="bee工具应用"></a>bee工具应用</h2><ul>
<li><p>bee new：新建项目结构</p>
</li>
<li><p>bee run：自动编译部署</p>
</li>
<li><p>bee generate：自动生成代码</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:~ yujiang$ bee new imooc</span><br><span class="line">yujiangdeMBP-13:imooc yujiang$ bee run</span><br><span class="line">浏览器输入 http:&#x2F;&#x2F;localhost:8080&#x2F;</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:imooc yujiang$ tree</span><br><span class="line">.</span><br><span class="line">├── conf</span><br><span class="line">│   └── app.conf</span><br><span class="line">├── controllers</span><br><span class="line">│   └── default.go</span><br><span class="line">├── main.go</span><br><span class="line">├── models</span><br><span class="line">├── routers</span><br><span class="line">│   └── router.go</span><br><span class="line">├── static</span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── img</span><br><span class="line">│   └── js</span><br><span class="line">│       └── reload.min.js</span><br><span class="line">├── tests</span><br><span class="line">│   └── default_test.go</span><br><span class="line">└── views</span><br><span class="line">    └── index.tpl</span><br><span class="line"></span><br><span class="line">10 directories, 7 files</span><br></pre></td></tr></table></figure>
<h3 id="beego项目运行基本流程"><a href="#beego项目运行基本流程" class="headerlink" title="beego项目运行基本流程"></a>beego项目运行基本流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">文件 - main.go</span><br><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">	_ &quot;imooc&#x2F;routers&quot;	&#x2F;&#x2F; _表示只执行imooc&#x2F;routers的init()函数</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">	beego.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">文件 - routers&#x2F;router.go</span><br><span class="line">package routers</span><br><span class="line">import (</span><br><span class="line">	&quot;imooc&#x2F;controllers&quot;</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&quot;</span><br><span class="line">)</span><br><span class="line">func init() &#123;</span><br><span class="line">	&#x2F;&#x2F; </span><br><span class="line">    beego.Router(&quot;&#x2F;&quot;, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">文件 - controllers&#x2F;default.go</span><br><span class="line">package controllers</span><br><span class="line">import (</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&quot;</span><br><span class="line">)</span><br><span class="line">type MainController struct &#123;</span><br><span class="line">	beego.Controller</span><br><span class="line">&#125;</span><br><span class="line">func (c *MainController) Get() &#123;</span><br><span class="line">	&#x2F;&#x2F; 这里就是处理get请求的逻辑</span><br><span class="line">	c.Data[&quot;Website&quot;] &#x3D; &quot;beego.me&quot;	&#x2F;&#x2F; 向模板传递的数据</span><br><span class="line">	c.Data[&quot;Email&quot;] &#x3D; &quot;astaxie@gmail.com&quot;	&#x2F;&#x2F; 向模板传递的数据</span><br><span class="line">	c.TplName &#x3D; &quot;index.tpl&quot;  &#x2F;&#x2F; 渲染的模板文件</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beego通过浏览器传递参数的方法：（http:&#x2F;&#x2F;localhost:8080&#x2F;?name&#x3D;&quot;yujiang&quot;）</span><br><span class="line">package controllers</span><br><span class="line">import (</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&quot;</span><br><span class="line">)</span><br><span class="line">type MainController struct &#123;</span><br><span class="line">	beego.Controller</span><br><span class="line">&#125;</span><br><span class="line">func (c *MainController) Get() &#123;</span><br><span class="line">	name :&#x3D; c.GetString(&quot;name&quot;)</span><br><span class="line">	&#x2F;&#x2F;c.Data[&quot;Website&quot;] &#x3D; &quot;beego.me&quot;</span><br><span class="line">	c.Data[&quot;Website&quot;] &#x3D; name</span><br><span class="line">	c.Data[&quot;Email&quot;] &#x3D; &quot;astaxie@gmail.com&quot;</span><br><span class="line">	c.TplName &#x3D; &quot;index.tpl&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="beego如何进行数据交互"><a href="#beego如何进行数据交互" class="headerlink" title="beego如何进行数据交互"></a>beego如何进行数据交互</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install mariadb-server -y</span><br><span class="line">[root@localhost ~]# systemctl start mariadb</span><br><span class="line">[root@localhost ~]# systemctl enable mariadb</span><br><span class="line">[root@localhost ~]# mysql -u root -p</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database imooc;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; use imooc;</span><br><span class="line">MariaDB [imooc]&gt; CREATE TABLE &#96;user&#96; ( &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT, &#96;name&#96; varchar(128) NOT NULL DEFAULT &#39;&#39;, &#96;gender&#96; tinyint(4) NOT NULL DEFAULT &#39;0&#39;, &#96;age&#96; int(11) NOT NULL DEFAULT &#39;0&#39;, PRIMARY KEY (&#96;id&#96;) )ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [imooc]&gt; INSERT INTO user (name,gender,age) values(&#39;zhangsan&#39;,1,21);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">MariaDB [imooc]&gt; INSERT INTO user (name,gender,age) values(&#39;lisi&#39;,0,22);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">MariaDB [imooc]&gt; INSERT INTO user (name,gender,age) values(&#39;wangwu&#39;,1,20);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [imooc]&gt; select * from user;</span><br><span class="line">+----+----------+--------+-----+</span><br><span class="line">| id | name     | gender | age |</span><br><span class="line">+----+----------+--------+-----+</span><br><span class="line">|  1 | zhangsan |      1 |  21 |</span><br><span class="line">|  2 | lisi     |      0 |  22 |</span><br><span class="line">|  3 | wangwu   |      1 |  20 |</span><br><span class="line">+----+----------+--------+-----+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">生成代码</span><br><span class="line">yujiangdeMBP-13:imooc yujiang$ bee generate scaffold user -fields&#x3D;&quot;id:int64,name:string,gender:int,age:int&quot; -driver&#x3D;mysql -conn&#x3D;&quot;root:@tcp(192.168.56.101:3306)&#x2F;imooc&quot;</span><br><span class="line">______</span><br><span class="line">| ___ \</span><br><span class="line">| |_&#x2F; &#x2F;  ___   ___</span><br><span class="line">| ___ \ &#x2F; _ \ &#x2F; _ \</span><br><span class="line">| |_&#x2F; &#x2F;|  __&#x2F;|  __&#x2F;</span><br><span class="line">\____&#x2F;  \___| \___| v1.10.0</span><br><span class="line">2018&#x2F;10&#x2F;28 19:30:25 INFO     ▶ 0001 Do you want to create a &#39;user&#39; model? [Yes|No] </span><br><span class="line">Yes</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:34 INFO     ▶ 0002 Using &#39;User&#39; as model name</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:34 INFO     ▶ 0003 Using &#39;models&#39; as package name</span><br><span class="line">	create	 &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;models&#x2F;user.go</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:34 INFO     ▶ 0004 Do you want to create a &#39;user&#39; controller? [Yes|No] </span><br><span class="line">Yes</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:43 INFO     ▶ 0005 Using &#39;User&#39; as controller name</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:43 INFO     ▶ 0006 Using &#39;controllers&#39; as package name</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:43 INFO     ▶ 0007 Using matching model &#39;User&#39;</span><br><span class="line">	create	 &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;controllers&#x2F;user.go</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:43 INFO     ▶ 0008 Do you want to create views for this &#39;user&#39; resource? [Yes|No] </span><br><span class="line">Yes</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:52 INFO     ▶ 0009 Generating view...</span><br><span class="line">	create	 &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;views&#x2F;user&#x2F;index.tpl</span><br><span class="line">	create	 &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;views&#x2F;user&#x2F;show.tpl</span><br><span class="line">	create	 &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;views&#x2F;user&#x2F;create.tpl</span><br><span class="line">	create	 &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;views&#x2F;user&#x2F;edit.tpl</span><br><span class="line">2018&#x2F;10&#x2F;28 19:31:52 INFO     ▶ 0010 Do you want to create a &#39;user&#39; migration and schema for this resource? [Yes|No] </span><br><span class="line">No</span><br><span class="line">2018&#x2F;10&#x2F;28 19:32:11 INFO     ▶ 0011 Do you want to migrate the database? [Yes|No] </span><br><span class="line">No</span><br><span class="line">2018&#x2F;10&#x2F;28 19:32:13 SUCCESS  ▶ 0012 All done! Don&#39;t forget to add  beego.Router(&quot;&#x2F;user&quot; ,&amp;controllers.UserController&#123;&#125;) to routers&#x2F;route.go</span><br><span class="line"></span><br><span class="line">2018&#x2F;10&#x2F;28 19:32:13 SUCCESS  ▶ 0013 Scaffold successfully generated!</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:imooc yujiang$ tree</span><br><span class="line">.</span><br><span class="line">├── conf</span><br><span class="line">│   └── app.conf</span><br><span class="line">├── controllers</span><br><span class="line">│   ├── default.go</span><br><span class="line">│   └── user.go</span><br><span class="line">├── imooc</span><br><span class="line">├── main.go</span><br><span class="line">├── models</span><br><span class="line">│   └── user.go</span><br><span class="line">├── routers</span><br><span class="line">│   └── router.go</span><br><span class="line">├── static</span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── img</span><br><span class="line">│   └── js</span><br><span class="line">│       └── reload.min.js</span><br><span class="line">├── tests</span><br><span class="line">│   └── default_test.go</span><br><span class="line">└── views</span><br><span class="line">    ├── index.tpl</span><br><span class="line">    └── user</span><br><span class="line">        ├── create.tpl</span><br><span class="line">        ├── edit.tpl</span><br><span class="line">        ├── index.tpl</span><br><span class="line">        └── show.tpl</span><br><span class="line"></span><br><span class="line">11 directories, 14 files</span><br></pre></td></tr></table></figure>
<p>安装<code>go-sql-driver</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:~ yujiang$ go get -v -u github.com&#x2F;go-sql-driver&#x2F;mysql</span><br><span class="line"></span><br><span class="line">文件 - routers&#x2F;router.go</span><br><span class="line">package routers</span><br><span class="line">import (</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&quot;</span><br><span class="line">	&quot;imooc&#x2F;controllers&quot;</span><br><span class="line">)</span><br><span class="line">func init() &#123;</span><br><span class="line">	&#x2F;&#x2F;beego.Router(&quot;&#x2F;&quot;, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">	beego.Include(&amp;controllers.UserController&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">文件 - main.go</span><br><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">	_ &quot;imooc&#x2F;routers&quot;</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&quot;</span><br><span class="line">	&quot;github.com&#x2F;astaxie&#x2F;beego&#x2F;orm&quot;</span><br><span class="line">	_ &quot;github.com&#x2F;go-sql-driver&#x2F;mysql&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">	orm.RegisterDataBase(&quot;default&quot;,&quot;mysql&quot;,&quot;root:root@tcp(192.168.56.101:3306)&#x2F;imooc&quot;)</span><br><span class="line">	beego.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:imooc yujiang$ bee run</span><br><span class="line">______</span><br><span class="line">| ___ \</span><br><span class="line">| |_&#x2F; &#x2F;  ___   ___</span><br><span class="line">| ___ \ &#x2F; _ \ &#x2F; _ \</span><br><span class="line">| |_&#x2F; &#x2F;|  __&#x2F;|  __&#x2F;</span><br><span class="line">\____&#x2F;  \___| \___| v1.10.0</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:44 INFO     ▶ 0001 Using &#39;imooc&#39; as &#39;appname&#39;</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:44 INFO     ▶ 0002 Initializing watcher...</span><br><span class="line">imooc</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:46 SUCCESS  ▶ 0003 Built Successfully!</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:46 INFO     ▶ 0004 Restarting &#39;imooc&#39;...</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:46 SUCCESS  ▶ 0005 &#39;.&#x2F;imooc&#39; is running...</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:46.697 [I] [router.go:269]  &#x2F;Users&#x2F;yujiang&#x2F;go&#x2F;src&#x2F;imooc&#x2F;controllers no changed</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:46.719 [I] [asm_amd64.s:2361]  http server Running on http:&#x2F;&#x2F;:8080</span><br><span class="line">2018&#x2F;10&#x2F;28 20:31:55.475 [D] [server.go:2694]  |            ::1| 200 |   3.979416ms|   match| GET      &#x2F;     r:&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-database.png"></p>
<h2 id="应用实践"><a href="#应用实践" class="headerlink" title="应用实践"></a>应用实践</h2><p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-project-1.png"></p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/%E6%85%95%E8%AF%BE%E7%BD%91-%E4%BD%BF%E7%94%A8Beego%E6%9E%84%E5%BB%BA%E5%AE%8C%E6%95%B4web%E9%A1%B9%E7%9B%AE/beego-project-2.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/10/16/The-Ceph-Benchmarking-Tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/16/The-Ceph-Benchmarking-Tool/" class="post-title-link" itemprop="url">The Ceph Benchmarking Tool</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-16 22:22:17" itemprop="dateCreated datePublished" datetime="2018-10-16T22:22:17+08:00">2018-10-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CBT-The-Ceph-Benchmarking-Tool"><a href="#CBT-The-Ceph-Benchmarking-Tool" class="headerlink" title="CBT - The Ceph Benchmarking Tool"></a>CBT - The Ceph Benchmarking Tool</h1><h2 id="INTRODUCTION（介绍）"><a href="#INTRODUCTION（介绍）" class="headerlink" title="INTRODUCTION（介绍）"></a>INTRODUCTION（介绍）</h2><p>CBT是一个用python编写的测试工具，可以自动执行并测试Ceph集群性能相关的任务。CBT不安装Ceph软件包，这应该在使用CBT之前完成。CBT可以在测试运行开始时创建 OSDs，也可以在测试运行期间重新创建OSD，或者只针对现有集群运行。CBT使用collectl记录系统指标，它可以选择使用perf，blktrace和valgrind在内的多种工具收集更多信息。除基本基准测试外，CBT还可以进行高级测试，包括自动OSD中断，erasure coded pools和cache tier配置。主要基准模块解释如下。</p>
<h3 id="radosbench"><a href="#radosbench" class="headerlink" title="radosbench"></a>radosbench</h3><p>RADOS基准测试使用ceph-common软件包附带的rados二进制文件。它包含一个基准测试工具，它通过librados来运行集群，librados是Ceph提供的底层object storage API。目前，RADOS基准模块为每个client创建一个pool。</p>
<h3 id="librbdfio"><a href="#librbdfio" class="headerlink" title="librbdfio"></a>librbdfio</h3><p>librbdfio基准模块是测试Ceph集群的块存储性能的最简单方法。最新版本的flexible IO tester (fio)提供了RBD引擎。这允许fio通过用户态librbd库测试RBD volumes的块存储性能，而无需配置KVM/QEMU。这些库与QEMU后端使用的库相同，因此它很近似于KVM/QEMU性能。</p>
<h3 id="kvmrbdfio"><a href="#kvmrbdfio" class="headerlink" title="kvmrbdfio"></a>kvmrbdfio</h3><p>kvmrbdfio基准测试使用flexible IO tester (fio) 来运行已attache到KVM instance的RBD volume。它要求在使用CBT之前创建instance，并attache RBD volumes。此模块用于对通过Cinder创建的RBD并attache到OpenStack instance进行基准测试。或者，可以使用Vagrant或Virtual Machine Manager来提供instance。</p>
<h3 id="rbdfio"><a href="#rbdfio" class="headerlink" title="rbdfio"></a>rbdfio</h3><p>rbdfio基准测试使用flexible IO tester (fio) 来执行使用KRBD内核驱动映射到块设备的RBD volume。此模块最适用于模拟需要直接使用块设备的应用程序，而不是在虚拟机内运行。</p>
<h2 id="PREREQUISITES（必备条件）"><a href="#PREREQUISITES（必备条件）" class="headerlink" title="PREREQUISITES（必备条件）"></a>PREREQUISITES（必备条件）</h2><p>CBT使用多个库和工具来运行：</p>
<ol>
<li>python-yaml - 用于读取配置文件的python的YAML库。</li>
<li>python-lxml - 功能强大的Pythonic XML处理库，将libxml2/libxslt与ElementTree API相结合</li>
<li>ssh (and scp) - 远程安全命令执行和数据传输</li>
<li>pdsh (and pdcp) - 并行ssh和scp实现</li>
<li>ceph - 可扩展的分布式存储系统</li>
</ol>
<p>请注意，目前没有为基于RHEL7和CentOS 7发行版的pdsh。这些RPM包可在此处获得：</p>
<ul>
<li><a href="ftp://rpmfind.net/linux/fedora/linux/releases/23/Everything/x86_64/os/Packages/p/pdsh-2.31-4.fc23.x86_64.rpm">ftp://rpmfind.net/linux/fedora/linux/releases/23/Everything/x86_64/os/Packages/p/pdsh-2.31-4.fc23.x86_64.rpm</a></li>
<li><a href="ftp://rpmfind.net/linux/fedora/linux/releases/23/Everything/x86_64/os/Packages/p/pdsh-rcmd-rsh-2.31-4.fc23.x86_64.rpm">ftp://rpmfind.net/linux/fedora/linux/releases/23/Everything/x86_64/os/Packages/p/pdsh-rcmd-rsh-2.31-4.fc23.x86_64.rpm</a></li>
<li><a href="ftp://rpmfind.net/linux/fedora/linux/releases/23/Everything/x86_64/os/Packages/p/pdsh-rcmd-ssh-2.31-4.fc23.x86_64.rpm">ftp://rpmfind.net/linux/fedora/linux/releases/23/Everything/x86_64/os/Packages/p/pdsh-rcmd-ssh-2.31-4.fc23.x86_64.rpm</a></li>
</ul>
<p>如果需要，可以使用可选工具和基准：</p>
<ol>
<li>collectl - 系统数据收集</li>
<li>blktrace - 块设备IO跟踪</li>
<li>seekwatcher - 通过blktrace数据创建图表</li>
<li>perf - 系统和进程分析</li>
<li>valgrind - 特定进程的runtime memory和cpu分析</li>
<li>fio - 基准suite，集成了posix，libaio和librbd的支持</li>
<li>cosbench - Intel的对象存储基准</li>
</ol>
<h2 id="USER-AND-NODE-SETUP（用户和节点设置）"><a href="#USER-AND-NODE-SETUP（用户和节点设置）" class="headerlink" title="USER AND NODE SETUP（用户和节点设置）"></a>USER AND NODE SETUP（用户和节点设置）</h2><p>除上述软件外，还必须有许多节点才能运行测试。这些节点可以划分为多个类别。多个类别可以包含相同的host，如果它承担多个角色（例如，运行OSD和mon）。</p>
<ol>
<li>head - 运行常规ceph命令的节点</li>
<li>clients - 运行基准测试或其他客户端工具的节点</li>
<li>osds - OSD存在的节点</li>
<li>rgws - rgw servers节点</li>
<li>mons - mons节点</li>
</ol>
<p>还可以指定用户运行所有远程命令。用于运行cbt的主机必须能够以指定用户身份发出无密码ssh命令。这可以通过创建无密码ssh密钥来完成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa</span><br></pre></td></tr></table></figure>
<p>并将<del>/.ssh中生成的公钥复制到所有远程主机上的</del>/.ssh/authorized_key文件中。</p>
<p>此用户还必须能够使用sudo运行某些命令。实现此目的的最简单方法是为该用户简单地启用全局无密码sudo访问，但这仅适用于实验室环境。这可以通过运行visudo并添加如下内容来实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># passwordless sudo for cbt</span><br><span class="line">&lt;user&gt;    ALL&#x3D;(ALL)       NOPASSWD:ALL</span><br></pre></td></tr></table></figure>
<p>其中<code>&lt;user&gt;</code>是将具有密码sudo访问权限的用户。</p>
<p>有关具体细节，请参阅操作系统文档。</p>
<p>除了上述内容之外，还需要将所有osds和mons添加到ssh的已知主机列表中（/etc/hosts文件）才能正常执行。 否则，基准测试将无法运行。</p>
<p>请注意，如果sudoers文件需要tty，则pdsh命令可能会有困难。如果是这种情况，推荐在visudo中添加<code>Defaults requiretty</code>行。</p>
<h2 id="DISK-PARTITIONING（磁盘分区）"><a href="#DISK-PARTITIONING（磁盘分区）" class="headerlink" title="DISK PARTITIONING（磁盘分区）"></a>DISK PARTITIONING（磁盘分区）</h2><p>目前，CBT为Ceph OSD data和journal分区在/dev/disk/by-partlabel中寻找指定分区labels。在未来的某个时刻，这将变得更加灵活，因为现在这是预期的行为。每个OSD主机分区应该用下面的gpt labels指定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">osd-device-&lt;num&gt;-data</span><br><span class="line">osd-device-&lt;num&gt;-journal</span><br></pre></td></tr></table></figure>
<p>其<code>&lt;num&gt;</code>是从0开始并以系统上最后一个设备结束的device序列。目前，cbt假设系统中的所有节点具有相同数量的device。有一个脚本可以显示我们在测试环境中如何创建分区labels的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;ceph&#x2F;cbt&#x2F;blob&#x2F;master&#x2F;tools&#x2F;mkpartmagna.sh</span><br></pre></td></tr></table></figure>
<h2 id="CREATING-A-YAML-FILE（创建一个YAML文件）"><a href="#CREATING-A-YAML-FILE（创建一个YAML文件）" class="headerlink" title="CREATING A YAML FILE（创建一个YAML文件）"></a>CREATING A YAML FILE（创建一个YAML文件）</h2><p>CBT yaml文件具有一个基本结构，您可以在其中定义一个cluster和一组针对它运行的基准测试。例如, 下面的 yaml 文件在具有主机名  “burnupiX “ 的节点上创建单节点群集。使用256个PG为1x replication pool定义pool的配置文件，并且该pool用于使用带有librbd引擎的fio运行RBD性能测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cluster:</span><br><span class="line">  user: &#39;nhm&#39;</span><br><span class="line">  head: &quot;burnupiX&quot;</span><br><span class="line">  clients: [&quot;burnupiX&quot;]</span><br><span class="line">  osds: [&quot;burnupiX&quot;]</span><br><span class="line">  mons:</span><br><span class="line">    burnupiX:</span><br><span class="line">      a: &quot;127.0.0.1:6789&quot;</span><br><span class="line">  osds_per_node: 1</span><br><span class="line">  fs: &#39;xfs&#39;</span><br><span class="line">  mkfs_opts: &#39;-f -i size&#x3D;2048&#39;</span><br><span class="line">  mount_opts: &#39;-o inode64,noatime,logbsize&#x3D;256k&#39;</span><br><span class="line">  conf_file: &#39;&#x2F;home&#x2F;nhm&#x2F;src&#x2F;ceph-tools&#x2F;cbt&#x2F;newstore&#x2F;ceph.conf.1osd&#39;</span><br><span class="line">  iterations: 1</span><br><span class="line">  use_existing: False</span><br><span class="line">  clusterid: &quot;ceph&quot;</span><br><span class="line">  tmp_dir: &quot;&#x2F;tmp&#x2F;cbt&quot;</span><br><span class="line">  pool_profiles:</span><br><span class="line">    rbd:</span><br><span class="line">      pg_size: 256</span><br><span class="line">      pgp_size: 256</span><br><span class="line">      replication: 1</span><br><span class="line">benchmarks:</span><br><span class="line">  librbdfio:</span><br><span class="line">    time: 300</span><br><span class="line">    vol_size: 16384</span><br><span class="line">    mode: [read, write, randread, randwrite]</span><br><span class="line">    op_size: [4194304, 2097152, 1048576]</span><br><span class="line">    concurrent_procs: [1]</span><br><span class="line">    iodepth: [64]</span><br><span class="line">    osd_ra: [4096]</span><br><span class="line">    cmd_path: &#39;&#x2F;home&#x2F;nhm&#x2F;src&#x2F;fio&#x2F;fio&#39;</span><br><span class="line">    pool_profile: &#39;rbd&#39;</span><br></pre></td></tr></table></figure>
<p>还定义了一个关联的ceph.conf.1osd文件，其中包含要在此测试中使用的各种设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">        osd pool default size &#x3D; 1</span><br><span class="line">        auth cluster required &#x3D; none</span><br><span class="line">        auth service required &#x3D; none</span><br><span class="line">        auth client required &#x3D; none</span><br><span class="line">        keyring &#x3D; &#x2F;tmp&#x2F;cbt&#x2F;ceph&#x2F;keyring</span><br><span class="line">        osd pg bits &#x3D; 8  </span><br><span class="line">        osd pgp bits &#x3D; 8</span><br><span class="line">        log to syslog &#x3D; false</span><br><span class="line">        log file &#x3D; &#x2F;tmp&#x2F;cbt&#x2F;ceph&#x2F;log&#x2F;$name.log</span><br><span class="line">        public network &#x3D; 192.168.10.0&#x2F;24</span><br><span class="line">        cluster network &#x3D; 192.168.10.0&#x2F;24</span><br><span class="line">        rbd cache &#x3D; true</span><br><span class="line">        osd scrub load threshold &#x3D; 0.01</span><br><span class="line">        osd scrub min interval &#x3D; 137438953472</span><br><span class="line">        osd scrub max interval &#x3D; 137438953472</span><br><span class="line">        osd deep scrub interval &#x3D; 137438953472</span><br><span class="line">        osd max scrubs &#x3D; 16</span><br><span class="line">        filestore merge threshold &#x3D; 40</span><br><span class="line">        filestore split multiple &#x3D; 8</span><br><span class="line">        osd op threads &#x3D; 8</span><br><span class="line">        mon pg warn max object skew &#x3D; 100000</span><br><span class="line">        mon pg warn min per osd &#x3D; 0</span><br><span class="line">        mon pg warn max per osd &#x3D; 32768</span><br><span class="line"></span><br><span class="line">[mon]</span><br><span class="line">        mon data &#x3D; &#x2F;tmp&#x2F;cbt&#x2F;ceph&#x2F;mon.$id</span><br><span class="line">        </span><br><span class="line">[mon.a]</span><br><span class="line">        host &#x3D; burnupiX </span><br><span class="line">        mon addr &#x3D; 127.0.0.1:6789</span><br><span class="line"></span><br><span class="line">[osd.0]</span><br><span class="line">        host &#x3D; burnupiX</span><br><span class="line">        osd data &#x3D; &#x2F;tmp&#x2F;cbt&#x2F;mnt&#x2F;osd-device-0-data</span><br><span class="line">        osd journal &#x3D; &#x2F;dev&#x2F;disk&#x2F;by-partlabel&#x2F;osd-device-0-journal</span><br></pre></td></tr></table></figure>
<p>要运行此基准测试suite，cbt启动时带参数来指定用于存储结果archive目录和要使用的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cbt.py --archive&#x3D;&lt;archive dir&gt; .&#x2F;mytests.yaml</span><br></pre></td></tr></table></figure>
<p>您还可以通过在命令行上指定ceph.conf文件来指定要使用的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cbt.py -archive&#x3D;&lt;archive dir&gt; --conf&#x3D;.&#x2F;ceph.conf.1osd .&#x2F;mytests.yaml</span><br></pre></td></tr></table></figure>
<p>通过这种方式，可以混合或匹配ceph.conf文件和yaml测试文件，以创建测试的参数化扫描。tools目录中名为mkcephconf.py的脚本可以自动生成数百或数千个ceph.conf文件（需要自定义选项范围），然后以这种方式与cbt一起使用。</p>
<h2 id="CONCLUSION（结论）"><a href="#CONCLUSION（结论）" class="headerlink" title="CONCLUSION（结论）"></a>CONCLUSION（结论）</h2><p>还有许多其他功能强大的方法可以使用，本文档中尚未涵盖所有cbt的功能。随着时间的推移，我们将尝试为这些功能提供更好的示例和文档。现在，最好查看示例，查看代码，并提出问题！</p>
<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p>该实验没有使用nhm账户，以下实验都是root用户，所以ssh互信需要把nhm改为root</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">cbt节点</span><br><span class="line">1、安装pdsh</span><br><span class="line">[root@cbt ~]# yum -y install epel-release</span><br><span class="line">[root@cbt ~]# yum install -y pdsh</span><br><span class="line">与ceph节点做免密</span><br><span class="line">[root@cbt ~]# ssh-keygen</span><br><span class="line">[root@cbt cbt]# ssh-copy-id nhm@192.168.0.45</span><br><span class="line">测试</span><br><span class="line">[root@cbt ~]# pdsh -w 192.168.0.45 -l nhm uptime</span><br><span class="line">192.168.0.45:  14:28:43 up 32 min,  1 user,  load average: 0.00, 0.01, 0.05</span><br><span class="line">2、安装piip</span><br><span class="line">[root@cbt ~]# curl &quot;https:&#x2F;&#x2F;bootstrap.pypa.io&#x2F;get-pip.py&quot; -o &quot;get-pip.py&quot;</span><br><span class="line">[root@cbt ~]# python get-pip.py</span><br><span class="line">[root@cbt ~]# python -m pip install -U pip</span><br><span class="line">[root@cbt ~]# pip install --upgrade setuptools</span><br><span class="line">3、安装python依赖库</span><br><span class="line">[root@cbt cbt]# pip install lxml numpy PyYAML</span><br><span class="line">4、配置&#x2F;etc&#x2F;hosts文件</span><br><span class="line">[root@cbt cbt]# cat &#x2F;etc&#x2F;hosts</span><br><span class="line">192.168.0.45    cbt-ceph-1</span><br><span class="line">192.168.0.46    cbt-ceph-2</span><br><span class="line">192.168.0.47    cbt-ceph-3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ceph节点</span><br><span class="line">[root@cbt-ceph-1 ~]# yum -y install epel-release</span><br><span class="line">[root@cbt-ceph-1 ~]# yum -y install collectl perf blktrace</span><br><span class="line">[root@cbt-ceph-1 ~]# useradd -m nhm -g root -G root</span><br><span class="line">[root@cbt-ceph-1 ~]# echo nhm:nhm | chpasswd</span><br><span class="line">[root@cbt-ceph-1 ~]# vi &#x2F;etc&#x2F;sudoers</span><br><span class="line">添加</span><br><span class="line">nhm   ALL&#x3D;(ALL)         NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line">[root@cbt-ceph-1 ~]# yum -y install epel-release</span><br><span class="line">[root@cbt-ceph-1 ~]# yum install -y pdsh</span><br><span class="line">[root@cbt-ceph-1 ~]# yum install -y fio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cbt单节点radosbench配置文件</span><br><span class="line">[root@cbt ~]# cat &#x2F;root&#x2F;mytests.yaml</span><br><span class="line">cluster:</span><br><span class="line">  user: &#39;root&#39;</span><br><span class="line">  head: &quot;cbt-ceph-1&quot;</span><br><span class="line">  clients: [&quot;cbt-ceph-1&quot;]</span><br><span class="line">  osds: [&quot;cbt-ceph-1&quot;]</span><br><span class="line">  mons: [&quot;cbt-ceph-1&quot;]</span><br><span class="line">  osds_per_node: 1</span><br><span class="line">  fs: &#39;xfs&#39;</span><br><span class="line">  mkfs_opts: &#39;-f -i size&#x3D;2048&#39;</span><br><span class="line">  mount_opts: &#39;-o inode64,noatime,logbsize&#x3D;256k&#39;</span><br><span class="line">  conf_file: &#39;&#x2F;etc&#x2F;ceph&#x2F;ceph.conf&#39;</span><br><span class="line">  iterations: 1</span><br><span class="line">  use_existing: True</span><br><span class="line">  version_compat: jewel</span><br><span class="line">  clusterid: &quot;ceph&quot;</span><br><span class="line">  tmp_dir: &quot;&#x2F;tmp&#x2F;cbt&quot;</span><br><span class="line">  pool_profiles:</span><br><span class="line">    rbd:</span><br><span class="line">      pg_size: 256</span><br><span class="line">      pgp_size: 256</span><br><span class="line">      replication: 1</span><br><span class="line">benchmarks:</span><br><span class="line">  radosbench:</span><br><span class="line">    op_size: [ 4194304, 524288, 4096 ]</span><br><span class="line">    write_only: False</span><br><span class="line">    time: 5</span><br><span class="line">    concurrent_ops: [ 128 ]</span><br><span class="line">    concurrent_procs: 1</span><br><span class="line">    use_existing: True</span><br><span class="line">    pool_profile: replicated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cbt单节点librbdfio配置文件</span><br><span class="line">[root@cbt cbt]# cat &#x2F;root&#x2F;mytests.yaml</span><br><span class="line">cluster:</span><br><span class="line">  user: &#39;root&#39;</span><br><span class="line">  head: &quot;cbt-ceph-1&quot;</span><br><span class="line">  clients: [&quot;cbt-ceph-1&quot;]</span><br><span class="line">  osds: [&quot;cbt-ceph-1&quot;]</span><br><span class="line">  mons: [&quot;cbt-ceph-1&quot;]</span><br><span class="line">  osds_per_node: 1</span><br><span class="line">  fs: &#39;xfs&#39;</span><br><span class="line">  mkfs_opts: &#39;-f -i size&#x3D;2048&#39;</span><br><span class="line">  mount_opts: &#39;-o inode64,noatime,logbsize&#x3D;256k&#39;</span><br><span class="line">  conf_file: &#39;&#x2F;etc&#x2F;ceph&#x2F;ceph.conf&#39;</span><br><span class="line">  iterations: 1</span><br><span class="line">  use_existing: True</span><br><span class="line">  version_compat: jewel</span><br><span class="line">  clusterid: &quot;ceph&quot;</span><br><span class="line">  tmp_dir: &quot;&#x2F;tmp&#x2F;cbt&quot;</span><br><span class="line">  pool_profiles:</span><br><span class="line">    rbd:</span><br><span class="line">      pg_size: 256</span><br><span class="line">      pgp_size: 256</span><br><span class="line">      replication: 1</span><br><span class="line">benchmarks:</span><br><span class="line">  librbdfio:</span><br><span class="line">    time: 300</span><br><span class="line">    vol_size: 16384</span><br><span class="line">    mode: [read, write, randread, randwrite]</span><br><span class="line">    op_size: [4194304, 2097152, 1048576]</span><br><span class="line">    concurrent_procs: [1]</span><br><span class="line">    iodepth: [64]</span><br><span class="line">    osd_ra: [4096]</span><br><span class="line">    pool_profile: &#39;rbd&#39;</span><br><span class="line">    </span><br><span class="line">运行cbt</span><br><span class="line">[root@cbt cbt]# python cbt.py --archive&#x3D;yujiangresult   &#x2F;root&#x2F;mytests.yaml</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">110</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
