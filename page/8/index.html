<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/29/setup-a-Ceph-cluster-using-ceph-ansible/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/29/setup-a-Ceph-cluster-using-ceph-ansible/" class="post-title-link" itemprop="url">setup a Ceph cluster using ceph-ansible</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-29 20:43:54" itemprop="dateCreated datePublished" datetime="2018-07-29T20:43:54+08:00">2018-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a target="_blank" rel="noopener" href="https://gist.github.com/elsonrodriguez/a26cdb7f04a9e94c480457e12458954a">https://gist.github.com/elsonrodriguez/a26cdb7f04a9e94c480457e12458954a</a></p>
<h1 id="Quick-and-Dirty-Ceph-Cluster"><a href="#Quick-and-Dirty-Ceph-Cluster" class="headerlink" title="Quick and Dirty Ceph Cluster"></a>Quick and Dirty Ceph Cluster</h1><p>这是一个关于如何使用ceph-ansible设置Ceph集群的简明指南。</p>
<p>本指南假设：</p>
<ul>
<li>Ansible安装在您的本地计算机上</li>
<li>8个Centos 7.2节点使用XFS进行配置和格式化</li>
<li>您对节点有ssh和sudo访问权限</li>
</ul>
<h3 id="Ansible-Setup"><a href="#Ansible-Setup" class="headerlink" title="Ansible Setup"></a>Ansible Setup</h3><p>首先，克隆ceph-ansible repo。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;ceph&#x2F;ceph-ansible.git</span><br><span class="line">cd ceph-ansible</span><br><span class="line">git checkout a41eddf6f0d840580bc842fa59751defef10fa69</span><br></pre></td></tr></table></figure>
<p>接下来，在repo的基础上添加一个inventory文件。使用以下内容作为指南，将示例IP替换为您自己的计算机IP。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mons]</span><br><span class="line">10.0.0.1</span><br><span class="line">10.0.0.2</span><br><span class="line">10.0.0.3</span><br><span class="line"></span><br><span class="line">[osds]</span><br><span class="line">10.0.0.4</span><br><span class="line">10.0.0.5</span><br><span class="line">10.0.0.6</span><br><span class="line">10.0.0.7</span><br><span class="line"></span><br><span class="line">[clients]</span><br><span class="line">10.0.0.8</span><br></pre></td></tr></table></figure>
<p>我们需要至少3个MON（cluster state daemons）4个OSD（object storage daemons）和1个client（to mount the storage）。</p>
<p>接下来，我们需要复制samples。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp site.yml.sample site.yml</span><br><span class="line">cp group_vars&#x2F;all.sample group_vars&#x2F;all</span><br><span class="line">cp group_vars&#x2F;mons.sample group_vars&#x2F;mons</span><br><span class="line">cp group_vars&#x2F;osds.sample group_vars&#x2F;osds</span><br></pre></td></tr></table></figure>
<p>现在，我们需要修改group_vars/all中的一些变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ceph_origin: &#39;upstream&#39; </span><br><span class="line">ceph_stable: true</span><br><span class="line"></span><br><span class="line">monitor_interface: eth0</span><br><span class="line">public_network: 172.20.0.0&#x2F;16</span><br><span class="line"></span><br><span class="line">journal_size: 5120</span><br></pre></td></tr></table></figure>
<p>在groups_vars/osd中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">osd_directory: true</span><br><span class="line">osd_directories:</span><br><span class="line">  - &#x2F;var&#x2F;lib&#x2F;ceph&#x2F;osd&#x2F;mydir1</span><br></pre></td></tr></table></figure>
<h3 id="Running-ceph-ansible-playbook"><a href="#Running-ceph-ansible-playbook" class="headerlink" title="Running ceph-ansible playbook"></a>Running ceph-ansible playbook</h3><p>创建inventory文件并修改变量后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook site.yml -vvvv -i inventory -u centos</span><br></pre></td></tr></table></figure>
<p>完成后，您应该有一个正常运行的Ceph集群。</p>
<h3 id="Interacting-with-Ceph"><a href="#Interacting-with-Ceph" class="headerlink" title="Interacting with Ceph"></a>Interacting with Ceph</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/27/ceph-ansible/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/27/ceph-ansible/" class="post-title-link" itemprop="url">ceph-ansible</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-27 15:31:57" itemprop="dateCreated datePublished" datetime="2018-07-27T15:31:57+08:00">2018-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a target="_blank" rel="noopener" href="http://docs.ceph.com/ceph-ansible/master/">http://docs.ceph.com/ceph-ansible/master/</a></p>
<h1 id="ceph-ansible"><a href="#ceph-ansible" class="headerlink" title="ceph-ansible"></a>ceph-ansible</h1><p>Ansible playbooks for Ceph, the distributed filesystem.</p>
<p>分布式文件系统，Ceph Ansible playbooks。</p>
<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>您可以按照以下步骤直接从GitHub上的源安装：</p>
<p>Clone the repository:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;ceph&#x2F;ceph-ansible.git</span><br></pre></td></tr></table></figure>
<p>接下来，您必须决定使用哪个ceph-ansible branch。 有稳定的branch可供选择，或者您可以使用master branch：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout $branch</span><br></pre></td></tr></table></figure>
<p>接下来，使用pip和提供的requirements.txt来安装ansible和其他所需的python库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<h2 id="Ansible-on-RHEL-and-CentOS"><a href="#Ansible-on-RHEL-and-CentOS" class="headerlink" title="Ansible on RHEL and CentOS"></a>Ansible on RHEL and CentOS</h2><p>您可以从 <a target="_blank" rel="noopener" href="https://access.redhat.com/articles/3174981">Ansible channel</a> 获取并安装RHEL和CentOS上的Ansible。</p>
<p>On RHEL: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscription-manager repos --enable&#x3D;rhel-7-server-ansible-2-rpms</span><br></pre></td></tr></table></figure>
<p>（CentOS不使用subscription-manager，默认情况下已启用“Extras” 。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install ansible</span><br></pre></td></tr></table></figure>
<h2 id="Ansible-on-Ubuntu"><a href="#Ansible-on-Ubuntu" class="headerlink" title="Ansible on Ubuntu"></a>Ansible on Ubuntu</h2><p>您可以使用 <a target="_blank" rel="noopener" href="https://launchpad.net/~ansible/+archive/ubuntu/ansible">Ansible PPA</a> 在Ubuntu上获取Ansible。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ansible&#x2F;ansible</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install ansible</span><br></pre></td></tr></table></figure>
<h1 id="Releases"><a href="#Releases" class="headerlink" title="Releases"></a>Releases</h1><p>应根据您的需求使用以下branches。stable-* branches已经过QE测试，并且在lifecycle内会得到backport修复。master branch应该被认为是实验性的，谨慎使用。</p>
<ul>
<li><code>stable-3.0</code> 支持ceph jewel和luminous版本。该branch需要Ansible 2.4版本。</li>
<li><code>stable-3.1</code> 支持ceph luminous和mimic版本。该branch需要Ansible 2.4版本。</li>
<li><code>stable-3.2</code>支持ceph luminous和mimic版本。该branch需要Ansible 2.6版本。</li>
<li><code>stable-4.0</code>支持ceph nautilus版本。该branch需要Ansible 2.8版本。</li>
<li><code>master</code> 支持Ceph@master版本。该branch需要Ansible 2.8版本。</li>
</ul>
<h1 id="Configuration-and-Usage"><a href="#Configuration-and-Usage" class="headerlink" title="Configuration and Usage"></a>Configuration and Usage</h1><p>该项目假设您具有ansible的基本知识，并已经准备好主机以供Ansible配置。在clone了ceph-ansible repository后，选择你的branch并且安装了ansible，然后你需要为你的ceph集群创建你的inventory文件，playbook和configuration。</p>
<h2 id="Inventory"><a href="#Inventory" class="headerlink" title="Inventory"></a>Inventory</h2><p>ansible inventory文件定义集群中的主机以及每个主机在ceph集群中扮演的角色（role）。inventory文件的默认位置是<code>/etc/ansible/hosts</code>，但此文件可以放在任何位置，并与<code>ansible-playbook</code>的<code>-i</code> flag一起使用。</p>
<p>示例inventory文件如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[mons]</span><br><span class="line">mon1</span><br><span class="line">mon2</span><br><span class="line">mon3</span><br><span class="line"></span><br><span class="line">[osds]</span><br><span class="line">osd1</span><br><span class="line">osd2</span><br><span class="line">osd3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">有关ansible inventories的更多信息，请参阅ansible文档：</span><br><span class="line">http:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;intro_inventory.html</span><br></pre></td></tr></table></figure>
<h2 id="Playbook"><a href="#Playbook" class="headerlink" title="Playbook"></a>Playbook</h2><p>在部署群集时，必须有一个playbook传递给<code>ansible-playbook</code>命令。在<code>ceph-ansible</code>项目的根目录中有一个名为<code>site.yml.sample</code>的示例playbook。这个playbook应该适用于大多数用法，但它默认包含每个守护进程组（every daemon group），这可能不适合你的群集设置。执行以下步骤准备您的playbook：</p>
<ul>
<li>重命名示例playbook：<code>mv site.yml.sample site.yml</code></li>
<li>根据群集需求修改playbook</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">重要的是你使用的playbook应放在ceph-ansible项目的root目录。这就是ansible能够找到ceph-ansible提供的roles的方式。</span><br></pre></td></tr></table></figure>
<h2 id="Configuration-Validation"><a href="#Configuration-Validation" class="headerlink" title="Configuration Validation"></a>Configuration Validation</h2><p>ceph-ansible项目通过ceph-validate 角色（role）提供配置验证（config validation）。如果您使用的是所提供的playbooks，此role将在部署前运行，以确保您的ceph-ansible配置正确。此检查仅确保您为群集提供了正确的配置，而不是生成healthy集群。例如，如果为monitor_address提供了错误的地址，则mon仍然无法加入群集。</p>
<p>验证失败的示例可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">TASK [ceph-validate : validate provided configuration] *************************</span><br><span class="line">task path: &#x2F;Users&#x2F;andrewschoen&#x2F;dev&#x2F;ceph-ansible&#x2F;roles&#x2F;ceph-validate&#x2F;tasks&#x2F;main.yml:3</span><br><span class="line">Wednesday 02 May 2018  13:48:16 -0500 (0:00:06.984)       0:00:18.803 *********</span><br><span class="line"> [ERROR]: [mon0] Validation failed for variable: osd_objectstore</span><br><span class="line"></span><br><span class="line"> [ERROR]: [mon0] Given value for osd_objectstore: foo</span><br><span class="line"></span><br><span class="line"> [ERROR]: [mon0] Reason: osd_objectstore must be either &#39;bluestore&#39; or &#39;filestore&#39;</span><br><span class="line"></span><br><span class="line"> fatal: [mon0]: FAILED! &#x3D;&gt; &#123;</span><br><span class="line">     &quot;changed&quot;: false</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Supported-Validation"><a href="#Supported-Validation" class="headerlink" title="Supported Validation"></a>Supported Validation</h3><p>ceph-validate角色（role）当前支持验证以下osd场景的配置：</p>
<ul>
<li><p>collocated（journal与data一块盘）</p>
</li>
<li><p>non-collocated</p>
</li>
<li><p>lvm</p>
</li>
</ul>
<p>ceph-validate角色（role）还验证了以下安装选项：</p>
<ul>
<li>ceph_origin 设置为 distro</li>
<li>ceph_origin 设置为 repository</li>
<li>ceph_origin 设置为 local</li>
<li>ceph_repository 设置为 rhcs</li>
<li>ceph_repository 设置为 dev</li>
<li>ceph_repository 设置为 community</li>
</ul>
<h2 id="Installation-methods"><a href="#Installation-methods" class="headerlink" title="Installation methods"></a>Installation methods</h2><p>Ceph可以通过几种方法安装。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.ceph.com/ceph-ansible/master/installation/methods.html">Installation methods</a></li>
</ul>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>ceph集群的配置将通过ceph-ansible提供的ansible变量来设置。所有这些选项及其默认值都在ceph-ansible项目root目录下的group_vars/子目录中定义。Ansible将在group_vars/子目录中使用您的inventory文件或playbook配置。在group_vars/子目录中有许多ansible配置文件示例，它们通过文件名与每个ceph守护进程组（ceph daemon groups）关联。例如，osds.yml.sample包含OSD守护进程的所有默认配置。all.yml.sample文件是一个特殊的group_vars文件，适用于群集中的所有主机。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">有关设置group或主机特定配置的更多信息，请参阅ansible文档：http:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;intro_inventory.html#splitting-out-host-and-group-specific-data</span><br></pre></td></tr></table></figure>
<p>最基本的，您必须告诉<code>ceph-ansible</code>要安装的ceph版本，安装方法，群集网络设置以及希望如何配置OSD。开始配置，请重命名<code>group_vars/</code>目录中的每个文件，让它不包含文件名末尾的<code>.sample</code>，取消要更改选项的注释并提供自己的值。</p>
<p>使用lvm批处理方法部署Ceph upstream的octopus版本，在group_vars/all.yml中如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ceph_origin: repository</span><br><span class="line">ceph_repository: community</span><br><span class="line">ceph_stable_release: octopus</span><br><span class="line">public_network: &quot;192.168.3.0&#x2F;24&quot;</span><br><span class="line">cluster_network: &quot;192.168.4.0&#x2F;24&quot;</span><br><span class="line">monitor_interface: eth1</span><br><span class="line">devices:</span><br><span class="line">  - &#39;&#x2F;dev&#x2F;sda&#39;</span><br><span class="line">  - &#39;&#x2F;dev&#x2F;sdb&#39;</span><br></pre></td></tr></table></figure>
<p>所有安装都需要更改以下配置选项，但可能还有其他必需选项，具体取决于OSD方案选择或群集的其他方面。</p>
<ul>
<li><code>ceph_origin</code></li>
<li><code>ceph_stable_release</code></li>
<li><code>public_network</code></li>
<li><code>monitor_interface</code> or <code>monitor_address</code></li>
</ul>
<p>部署RGW实例时，需要设置``radosgw_interface<code> 或</code>radosgw_address`选项。</p>
<h2 id="ceph-conf-Configuration-File"><a href="#ceph-conf-Configuration-File" class="headerlink" title="ceph.conf Configuration File"></a>ceph.conf Configuration File</h2><p>覆盖已定义 ceph.conf 中内容的方法是使用 ceph_conf_overrides 变量。这允许您使用 INI 格式指定配置选项。此变量可用于覆盖已在 ceph.conf 中定义的sections（请参见：roles/ceph-config/templates/ceph.conf.j2）或提供新的配置选项。</p>
<p>支持ceph.conf中的以下部分：</p>
<ul>
<li>[global]</li>
<li>[mon]</li>
<li>[osd]</li>
<li>[mds]</li>
<li>[client.rgw.{instance_name}]</li>
</ul>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ceph_conf_overrides:</span><br><span class="line">   global:</span><br><span class="line">     foo: 1234</span><br><span class="line">     bar: 5678</span><br><span class="line">   osd:</span><br><span class="line">     osd_mkfs_type: ext4</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">我们将不再接受修改ceph.conf模板的pull requests，除非它有助于部署。对于简单的配置调整，请使用ceph_conf_overrides变量。</span><br></pre></td></tr></table></figure>
<p>用于配置每个ceph daemon types的完整文档，在以下各sections中。</p>
<h2 id="OSD-Configuration"><a href="#OSD-Configuration" class="headerlink" title="OSD Configuration"></a>OSD Configuration</h2><p>通过选择OSD场景并提供该场景所需的配置来设置OSD配置。从稳定4.0版的nautilus开始，唯一可用的场景是lvm。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.ceph.com/ceph-ansible/master/osds/scenarios.html">OSD Scenarios</a></li>
</ul>
<p>从<code>stable-4.0</code>开始，不再支持下列场景，因为他们与<code>ceph-disk</code>相关联：</p>
<ul>
<li>collocated</li>
<li>non-collocated</li>
</ul>
<p>自Ceph luminous发布以来，首选使用<code>ceph-volume</code>工具的lvm场景。任何其他方案都将导致弃用警告。</p>
<p><code>ceph-disk</code>在ceph-ansible 3.2中被弃用，并且已经在Nautilus版本完全从Ceph本身中删除。 目前（从稳定版4.0开始），只有一个场景，默认为<code>lvm</code>，参见：</p>
<ul>
<li>lvm</li>
</ul>
<p>因此不再需要配置<code>osd_scenario</code>，它默认为<code>lvm</code>。</p>
<p>上面提到的<code>lvm</code>场景支持containerized和non-containerized集群。提醒一下，可以通过将<code>containerized_deployment</code>设置为<code>True</code>来完成部署容器化集群。</p>
<h3 id="lvm"><a href="#lvm" class="headerlink" title="lvm"></a>lvm</h3><p>此场景使用<code>ceph-volume</code>来创建LVM的OSD，并且仅在Ceph luminous或更新的版本才可用。它会自动启用。</p>
<p>其他（可选）支持的设置：</p>
<ul>
<li><p><code>osd_objectstore</code>：为OSD设置Ceph objectstore。可用选项是<code>filestore</code>或<code>bluestore</code>。你只能选择luminous或更高Ceph版本的<code>bluestore</code>。如果未设置，则默认为<code>bluestore</code>。</p>
</li>
<li><p><code>dmcrypt</code>：使用dmcrypt在OSD上启用Ceph加密。如果未设置，则默认为false。</p>
</li>
<li><p><code>osds_per_device</code>：为每个设备提供多个OSD（如果未设置，默认为1，也就是说1个设备1个OSD）。</p>
</li>
</ul>
<h3 id="Simple-configuration"><a href="#Simple-configuration" class="headerlink" title="Simple configuration"></a>Simple configuration</h3><p>使用这种方法，有关设备如何配置为预配 OSD 的决策都由 Ceph 工具完成的（本例中为ceph-volume lvm批处理）。在给定输入设备的情况下，几乎无法修改OSD的组合方式。</p>
<p>要使用此配置，必须配置使用OSD的原始设备路径填充devices选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">原始设备必须“干净”，没有gpt分区表或逻辑卷存在。</span><br><span class="line">[root@dev ~]# yum install gdisk -y</span><br><span class="line">[root@dev ~]# gdisk &#x2F;dev&#x2F;sda </span><br><span class="line">GPT fdisk (gdisk) version 0.8.10</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: not present</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: not present</span><br><span class="line"></span><br><span class="line">Creating new GPT entries.</span><br><span class="line"></span><br><span class="line">Command (? for help): x</span><br><span class="line"></span><br><span class="line">Expert command (? for help): z</span><br><span class="line">About to wipe out GPT on &#x2F;dev&#x2F;sda. Proceed? (Y&#x2F;N): Y</span><br><span class="line">GPT data structures destroyed! You may now partition the disk using fdisk or</span><br><span class="line">other utilities.</span><br><span class="line">Blank out MBR? (Y&#x2F;N): Y</span><br></pre></td></tr></table></figure>
<p>例如，对于具有<code>/dev/sda</code>和<code>/dev/sdb</code>的节点，配置将是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devices:</span><br><span class="line">  - &#x2F;dev&#x2F;sda</span><br><span class="line">  - &#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure>
<p>在上述情况下，如果两个设备都是spinning（旋转）设备（HDD），则会创建2个OSD，每个OSD都有自己的collocated journal（journal与data同盘）。</p>
<p>其他方式可能是spinning设备与solid state设备混合部署（HDD+SSD），例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">devices:</span><br><span class="line">  - &#x2F;dev&#x2F;sda</span><br><span class="line">  - &#x2F;dev&#x2F;sdb</span><br><span class="line">  - &#x2F;dev&#x2F;nvme0n1</span><br></pre></td></tr></table></figure>
<p>与最初的示例类似，最终会生成2个OSD，但数据将放在较慢的spinning设备（<code>/dev/sda</code>, 和<code>/dev/sdb</code>）上，而journals将放在速度更快的solid state设备<code>/dev/nvme0n1</code>上。 <code>ceph-volume</code>工具在<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/ceph-volume/lvm/batch/">“batch”子命令部分</a>详细描述了这一点</p>
<p>此选项也可以与<code>osd_auto_discovery</code>一起使用，这意味着您不需要直接填充<code>devices</code> ，而是使用ansible找到的任何适当的设备。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">osd_auto_discovery: true</span><br></pre></td></tr></table></figure>
<p>其他（可选）支持的设置：</p>
<ul>
<li><code>crush_device_class</code>：为使用此方法创建的所有OSD设置CRUSH device class（使用simple configuration方法不可能每个OSD都有CRUSH device class）。 值必须是字符串，如<code>crush_device_class：&quot;ssd&quot;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">未使用crush_device_class</span><br><span class="line"># begin crush map</span><br><span class="line">tunable choose_local_tries 0</span><br><span class="line">tunable choose_local_fallback_tries 0</span><br><span class="line">tunable choose_total_tries 50</span><br><span class="line">tunable chooseleaf_descend_once 1</span><br><span class="line">tunable chooseleaf_vary_r 1</span><br><span class="line">tunable chooseleaf_stable 1</span><br><span class="line">tunable straw_calc_version 1</span><br><span class="line">tunable allowed_bucket_algs 54</span><br><span class="line"></span><br><span class="line"># devices</span><br><span class="line">device 0 osd.0 class hdd</span><br><span class="line">device 1 osd.1 class hdd</span><br><span class="line">device 2 osd.2 class hdd</span><br><span class="line">device 3 osd.3 class hdd</span><br><span class="line">device 4 osd.4 class hdd</span><br><span class="line">device 5 osd.5 class hdd</span><br><span class="line">device 6 osd.6 class hdd</span><br><span class="line">device 7 osd.7 class hdd</span><br><span class="line">device 8 osd.8 class hdd</span><br><span class="line"></span><br><span class="line"># types</span><br><span class="line">type 0 osd</span><br><span class="line">type 1 host</span><br><span class="line">type 2 chassis</span><br><span class="line">type 3 rack</span><br><span class="line">type 4 row</span><br><span class="line">type 5 pdu</span><br><span class="line">type 6 pod</span><br><span class="line">type 7 room</span><br><span class="line">type 8 datacenter</span><br><span class="line">type 9 zone</span><br><span class="line">type 10 region</span><br><span class="line">type 11 root</span><br><span class="line"></span><br><span class="line"># buckets</span><br><span class="line">host community-ceph13-1 &#123;</span><br><span class="line">	id -3		# do not change unnecessarily</span><br><span class="line">	id -4 class hdd		# do not change unnecessarily</span><br><span class="line">	# weight 0.144</span><br><span class="line">	alg straw2</span><br><span class="line">	hash 0	# rjenkins1</span><br><span class="line">	item osd.0 weight 0.048</span><br><span class="line">	item osd.3 weight 0.048</span><br><span class="line">	item osd.6 weight 0.048</span><br><span class="line">&#125;</span><br><span class="line">host community-ceph13-2 &#123;</span><br><span class="line">	id -5		# do not change unnecessarily</span><br><span class="line">	id -6 class hdd		# do not change unnecessarily</span><br><span class="line">	# weight 0.144</span><br><span class="line">	alg straw2</span><br><span class="line">	hash 0	# rjenkins1</span><br><span class="line">	item osd.1 weight 0.048</span><br><span class="line">	item osd.4 weight 0.048</span><br><span class="line">	item osd.8 weight 0.048</span><br><span class="line">&#125;</span><br><span class="line">host community-ceph13-3 &#123;</span><br><span class="line">	id -7		# do not change unnecessarily</span><br><span class="line">	id -8 class hdd		# do not change unnecessarily</span><br><span class="line">	# weight 0.144</span><br><span class="line">	alg straw2</span><br><span class="line">	hash 0	# rjenkins1</span><br><span class="line">	item osd.2 weight 0.048</span><br><span class="line">	item osd.5 weight 0.048</span><br><span class="line">	item osd.7 weight 0.048</span><br><span class="line">&#125;</span><br><span class="line">root default &#123;</span><br><span class="line">	id -1		# do not change unnecessarily</span><br><span class="line">	id -2 class hdd		# do not change unnecessarily</span><br><span class="line">	# weight 0.431</span><br><span class="line">	alg straw2</span><br><span class="line">	hash 0	# rjenkins1</span><br><span class="line">	item community-ceph13-1 weight 0.144</span><br><span class="line">	item community-ceph13-2 weight 0.144</span><br><span class="line">	item community-ceph13-3 weight 0.144</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># rules</span><br><span class="line">rule replicated_rule &#123;</span><br><span class="line">	id 0</span><br><span class="line">	type replicated</span><br><span class="line">	min_size 1</span><br><span class="line">	max_size 10</span><br><span class="line">	step take default</span><br><span class="line">	step chooseleaf firstn 0 type host</span><br><span class="line">	step emit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># end crush map</span><br></pre></td></tr></table></figure>


<h3 id="Advanced-configuration"><a href="#Advanced-configuration" class="headerlink" title="Advanced configuration"></a>Advanced configuration</h3><p>当在设置devices需要更精细的控制OSD时，非常有用。它需要已存在的volume groups和logical volumes设置（<code>ceph-volume</code>不会创建这些卷）。</p>
<p>要使用此配置，必须使用logical volumes和volume groups填充<code>lvm_volumes</code>选项。此外，分区的绝对路径可用于<code>journal</code>，<code>block.db</code>和<code>block.wal</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">此配置使用ceph-volume lvm create来设置OSD</span><br></pre></td></tr></table></figure>
<p>支持的<code>lvm_volumes</code>配置设置：</p>
<ul>
<li><p><code>data</code>：logical volume名称或raw device（原始设备）的绝对路径（使用 100% 的原始设备创建 LV）</p>
</li>
<li><p><code>data_vg</code>：volume group名称，如果<code>data</code>是logical volume，则为必需。</p>
</li>
<li><p><code>crush_device_class</code>：生成OSD的CRUSH device class名，允许为每个OSD设置device class，而不像全局<code>crush_device_class</code>那样为所有OSD设置它们。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">如果在使用devices时为OSD设置crush_device_class，则必须使用全局crush_device_class选项设置它，如上所示。 当使用像lvm_volumes这样的devices时，无法为每个OSD定义特定的CRUSH device class。</span><br></pre></td></tr></table></figure>
<p><code>filestore</code> objectstore变量：</p>
<ul>
<li><code>journal</code>：logical volume名称或分区的绝对路径。</li>
<li><code>journal_vg</code>：volume group名称，如果journal是logical volume，则是必选。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">警告</span><br><span class="line">每个entry（条目）必须是唯一的，不允许重复的值</span><br></pre></td></tr></table></figure>
<p><code>bluestore</code>  objectstore变量：</p>
<ul>
<li><code>db</code>： logical volume名称或分区的绝对路径。</li>
<li><code>db_vg</code>： volume group名称，如果<code>db</code>是logical volume，则是必选。</li>
<li><code>wal</code>： logical volume名称或分区的绝对路径。</li>
<li><code>wal_vg</code>： volume group名称，如果<code>wal</code>是logical volume，则是必选。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">这些bluestore变量是可选的优化选项。 Bluestore的db和wal只会从更快的设备中受益。可以使用单个raw device（原始设备）创建bluestore OSD。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">警告</span><br><span class="line">每个entry（条目）必须是唯一的，不允许重复的值</span><br></pre></td></tr></table></figure>
<p>使用 raw devices（原始设备）的<code>bluestore</code>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">osd_objectstore: bluestore</span><br><span class="line">lvm_volumes:</span><br><span class="line">  - data: &#x2F;dev&#x2F;sda</span><br><span class="line">  - data: &#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">在这种情况下，将使用100％的devices创建volume groups和logical volumes。</span><br></pre></td></tr></table></figure>
<p>具有logical volumes的<code>bluestore</code>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">osd_objectstore: bluestore</span><br><span class="line">lvm_volumes:</span><br><span class="line">  - data: data-lv1</span><br><span class="line">    data_vg: data-vg1</span><br><span class="line">  - data: data-lv2</span><br><span class="line">    data_vg: data-vg2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">必须存在Volume groups和logical volumes。</span><br></pre></td></tr></table></figure>
<p>定义<code>wal</code>和<code>db</code>logical volumes的bluestore示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">osd_objectstore: bluestore</span><br><span class="line">lvm_volumes:</span><br><span class="line">  - data: data-lv1</span><br><span class="line">    data_vg: data-vg1</span><br><span class="line">    db: db-lv1</span><br><span class="line">    db_vg: db-vg1</span><br><span class="line">    wal: wal-lv1</span><br><span class="line">    wal_vg: wal-vg1</span><br><span class="line">  - data: data-lv2</span><br><span class="line">    data_vg: data-vg2</span><br><span class="line">    db: db-lv2</span><br><span class="line">    db_vg: db-vg2</span><br><span class="line">    wal: wal-lv2</span><br><span class="line">    wal_vg: wal-vg2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">必须存在volume groups和logical volumes。</span><br></pre></td></tr></table></figure>
<p>具有logical volumes的<code>filestore</code>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">osd_objectstore: filestore</span><br><span class="line">lvm_volumes:</span><br><span class="line">  - data: data-lv1</span><br><span class="line">    data_vg: data-vg1</span><br><span class="line">    journal: journal-lv1</span><br><span class="line">    journal_vg: journal-vg1</span><br><span class="line">  - data: data-lv2</span><br><span class="line">    data_vg: data-vg2</span><br><span class="line">    journal: journal-lv2</span><br><span class="line">    journal_vg: journal-vg2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意</span><br><span class="line">必须存在volume groups和logical volumes。</span><br></pre></td></tr></table></figure>
<h1 id="Contribution"><a href="#Contribution" class="headerlink" title="Contribution"></a>Contribution</h1><p>有关如何为ceph-ansible做出贡献的指导，请参阅以下部分。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.ceph.com/ceph-ansible/master/dev/index.html">Contribution Guidelines</a></li>
</ul>
<h1 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h1><p>用于编写 ceph-ansible 功能测试方案的文档。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://docs.ceph.com/ceph-ansible/master/testing/index.html">Testing with ceph-ansible</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://docs.ceph.com/ceph-ansible/master/testing/glossary.html">Glossary</a></p>
</li>
</ul>
<h1 id="Demos"><a href="#Demos" class="headerlink" title="Demos"></a>Demos</h1><h2 id="Vagrant-Demo"><a href="#Vagrant-Demo" class="headerlink" title="Vagrant Demo"></a>Vagrant Demo</h2><p>在裸机上从头开始部署：<a target="_blank" rel="noopener" href="https://youtu.be/E8-96NamLDo">https://youtu.be/E8-96NamLDo</a></p>
<h2 id="Bare-metal-demo"><a href="#Bare-metal-demo" class="headerlink" title="Bare metal demo"></a>Bare metal demo</h2><p>在裸机上从头开始部署：<a target="_blank" rel="noopener" href="https://youtu.be/dv_PEp9qAqg">https://youtu.be/dv_PEp9qAqg</a></p>
<h1 id="ansible不配置ssh免密钥-使用密码登录"><a href="#ansible不配置ssh免密钥-使用密码登录" class="headerlink" title="ansible不配置ssh免密钥,使用密码登录"></a>ansible不配置ssh免密钥,使用密码登录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1、编辑&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</span><br><span class="line">取消注释：#host_key_checking &#x3D; False</span><br><span class="line"></span><br><span class="line">2、编辑&#x2F;etc&#x2F;ansible&#x2F;hosts</span><br><span class="line">[ceph_exporter]</span><br><span class="line">10.121.136.110	ansible_user&#x3D;root	ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.111	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.112	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.113	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.114	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.115	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line"></span><br><span class="line">[node_exporter]</span><br><span class="line">10.121.136.110	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.111	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.112	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.113	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.114	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line">10.121.136.115	ansible_user&#x3D;root       ansible_ssh_pass&#x3D;root</span><br><span class="line"></span><br><span class="line">3、测试</span><br><span class="line">ansible all -m ping</span><br></pre></td></tr></table></figure>
<h1 id="清除集群中的LVM"><a href="#清除集群中的LVM" class="headerlink" title="清除集群中的LVM"></a>清除集群中的LVM</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@dev yujiang]# cat remove_ceph_lvm.sh </span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">set -x</span><br><span class="line"></span><br><span class="line">DEVICE_LIST&#x3D;(a b c d e f g h i j k l)</span><br><span class="line">DEVICE_PATH&#x3D;&quot;&#x2F;dev&quot;</span><br><span class="line">DEVICE_PREFIX&#x3D;&quot;sd&quot;</span><br><span class="line"></span><br><span class="line">VG&#x3D;&#96;ls -l &#x2F;dev&#x2F; | grep ceph- | awk &#39;&#123;print $9&#125;&#39; &#96;</span><br><span class="line"></span><br><span class="line">for name in $&#123;DEVICE_LIST[@]&#125;</span><br><span class="line">do</span><br><span class="line">	echo $&#123;name&#125;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for name in $&#123;VG[@]&#125;</span><br><span class="line">do</span><br><span class="line">	LV&#x3D;&#96;ls -l $&#123;DEVICE_PATH&#125;&#x2F;$&#123;name&#125; | grep osd- | awk &#39;&#123;print $9&#125;&#39;&#96;</span><br><span class="line">	for lv in $&#123;LV&#125;</span><br><span class="line">	do</span><br><span class="line">		LV_PATH&#x3D;$&#123;DEVICE_PATH&#125;&#x2F;$&#123;name&#125;&#x2F;$&#123;lv&#125;</span><br><span class="line">		lvremove $&#123;LV_PATH&#125;</span><br><span class="line">	done</span><br><span class="line">	vgremove $&#123;DEVICE_PATH&#125;&#x2F;$&#123;name&#125;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for name in $&#123;DEVICE_LIST[@]&#125;</span><br><span class="line">do</span><br><span class="line">	pvremove $&#123;DEVICE_PATH&#125;&#x2F;$&#123;DEVICE_PREFIX&#125;$&#123;name&#125;</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

























      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/24/Ansible/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/24/Ansible/" class="post-title-link" itemprop="url">Ansible</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-24 21:58:25" itemprop="dateCreated datePublished" datetime="2018-07-24T21:58:25+08:00">2018-07-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:35" itemprop="dateModified" datetime="2020-03-22T16:16:35+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Python</span><br><span class="line">Setuptools</span><br><span class="line">pip(可选)</span><br></pre></td></tr></table></figure>
<h2 id="Ansible快速安装"><a href="#Ansible快速安装" class="headerlink" title="Ansible快速安装"></a>Ansible快速安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">安装pip：easy_install pip</span><br><span class="line">安装Ansible：pip install ansible</span><br></pre></td></tr></table></figure>
<h2 id="Ansible源码安装"><a href="#Ansible源码安装" class="headerlink" title="Ansible源码安装"></a>Ansible源码安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">获取源码</span><br><span class="line">解压源码</span><br><span class="line">进入源码目录</span><br><span class="line">运行source .&#x2F;hacking&#x2F;env-setup</span><br></pre></td></tr></table></figure>
<h2 id="Ansible系统源安装"><a href="#Ansible系统源安装" class="headerlink" title="Ansible系统源安装"></a>Ansible系统源安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Centos</span><br><span class="line"> - yum install ansible</span><br><span class="line">Ubuntu</span><br><span class="line"> - apt-get install software-properties-common</span><br><span class="line"> - apt-add-repository ppa:ansible&#x2F;ansible</span><br><span class="line"> - apt-get update</span><br><span class="line"> - apt-get install ansible</span><br></pre></td></tr></table></figure>
<h2 id="Ansible运行"><a href="#Ansible运行" class="headerlink" title="Ansible运行"></a>Ansible运行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">      client              server</span><br><span class="line">Ansible --&gt; ssh &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; ssh --&gt; shell</span><br></pre></td></tr></table></figure>
<h2 id="Ansible配置文件路径搜索优先级"><a href="#Ansible配置文件路径搜索优先级" class="headerlink" title="Ansible配置文件路径搜索优先级"></a>Ansible配置文件路径搜索优先级</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export ANSIBLE_CONFIG</span><br><span class="line">.&#x2F;ansible.cfg</span><br><span class="line">~&#x2F;.ansible.cfg</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</span><br></pre></td></tr></table></figure>
<h2 id="Ansible配置文件获取"><a href="#Ansible配置文件获取" class="headerlink" title="Ansible配置文件获取"></a>Ansible配置文件获取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;ansible&#x2F;目录下</span><br><span class="line">https:&#x2F;&#x2F;raw.github.com&#x2F;ansible&#x2F;ansible&#x2F;devel&#x2F;examples&#x2F;ansible.cfg</span><br></pre></td></tr></table></figure>
<h2 id="Ansible配置详细"><a href="#Ansible配置详细" class="headerlink" title="Ansible配置详细"></a>Ansible配置详细</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defaults默认配置项</span><br><span class="line">privilege_escalation执行命令的用户权限设置(ssh到客户机以哪个用户执行命令，关于这个用户的权限设置)</span><br><span class="line">paramiko_connection paramika插件设置(python插件实现的ssh协议，如果不设置会走Ansible自己的ssh协议通道)</span><br><span class="line">ssh_connection ssh连接设置</span><br><span class="line">accelerate</span><br><span class="line">selinux &amp; colors</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ask_pass &amp; ask_sudo_pass</span><br><span class="line">ask_pass：可以控制，Ansible剧本playbook是否会自动默认弹出密码输入框(遇到输入密码的情况下)</span><br><span class="line">ask_sudo_pass：用户使用的系统平台开启了sudo密码的话，应该开启这一参数(如果目标机开启了sudo免密码的话，应该开启该项，否则报错)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gather_subset</span><br><span class="line">gather_subset：设置手机的内容，包括all，network，hardware，virtual，facter，ohai</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">remote_port &amp; remote_tmp &amp; remote_user</span><br><span class="line">remote_port：设置远程客户机ssh监听的端口</span><br><span class="line">remote_tmp：设置远程客户机临时目录</span><br><span class="line">remote_user：设置远程客户机执行命令的用户(以哪个用户执行shell)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo_exe &amp; sudo_flags &amp; sudo_user</span><br><span class="line">sudo_exe：sudo命令路径(默认&#x2F;usr&#x2F;bin)</span><br><span class="line">sudo_flags：sudo参数</span><br><span class="line">sudo_user：能够使用sudo的user</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">action_plugins &amp; callback_plugins &amp; connection_plugins &amp; filter_plugins &amp; lookup_plugins &amp; vars_plugins</span><br><span class="line">开发者中心的插件相关功能，开发者可以开发相应的插件，来完成自己的功能。</span><br><span class="line">action_plugins：激活事件(在某个事件发生的时候，去执行插件中的内容)</span><br><span class="line">callback_plugins：回调</span><br><span class="line">connection_plugins：连接</span><br><span class="line">filter_plugins：过滤器</span><br><span class="line">lookup_plugins：加载路径</span><br><span class="line">vars_plugins：任何地方加载</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forks</span><br><span class="line">forks：最大开辟的进程数，这个数不宜过大，过大性能损耗高，不易过小，过小并发性能低，一般的设置方法是cpu核数*2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module_name</span><br><span class="line">module_name：这个是&#x2F;usr&#x2F;bin&#x2F;ansible的默认模块名(-m)。默认是&#39;command&#39;模块。之前提到过，command模块不支持shell变量，管道，配额。所以也许你希望把这个参数改为&#39;shell&#39;。</span><br></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vault_password_file</span><br><span class="line">vault_password_file：这个文件也可以是脚本的形式。如果你使用脚本而不是单纯文件的话，请确保它可以执行并且密码可以在标准输出上打印出来。如果你的脚本需要提示请求数据，请求将会发到标准错误输出中。</span><br><span class="line"></span><br><span class="line">存放远程客户机密码的文件，因为有时候sudo是需要输入密码的，而我们希望Ansible执行比较流畅(不需要人工干预)，这个时候可以通过机器代填密码的方式。这个文件可以是个脚本，也可以是单独的一条密码。如果是脚本，确保该脚本是可运行的，并且运行的，结果输出到标准输出中stdout。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pattern</span><br><span class="line">pattern：如果没有提供&quot;hosts&quot;节点，这是playbook要通信的默认主机组。默认值是对所有主机通信，如果不想被惊吓到，最好还是设置这个选项</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inventory &amp; library</span><br><span class="line">inventory：可通信主机的目录(默认&#x2F;etc&#x2F;ansible&#x2F;hosts)</span><br><span class="line">library：Ansible默认搜索模块路径(默认&#x2F;usr&#x2F;share&#x2F;my_modules&#x2F;)</span><br></pre></td></tr></table></figure>
<h2 id="新手上路"><a href="#新手上路" class="headerlink" title="新手上路"></a>新手上路</h2><p>如何添加一台机器？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、编辑&#x2F;etc&#x2F;ansible&#x2F;hosts</span><br><span class="line">2、添加本机的public SSH key到目标机器的authorized_keys</span><br><span class="line">3、添加本机的私钥到Ansible</span><br><span class="line">4、运行ansible all -m ping测试是否添加成功</span><br></pre></td></tr></table></figure>
<p>Ansible命令格式——ansible all -m ping</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、ansible命令主体 —— ansible&#x2F;ansible-playbook</span><br><span class="line">2、被操作的目标机器的正则表达式 —— all</span><br><span class="line">3、指定要使用的模块 —— -m ping</span><br><span class="line">4、传入的参数（ ansible all -a &#39;ls&#39; ） </span><br></pre></td></tr></table></figure>
<p>执行ping模块发生了什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">唤起Ansible --&gt; 查询hosts，获取指定的目标机器 --&gt; 调用指定模块 --&gt; 传入参数 --&gt; 返回执行结果</span><br></pre></td></tr></table></figure>
<p>Ansible命令详解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a 指定传入模块的参数</span><br><span class="line">-C -D 两个一起使用，检查hosts规则文件的修改</span><br><span class="line">-l 限制匹配规则的主机数</span><br><span class="line">--list-hosts 显示所有匹配规则的主机数</span><br><span class="line">-m -M 指定所使用的模块和模块的路径</span><br><span class="line">--syntax-check 检查语法</span><br><span class="line">-v 显示详细的日志</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible all -a &#39;ls&#39;</span><br><span class="line">ansible all -a &#39;ls&#39; --list-hosts</span><br></pre></td></tr></table></figure>
<p>Ansible——Inventory（分组）</p>
<p>什么是Inventory？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Ansible可同时操作属于一个组的多台主机，组和主机之间的关系通过inventory文件配置。默认的文件路径为&#x2F;etc&#x2F;ansible&#x2F;hosts</span><br><span class="line">中文：库存、清单</span><br><span class="line">作用：分组</span><br><span class="line"></span><br><span class="line">一个简单的实例</span><br><span class="line">one.example.com</span><br><span class="line">[webservers]</span><br><span class="line">two.example.com</span><br><span class="line">three.example.com</span><br><span class="line">方括号[]中是组名，一个主机可以属于不同的组，比如一台服务器可以同时属于webserver组和vim组。这时，指定webserver或者vim组，都可以操作这台主机。</span><br><span class="line"></span><br><span class="line">ansible webservers -a &#39;ls&#39;</span><br><span class="line">ansible &lt;IP&gt; -a &#39;ls&#39;</span><br><span class="line"></span><br><span class="line">如何自定义连接端口？</span><br><span class="line">在编写hosts文件时，在域名或者ip后加上端口号，例如：</span><br><span class="line">192.168.100.101:5000</span><br><span class="line">one.example.com:6000</span><br><span class="line"></span><br><span class="line">IP域名写起来太长？起个别名吧</span><br><span class="line">jumper ansible_ssh_port&#x3D;5555 ansible_ssh_host&#x3D;192.168.1.50</span><br><span class="line"></span><br><span class="line">不想以root用户登录</span><br><span class="line">例如：</span><br><span class="line">jumper ansible_ssh_port&#x3D;5555 ansible_ssh_host&#x3D;192.168.1.50 ansible_ssh_user&#x3D;papa</span><br><span class="line"></span><br><span class="line">机器太多，但是连续的，写起来好麻烦</span><br><span class="line">[vim]</span><br><span class="line">vim[1:50].example.com</span><br><span class="line">vim[a-f].example.com</span><br><span class="line"></span><br><span class="line">Inventory参数选项</span><br><span class="line">ansible_ssh_host</span><br><span class="line">ansible_ssh_port</span><br><span class="line">ansible_ssh_user</span><br><span class="line">ansible_ssh_pass  ssh密码(非公钥免密方式)</span><br><span class="line">ansible_sudo_pass sudo密码</span><br><span class="line">ansible_sudo_exe</span><br><span class="line">ansible_connection 与主机的连接类型。比如：local，ssh或者paramiko。</span><br><span class="line">ansible_ssh_private_key_file 私钥文件</span><br><span class="line">ansible_shell_type 目标系统的shell类型</span><br><span class="line">ansible_python_interpreter</span><br></pre></td></tr></table></figure>
<p>分文件管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">分文件 —— 例如：</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;vim         (一组)</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;webservers  (一组)</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;host_vars&#x2F;foosball     (不分组)</span><br><span class="line">vim文件中的内容大致这样：</span><br><span class="line">	---</span><br><span class="line">	ntp_server:acme.example.org</span><br><span class="line">	database_server:storage.example.org</span><br><span class="line">这时候文件名就是组名</span><br></pre></td></tr></table></figure>
<p>分文件夹管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">分文件 —— 例如：</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;vim&#x2F;install</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;vim&#x2F;init</span><br><span class="line">&#x2F;etc&#x2F;ansible&#x2F;host_vars&#x2F;foosball</span><br><span class="line">install文件中的内容大致这样：</span><br><span class="line">	---</span><br><span class="line">	ntp_server:acme.example.org</span><br><span class="line">	database_server:storage.example.org</span><br><span class="line">这时候文件夹名就是组名</span><br></pre></td></tr></table></figure>
<p>Ansible——Patterns</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">什么是Patterns？</span><br><span class="line">	在Ansible中，Patterns是指我们通过类正则表达式的方式，决定与哪台主机进行交互</span><br><span class="line">	</span><br><span class="line">1、所有hosts机器：all或者星号(*)</span><br><span class="line">	例如：</span><br><span class="line">		ansible all -m ping</span><br><span class="line">2、通过域名或者IP指定一台特定的机器</span><br><span class="line">	例如：</span><br><span class="line">		ansible one.example.com -m ping</span><br><span class="line">		ansible 192.168.1.2 -m ping</span><br><span class="line">3、指定一组连续机器</span><br><span class="line">	例如：</span><br><span class="line">		ansible 192.168.1.* -m ping 指定192.168.1.0&#x2F;24段的所有机器</span><br><span class="line">4、指定一组不相关的机器</span><br><span class="line">	例如：</span><br><span class="line">		ansible one.example.com:two.example.com -m ping 指定one two两台机器</span><br><span class="line">5、组也支持Patterns</span><br><span class="line">	webservers -- 指定webserver组</span><br><span class="line">	webservers:nginx -- 指定webservers和nginx两个组</span><br><span class="line">6、与和非</span><br><span class="line">	webservers:!phoenix -- 指定在webserver组但不在phoenix组</span><br><span class="line">	webservers:&amp;nginx -- 指定同时在webservers和nginx组</span><br><span class="line"></span><br><span class="line">问题：webservers:nginx:&amp;vim:!python:!mysql</span><br><span class="line">如上的语句是什么意思？</span><br><span class="line">温馨提示：匹配时从左到右依次匹配！</span><br></pre></td></tr></table></figure>
<p>Ansible——Ad-Hoc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">什么是Ad-Hoc</span><br><span class="line">	这其实是一个概念性的名字，是相对于写Ansible playbook来说的。类似于在命令行敲入shell命令和写shell scripts两者之间的关系</span><br><span class="line">	如果我们敲入一些命令去比较快的完成一些事情，而不需要将这些执行的命令保存下来，这样的命令就叫做ad-hoc命令。</span><br><span class="line"></span><br><span class="line">执行shell命令：</span><br><span class="line">	ansible atlanta -a &quot;&#x2F;sbin&#x2F;reboot&quot; -f 10</span><br><span class="line">	这个命令中，atlanta是一个组，这个组里面有很多服务器，&quot;&#x2F;sbin&#x2F;reboot&quot;命令会在atlanta组下的所有机器上执行。这里ssh-agent会fork出10个子进程(bash)以并行的方式执行reboot命令。如前所说&quot;每次重启10个&quot;即是以这种方式实现。</span><br><span class="line">	</span><br><span class="line">指定用户执行shell命令：</span><br><span class="line">	ansible atlanta -a &quot;&#x2F;usr&#x2F;bin&#x2F;foo&quot; -u username</span><br><span class="line">使用sudo：</span><br><span class="line">	ansible atlanta -a &quot;&#x2F;usr&#x2F;bin&#x2F;foo&quot; -u username --sudo [--ask-sudo-pass]</span><br><span class="line"></span><br><span class="line">文件管理：</span><br><span class="line">	创建文件夹：ansible webservers -m file -a &quot;dest&#x3D;&#x2F;path&#x2F;to&#x2F;c mode&#x3D;755 owner&#x3D;mdehaan group&#x3D;mdehaan state&#x3D;directory&quot;</span><br><span class="line">	拷贝文件：ansible atlanta -m copy -a &quot;src&#x3D;&#x2F;etc&#x2F;hosts dest&#x3D;&#x2F;tmp&#x2F;hosts&quot;</span><br><span class="line"></span><br><span class="line">软件包管理：</span><br><span class="line">	确认一个软件包已经安装，但不去升级它：ansible webservers -m yum -a &quot;name&#x3D;acme state&#x3D;present&quot;</span><br><span class="line">	确认一个软件包的安装版本：ansible webservers -m yum -a &quot;name&#x3D;acme-1.5 state&#x3D;present&quot;</span><br><span class="line">	确认一个软件包还没有安装：ansible webservers -m yum -a &quot;name&#x3D;acme state&#x3D;absent&quot;</span><br><span class="line"></span><br><span class="line">其他模块</span><br><span class="line">	git模块：git相关</span><br><span class="line">	service模块：系统服务相关</span><br><span class="line">	setup模块：系统环境相关</span><br></pre></td></tr></table></figure>
<p>如何执行一个耗时的任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ansible all -B 3600 -P 0 -a &quot;&#x2F;usr&#x2F;bin&#x2F;long_running_operation --do-stuff&quot;</span><br><span class="line">-B 1800 表示最多运行60分钟，-P 0表示不获取状态</span><br><span class="line"></span><br><span class="line">ansible all -B 1800 -P 60 -a &quot;&#x2F;usr&#x2F;bin&#x2F;long_running_operation --do-stuff&quot;</span><br><span class="line">-B 1800表示最多运行30分钟，-P 60表示每隔一分钟获取一次状态</span><br><span class="line"></span><br><span class="line">ansible web1.example.com -m async_status -a &quot;jid&#x3D;488359678239.2844&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Ansible——Playbook简介"><a href="#Ansible——Playbook简介" class="headerlink" title="Ansible——Playbook简介"></a>Ansible——Playbook简介</h2><p>什么是playbook？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">简单来说，playbook是一种简单的配置管理系统与多机器部署系统的基础。与现有的其他系统有不同之处，且非常适合于复杂应用的部署。</span><br><span class="line"></span><br><span class="line">playbook可用于声明配置，更强大的地方在于，在playbooks中可以编排有序的执行过程，甚至于做到在多组机器间，来回有序的执行特别指定的步骤。并且可以同步或异步的发起任务。</span><br></pre></td></tr></table></figure>
<h2 id="Ansible-API"><a href="#Ansible-API" class="headerlink" title="Ansible API"></a>Ansible API</h2><p>API提供了哪些功能？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、调用Ansible的模块</span><br><span class="line">2、开发动态的Inventory数据源</span><br><span class="line">3、更好的控制playbook等功能的运行</span><br></pre></td></tr></table></figure>
<p>如何调用Ansible模块？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、引入Ansible runner库</span><br><span class="line">2、初始化runner对象，传入相关参数</span><br><span class="line">3、运行runner对象的run函数</span><br><span class="line"></span><br><span class="line">示例代码（Ansible2.0之前）：</span><br><span class="line">import ansible.runner</span><br><span class="line"></span><br><span class="line">runner &#x3D; ansible.runner.Runner(</span><br><span class="line">	module_name&#x3D;&#39;ping&#39;,</span><br><span class="line">	module_args&#x3D;&#39;&#39;,</span><br><span class="line">	pattern&#x3D;&#39;web*&#39;,</span><br><span class="line">	forks&#x3D;10</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">datastructrue &#x3D; runner.run()</span><br></pre></td></tr></table></figure>
<h1 id="Directory-Layout-目录布局"><a href="#Directory-Layout-目录布局" class="headerlink" title="Directory Layout 目录布局"></a>Directory Layout 目录布局</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">production                # inventory file for production servers（生产服务器的inventory文件）</span><br><span class="line">staging                   # inventory file for staging environment（临时环境的inventory文件）</span><br><span class="line"></span><br><span class="line">group_vars&#x2F;</span><br><span class="line">   group1.yml             # here we assign variables to particular groups（将变量分配给特定的groups）</span><br><span class="line">   group2.yml</span><br><span class="line">host_vars&#x2F;</span><br><span class="line">   hostname1.yml          # here we assign variables to particular systems（将变量分配给特定systems）</span><br><span class="line">   hostname2.yml</span><br><span class="line"></span><br><span class="line">library&#x2F;                  # if any custom modules, put them here (可选)（放置自定义modules）</span><br><span class="line">module_utils&#x2F;             # if any custom module_utils to support modules, put them here (可选)（放置支持modules的自定义module_utils）</span><br><span class="line">filter_plugins&#x2F;           # if any custom filter plugins, put them here (可选)（放置自定义filter plugins）</span><br><span class="line"></span><br><span class="line">site.yml                  # master playbook（playbook入口）</span><br><span class="line">webservers.yml            # playbook for webserver tier（webserver层playbook）</span><br><span class="line">dbservers.yml             # playbook for dbserver tier（dbserver层playbook）</span><br><span class="line"></span><br><span class="line">roles&#x2F;</span><br><span class="line">    common&#x2F;               # this hierarchy represents a &quot;role&quot;（这个层次代表role）</span><br><span class="line">        tasks&#x2F;            #</span><br><span class="line">            main.yml      #  &lt;-- tasks file can include smaller files if warranted（tasks文件）</span><br><span class="line">        handlers&#x2F;         #</span><br><span class="line">            main.yml      #  &lt;-- handlers file（处理程序文件）</span><br><span class="line">        templates&#x2F;        #  &lt;-- files for use with the template resource（用于模板资源的文件）</span><br><span class="line">            ntp.conf.j2   #  &lt;------- templates end in .j2（模板以.j2结尾）</span><br><span class="line">        files&#x2F;            #</span><br><span class="line">            bar.txt       #  &lt;-- files for use with the copy resource（用于复制资源的文件）</span><br><span class="line">            foo.sh        #  &lt;-- script files for use with the script resource（用于脚本资源的脚本文件）</span><br><span class="line">        vars&#x2F;             #</span><br><span class="line">            main.yml      #  &lt;-- variables associated with this role（与此role关联的变量）</span><br><span class="line">        defaults&#x2F;         #</span><br><span class="line">            main.yml      #  &lt;-- default lower priority variables for this role（此role的默认优先级较低的变量）</span><br><span class="line">        meta&#x2F;             #</span><br><span class="line">            main.yml      #  &lt;-- role dependencies（role依赖）</span><br><span class="line">        library&#x2F;          # roles can also include custom modules（role还可以包括自定义modules）</span><br><span class="line">        module_utils&#x2F;     # roles can also include custom module_utils（role还可以包括自定义module_utils）</span><br><span class="line">        lookup_plugins&#x2F;   # or other types of plugins, like lookup in this case（或其他类型的plugins，例如lookup）</span><br><span class="line"></span><br><span class="line">    webtier&#x2F;              # same kind of structure as &quot;common&quot; was above, done for the webtier role（与上面的&quot;common&quot;相同的结构，为webtier role定义）</span><br><span class="line">    monitoring&#x2F;           # &quot;&quot;</span><br><span class="line">    fooapp&#x2F;               # &quot;&quot;</span><br></pre></td></tr></table></figure>
<h1 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h1><p>查看环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-config dump</span><br></pre></td></tr></table></figure>


<h2 id="课程地址"><a href="#课程地址" class="headerlink" title="课程地址"></a>课程地址</h2><p><a target="_blank" rel="noopener" href="https://www.imooc.com/video/15236">https://www.imooc.com/video/15236</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/08/golangpkg%E8%A2%AB%E5%A2%99%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/08/golangpkg%E8%A2%AB%E5%A2%99%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" class="post-title-link" itemprop="url">golangpkg被墙解决办法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-08 23:26:29" itemprop="dateCreated datePublished" datetime="2018-07-08T23:26:29+08:00">2018-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文：<a target="_blank" rel="noopener" href="http://www.10tiao.com/html/489/201702/2247483836/1.html">http://www.10tiao.com/html/489/201702/2247483836/1.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$mkdir -p $GOPATH&#x2F;src&#x2F;golang.org&#x2F;x&#x2F;</span><br><span class="line">$cd $GOPATH&#x2F;src&#x2F;golang.org&#x2F;x&#x2F;</span><br><span class="line">$git clone https:&#x2F;&#x2F;github.com&#x2F;golang&#x2F;net.git net </span><br><span class="line">$go install net </span><br><span class="line">或者</span><br><span class="line">$git clone https:&#x2F;&#x2F;github.com&#x2F;golang&#x2F;text.git $GOPATH&#x2F;src&#x2F;golang.org&#x2F;x&#x2F;text</span><br><span class="line">$git clone https:&#x2F;&#x2F;github.com&#x2F;golang&#x2F;net.git $GOPATH&#x2F;src&#x2F;golang.org&#x2F;x&#x2F;net</span><br></pre></td></tr></table></figure>
<h3 id="go-get-获取第三方库"><a href="#go-get-获取第三方库" class="headerlink" title="go get 获取第三方库"></a>go get 获取第三方库</h3><ul>
<li>go get命令演示</li>
<li>使用gopm来获取无法下载的包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yujiangdeMBP-13:~ yujiang$ go get -v github.com&#x2F;gpmgo&#x2F;gopm</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:~ yujiang$ cat ~&#x2F;.bashrc</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;home&#x2F;go&#x2F;bin:&#x2F;root&#x2F;go&#x2F;bin</span><br><span class="line">export GOPATH&#x3D;&quot;&#x2F;root&#x2F;go&quot;</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ source ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">yujiangdeMBP-13:~ yujiang$ gopm get -g -v golang.org&#x2F;x&#x2F;tools&#x2F;cmd&#x2F;goimports</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ ls go&#x2F;src&#x2F;golang.org&#x2F;x&#x2F;tools&#x2F;imports&#x2F;</span><br><span class="line">fix.go         fix_test.go    imports.go     mkindex.go     mkstdlib.go    sortimports.go zstdlib.go</span><br><span class="line"># 编译出goimports</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ go build  golang.org&#x2F;x&#x2F;tools&#x2F;cmd&#x2F;goimports</span><br><span class="line"># 编译并安装到$GOPATH&#x2F;bin&#x2F;目录下</span><br><span class="line">yujiangdeMBP-13:~ yujiang$ go install  golang.org&#x2F;x&#x2F;tools&#x2F;cmd&#x2F;goimports</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">go get -v github.com&#x2F;golang&#x2F;tools&#x2F;go&#x2F;...</span><br><span class="line">go get -v github.com&#x2F;golang&#x2F;tools&#x2F;...</span><br><span class="line"></span><br><span class="line">go get -u golang.org&#x2F;x&#x2F;tools&#x2F;...</span><br></pre></td></tr></table></figure>
<ul>
<li>go build编译</li>
<li>go install产生pkg文件和可执行文件</li>
<li>go run直接编译运行</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/06/18/jenkins%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/18/jenkins%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">jenkins安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-18 23:52:49" itemprop="dateCreated datePublished" datetime="2018-06-18T23:52:49+08:00">2018-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="centos-install"><a href="#centos-install" class="headerlink" title="centos install"></a>centos install</h1><p>安装文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;pkg.jenkins.io&#x2F;redhat-stable&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;www.vultr.com&#x2F;docs&#x2F;how-to-install-jenkins-on-centos-7</span><br></pre></td></tr></table></figure>
<p>启动jenkins</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start jenkins.service</span><br><span class="line">systemctl enable jenkins.service</span><br></pre></td></tr></table></figure>
<p>中文插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Locale plugin</span><br></pre></td></tr></table></figure>
<p> 多任务插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Multijob plugin</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/06/15/Repo-for-Microsoft-Windows-and-Linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/15/Repo-for-Microsoft-Windows-and-Linux/" class="post-title-link" itemprop="url">Repo for Microsoft Windows and Linux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-15 22:28:18" itemprop="dateCreated datePublished" datetime="2018-06-15T22:28:18+08:00">2018-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这是E.S.R.Labs Repo —— 就像Google Repo，但它也可以在Microsoft Windows运行。Repo是Google建立在Git之上的repository管理工具。必要时，Repo会统一许多Git repositories上传到版本控制系统，并使部分开发工作流程自动化。Repo并不意味着取代Git，只是为了更容易在多个repositories的环境中使用Git。repo command是一个可执行的Python脚本，您可以将其放在任何路径。在处理源文件时，您将使用Repo进行跨网络操作。例如，使用Repo命令，可以将多个repositories中的文件下载到本地工作目录中。</p>
<h2 id="Setup-steps-for-Microsoft-Windows"><a href="#Setup-steps-for-Microsoft-Windows" class="headerlink" title="Setup steps for Microsoft Windows"></a>Setup steps for Microsoft Windows</h2><p>修复权限以允许创建符号链接</p>
<p>如果您是Administrators group的member，则必须关闭<a target="_blank" rel="noopener" href="https://support.microsoft.com/en-us/products/windows?os=windows-10">User Access Control</a> (UAC)，然后重新启动计算机。</p>
<p>否则，您必须调整您的用户权限才能获得<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6722589/using-windows-mklink-for-linking-2-files">SeCreateSymbolicLinkPrivilege</a>权限。editrights工具是作为Microsoft Windows的git-repo的一部分提供的。</p>
<p>Highly experimental（除开发此功能外，请勿使用！）：如果您不想使用符号链接，而是文件夹和文件的硬链接（hardlinks），则必须在<code>~/.gitconfig</code>中设置以下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[portable]</span><br><span class="line">      windowsNoSymlinks &#x3D; true</span><br></pre></td></tr></table></figure>
<p>这不需要上述所说的设置权限。</p>
<p>已知问题：硬链接被git销毁，例如，当你删除一个branch时（breaks .git/config）。这会破坏project workspace！</p>
<h3 id="Download-and-install-Git"><a href="#Download-and-install-Git" class="headerlink" title="Download and install Git"></a>Download and install Git</h3><p>下载Git（<a target="_blank" rel="noopener" href="http://git-scm.com/downloads%EF%BC%89">http://git-scm.com/downloads）</a></p>
<p>将Git添加到path环境变量中：例如C:\Program Files (x86)\Git\cmd;</p>
<p>将MinGW添加到path环境变量中：例如C:\Program Files (x86)\Git\bin;</p>
<h3 id="Download-and-install-Python"><a href="#Download-and-install-Python" class="headerlink" title="Download and install Python"></a>Download and install Python</h3><p>下载Python 2.7+（<a target="_blank" rel="noopener" href="https://www.python.org/downloads/%EF%BC%89">https://www.python.org/downloads/）</a></p>
<p>将Python添加到path环境变量中：例如C:\Python27;</p>
<p>注意：git-repo在实验环境支持Python 3.x</p>
<h3 id="使用Windows-Command-Shell或Git-Bash下载并安装Repo"><a href="#使用Windows-Command-Shell或Git-Bash下载并安装Repo" class="headerlink" title="使用Windows Command Shell或Git Bash下载并安装Repo"></a>使用Windows Command Shell或Git Bash下载并安装Repo</h3><p>Windows Command Shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">md %USERPROFILE%\bin</span><br><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo &gt; %USERPROFILE%&#x2F;bin&#x2F;repo</span><br><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo.cmd &gt; %USERPROFILE%&#x2F;bin&#x2F;repo.cmd</span><br></pre></td></tr></table></figure>
<p>Windows PowerShell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">md $env:USERPROFILE\bin</span><br><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo &gt; $env:USERPROFILE&#x2F;bin&#x2F;repo</span><br><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo.cmd &gt; $env:USERPROFILE&#x2F;bin&#x2F;repo.cmd</span><br></pre></td></tr></table></figure>
<p>Git Bash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~&#x2F;bin</span><br><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo &gt; ~&#x2F;bin&#x2F;repo</span><br><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo.cmd &gt; ~&#x2F;bin&#x2F;repo.cmd</span><br></pre></td></tr></table></figure>
<p>将Repo添加path环境变量：%USERPROFILE%\bin;</p>
<p>创建一个指向％USERPROFILE％的HOME环境变量（OpenSSH需要找到它的.ssh目录）。</p>
<p>创建一个GIT_EDITOR环境变量，其中包含一个editor可执行文件作为值。为此，首先将editor可执行文件的主目录添加到path环境变量中。例如，GIT_EDITOR可以设置为”notepad++.exe”，”gvim.exe”。</p>
<h3 id="Setup-steps-for-Linux"><a href="#Setup-steps-for-Linux" class="headerlink" title="Setup steps for Linux"></a>Setup steps for Linux</h3><p>下载并安装Git和Python</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git-core</span><br><span class="line">sudo apt-get install python</span><br></pre></td></tr></table></figure>
<p>下载并安装Repo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir ~&#x2F;bin</span><br><span class="line">$ PATH&#x3D;~&#x2F;bin:$PATH</span><br><span class="line">$ curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;esrlabs&#x2F;git-repo&#x2F;stable&#x2F;repo &gt; ~&#x2F;bin&#x2F;repo</span><br><span class="line">$ chmod a+x ~&#x2F;bin&#x2F;repo</span><br></pre></td></tr></table></figure>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>有关git-repo用法的更多详细说明，请访问<a target="_blank" rel="noopener" href="http://source.android.com/source/using-repo.html">git</a>-repo。</p>
<h3 id="常见问题解答"><a href="#常见问题解答" class="headerlink" title="常见问题解答"></a>常见问题解答</h3><ul>
<li>我无法看到repo状态的任何颜色</li>
</ul>
<p>用于repo状态的pager默认设置为less，除非另外配置，否则将忽略转义序列。您可以将环境变量LESS设置为-FRSX以减少处理颜色。 （您可能还想将LESSCHARSET设置为utf-8）</p>
<p>它仍然不起作用！</p>
<p>对pager有更多的选择。它的行为并不像less一样，但它对你来说可能已经足够了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.pager more</span><br></pre></td></tr></table></figure>
<p>或者，环境变量GIT_PAGER可以设置为more。</p>
<ul>
<li>在使用repo init初始化我的repo时，我在Windows Command Shell中遇到WindowsError</li>
</ul>
<p>如果在输出开始时出现警告，表示GPG不可用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">warning: gpg (GnuPG) is not available.</span><br><span class="line">warning: Installing it is strongly encouraged.</span><br></pre></td></tr></table></figure>
<p>你必须添加gpg.exe到你的PATH变量。可执行文件可以在Git安装文件夹<code>$GIT\usr\bin</code>中找到。当你使用Git Bash时，<code>$Git\usr\bin</code>文件夹已经被添加到你的PATH中。</p>
<h3 id="Developer-Information"><a href="#Developer-Information" class="headerlink" title="Developer Information"></a>Developer Information</h3><p>与official google repo同步</p>
<p>为了与official google repo git同步，这里是与official google repo的tag v1.12.33同步的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># add google git-repo remote with tag</span><br><span class="line">git remote add googlesource https:&#x2F;&#x2F;android.googlesource.com&#x2F;tools&#x2F;repo&#x2F;</span><br><span class="line">git checkout v1.12.33 -b google-latest</span><br><span class="line"></span><br><span class="line"># checkout basis for resync</span><br><span class="line">git checkout google-git-repo-base -b update</span><br><span class="line">git merge --allow-unrelated-histories -Xtheirs --squash google-latest</span><br><span class="line">git commit -m &quot;Update: google git-repo v1.12.33&quot;</span><br><span class="line">git rebase stable</span><br><span class="line"></span><br><span class="line"># solve conflicts; keep portability in mind</span><br><span class="line"></span><br><span class="line">git checkout stable</span><br><span class="line">git rebase update</span><br><span class="line"></span><br><span class="line"># cleanup</span><br><span class="line">git branch -D update</span><br><span class="line">git branch -D google-latest</span><br></pre></td></tr></table></figure>
<h3 id="创建一个新的签名版本"><a href="#创建一个新的签名版本" class="headerlink" title="创建一个新的签名版本"></a>创建一个新的签名版本</h3><p>用于创建新版本repo的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag -s -u KEYID v0.4.16 -m &quot;COMMENT&quot;</span><br><span class="line">git push origin stable:stable</span><br><span class="line">git push origin v0.4.16</span><br></pre></td></tr></table></figure>
<p>替换KEYID（类似0x ..）</p>
<p>v0.4.16（两次）</p>
<p>用更多的解释替换COMMENT</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/06/11/LTP-C-Test-Case%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/11/LTP-C-Test-Case%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">LTP C Test Case教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-11 23:19:03" itemprop="dateCreated datePublished" datetime="2018-06-11T23:19:03+08:00">2018-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>LTP测试可以用C或Shell脚本编写。</p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><p>Git-clone主LTP repository，如自述文件中所述, 并更改目录到checked-out的Git repository。我们建议安装LTP并运行Quick guide（在自述文件中）中提到的测试之一，以确保您从良好的状态开始。我们还建议克隆Linux kernel repository以供参考，本指南将涉及主线kernel 4.12内的文件和目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git:&#x2F;&#x2F;git.kernel.org&#x2F;pub&#x2F;scm&#x2F;linux&#x2F;kernel&#x2F;git&#x2F;torvalds&#x2F;linux.git</span><br></pre></td></tr></table></figure>
<p>还有许多其他的repositories可以参考，包括GNU C library glibc和可选的C library musl。一些system calls被部分或完全实现在user land作为标准C  library的一部分。所以在这些情况下，C library是一个重要的参考。glibc是Linux最常用的C library，然而musl通常更容易理解。</p>
<p>实现system calls的方式因体系结构，以及内核版本和C library版本而异。要找出system calls是否真的在任何机器上访问内核，可以使用strace。这会拦截system calls并打印它们。我们将在后面的教程中使用它。</p>
<h2 id="Choose-a-System-Call-to-test"><a href="#Choose-a-System-Call-to-test" class="headerlink" title="Choose a System Call to test"></a>Choose a System Call to test</h2><p>我们将使用<code>statx()</code> system call来提供测试的具体示例。在撰写本文时，没有测试Linux内核版本4.11中的system call。Linux system call特定的测试主要包含在testcases/kernel/syscalls目录，但你也可以grep整个LTP repository以检查任何现有system call的用法。</p>
<p>找到当前未被LTP测试的system call的方法是在内核树中查看include/linux/syscalls.h。</p>
<h3 id="Find-an-untested-System-call"><a href="#Find-an-untested-System-call" class="headerlink" title="Find an untested System call"></a>Find an untested System call</h3><p>尝试找到一个未经测试的系统调用，它有一个手册页（即man syscall产生一个结果）。Git-clone最新的kernel man-pages repository是一个好主意。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git:&#x2F;&#x2F;git.kernel.org&#x2F;pub&#x2F;scm&#x2F;docs&#x2F;man-pages&#x2F;man-pages.git</span><br></pre></td></tr></table></figure>
<p>在写这篇文章时，最新的man-pages release和repository HEAD之间的差异超过了100次commits。这代表了大约9周的变化。如果你使用的是稳定的Linux发行版，那么你的man-pages package可能已经有几年了。就像kernel一样，最好有Git repository作为参考。</p>
<h2 id="Create-the-test-skeleton"><a href="#Create-the-test-skeleton" class="headerlink" title="Create the test skeleton"></a>Create the test skeleton</h2><p>我将调用我的测试statx01.c，在你读这个文件名的时候，可能会采用这个文件名，所以可以根据需要增加文件名中的数字，或者用练习2.1中选择的system call替换statx。（怕被占用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir testcases&#x2F;kernel&#x2F;syscalls&#x2F;statx</span><br><span class="line">$ cd testcases&#x2F;kernel&#x2F;syscalls&#x2F;statx</span><br><span class="line">$ echo statx &gt;&gt; .gitignore</span><br></pre></td></tr></table></figure>
<p>接下来打开statx01.c并添加如下。确保将right notice更改为您的name/company，如有必要，更正test name和最低kernel version。我将在下面解释代码的作用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line"> * Copyright (c) 2017 Instruction Ignorer &lt;&quot;can&#39;t&quot;@be.bothered.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * This program is free software: you can redistribute it and&#x2F;or modify</span><br><span class="line"> * it under the terms of the GNU General Public License as published by</span><br><span class="line"> * the Free Software Foundation, either version 2 of the License, or</span><br><span class="line"> * (at your option) any later version.</span><br><span class="line"> *</span><br><span class="line"> * This program is distributed in the hope that it will be useful,</span><br><span class="line"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"> * GNU General Public License for more details.</span><br><span class="line"> *</span><br><span class="line"> * You should have received a copy of the GNU General Public License</span><br><span class="line"> * along with this program. If not, see &lt;http:&#x2F;&#x2F;www.gnu.org&#x2F;licenses&#x2F;&gt;.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line"> * Test statx</span><br><span class="line"> *</span><br><span class="line"> * All tests should start with a description of _what_ we are testing.</span><br><span class="line"> * Non-trivial explanations of _how_ the code works should also go here.</span><br><span class="line"> * Include relevant links, Git commit hashes and CVE numbers.</span><br><span class="line"> * Inline comments should be avoided.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">#include &quot;tst_test.h&quot;</span><br><span class="line"></span><br><span class="line">static void run(void)</span><br><span class="line">&#123;</span><br><span class="line">	tst_res(TPASS, &quot;Doing hardly anything is easy&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static struct tst_test test &#x3D; &#123;</span><br><span class="line">	.test_all &#x3D; run,</span><br><span class="line">	.min_kver &#x3D; &quot;4.11&quot;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从<code>#include</code>语句开始，我们将复制main LTP test library headers。这包括最常见的test API函数和test harness初始化代码。需要注意的是，这是一个完全普通的，独立的C程序，但缺少main()，因为它在tst_test.h中实现。</p>
<p>我们使用tst_test结构指定运行一部分测试代码。测试编写器可以设置各种回调，包括我们已经设置为运行（）的test.test_all。test writer可以设置各种回调, 包括test.test_all，我们已经设置run()。测试工具将在一个单独的进程（使用fork()）中执行此回调，如果在test.timeout秒后没有返回，则强制终止它。</p>
<h2 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h2><p>【1】<a target="_blank" rel="noopener" href="https://github.com/linux-test-project/ltp/wiki/C-Test-Case-Tutorial">https://github.com/linux-test-project/ltp/wiki/C-Test-Case-Tutorial</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/06/08/Linux%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/08/Linux%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Linux常用配置命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-08 20:23:59" itemprop="dateCreated datePublished" datetime="2018-06-08T20:23:59+08:00">2018-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LSB Version:	:core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch</span><br><span class="line">Distributor ID:	CentOS</span><br><span class="line">Description:	CentOS Linux release 7.4.1708 (Core) </span><br><span class="line">Release:	7.4.1708</span><br><span class="line">Codename:	Core</span><br></pre></td></tr></table></figure>
<h2 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip  -h</span><br><span class="line">Usage: ip [ OPTIONS ] OBJECT &#123; COMMAND | help &#125;</span><br><span class="line">       ip [ -force ] -batch filename</span><br><span class="line">where  OBJECT :&#x3D; &#123; link | address | addrlabel | route | rule | neigh | ntable |</span><br><span class="line">                   tunnel | tuntap | maddress | mroute | mrule | monitor | xfrm |</span><br><span class="line">                   netns | l2tp | macsec | tcp_metrics | token &#125;</span><br><span class="line">       OPTIONS :&#x3D; &#123; -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] |</span><br><span class="line">                    -h[uman-readable] | -iec |</span><br><span class="line">                    -f[amily] &#123; inet | inet6 | ipx | dnet | bridge | link &#125; |</span><br><span class="line">                    -4 | -6 | -I | -D | -B | -0 |</span><br><span class="line">                    -l[oops] &#123; maximum-addr-flush-attempts &#125; |</span><br><span class="line">                    -o[neline] | -t[imestamp] | -ts[hort] | -b[atch] [filename] |</span><br><span class="line">                    -rc[vbuf] [size] | -n[etns] name | -a[ll] &#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取系统上所有网络接口的信息"><a href="#获取系统上所有网络接口的信息" class="headerlink" title="获取系统上所有网络接口的信息"></a>获取系统上所有网络接口的信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1&#x2F;128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:3a:98:1d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:52:03:aa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.102&#x2F;24 brd 192.168.56.255 scope global dynamic enp0s8</span><br><span class="line">       valid_lft 945sec preferred_lft 945sec</span><br><span class="line">    inet6 fe80::4b2b:b766:22c:f503&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:3e:3e:e2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN qlen 1000</span><br><span class="line">    link&#x2F;ether 52:54:00:66:bf:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1&#x2F;24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">6: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN qlen 1000</span><br><span class="line">    link&#x2F;ether 52:54:00:66:bf:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line"></span><br><span class="line">scope解释，ip地址和路由都有一个域的概念，主要是告诉内核他们起作用的上下文。</span><br><span class="line">在linux中，路由的域表明了目的网络和本机的距离。</span><br><span class="line">而ip地址的域说明了这个ip地址的作用域。</span><br><span class="line">在linux中一共有3种作用域，分别是HOST，LINK(对于ip地址来说说明这个地址是只在lan中使用，而对于route来说目的的地址在lan中),Universe&#x2F;global(广域网的地址,对于route来说要到达这个地址肯定会多于1跳)。</span><br><span class="line">要注意，域的默认值是Universe，也就是说你不显示指明，则默认都是Universe。</span><br><span class="line"></span><br><span class="line">查看IP地址</span><br><span class="line">[root@cephL ~]# ip addr show enp0s8</span><br><span class="line">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:52:03:aa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.102&#x2F;24 brd 192.168.56.255 scope global dynamic enp0s8</span><br><span class="line">       valid_lft 847sec preferred_lft 847sec</span><br><span class="line">    inet6 fe80::4b2b:b766:22c:f503&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">查看IPv6地址</span><br><span class="line">[root@cephL ~]# ip -6 addr show dev enp0s8</span><br><span class="line">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 state UP qlen 1000</span><br><span class="line">    inet6 fe80::4b2b:b766:22c:f503&#x2F;64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">添加IP地址</span><br><span class="line">[root@cephL ~]# ip addr add 192.168.56.103&#x2F;24 dev enp0s8</span><br><span class="line">删除IP地址</span><br><span class="line">[root@cephL ~]# ip addr del 192.168.56.103&#x2F;24 dev enp0s8</span><br></pre></td></tr></table></figure>
<p>路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip route show</span><br><span class="line">192.168.56.0&#x2F;24 dev enp0s8 proto kernel scope link src 192.168.56.102 metric 100 </span><br><span class="line">192.168.122.0&#x2F;24 dev virbr0 proto kernel scope link src 192.168.122.1</span><br><span class="line"></span><br><span class="line">让kernel报告路由，它会发送一个数据包到指定的地址</span><br><span class="line">[root@cephL ~]# ip route get 61.135.169.125</span><br><span class="line">61.135.169.125 via 10.116.21.254 dev enp0s9 src 10.116.21.135 </span><br><span class="line">    cache</span><br><span class="line">（解释：61.135.169.125是访问的地址，10.116.21.254是默认路由，10.116.21.135是enp0s9设备IP地址）</span><br><span class="line"></span><br><span class="line">添加默认路由</span><br><span class="line">[root@cephL ~]# ip route add default via 10.116.21.253 dev enp0s9</span><br><span class="line">删除默认路由</span><br><span class="line">[root@cephL ~]# ip route del default via 10.116.21.253 dev enp0s9</span><br></pre></td></tr></table></figure>
<p>不同网络接口的统计信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip -s link</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    189813592  61558    0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    189813592  61558    0       0       0       0       </span><br><span class="line">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:3a:98:1d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    0          0        0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    0          0        0       0       0       0       </span><br><span class="line">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:52:03:aa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    104188     1104     0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    159594     673      0       0       0       0       </span><br><span class="line">4: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:3e:3e:e2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    53777      574      0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    60106      623      0       0       0       0       </span><br><span class="line">5: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link&#x2F;ether 52:54:00:66:bf:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    0          0        0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    0          0        0       0       0       0       </span><br><span class="line">6: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link&#x2F;ether 52:54:00:66:bf:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    0          0        0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    0          0        0       0       0       0       </span><br><span class="line"></span><br><span class="line">查询特定接口统计信息</span><br><span class="line">[root@cephL ~]# ip -s link ls enp0s9</span><br><span class="line">4: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:3e:3e:e2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    54527      583      0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    60946      633      0       0       0       0 </span><br></pre></td></tr></table></figure>
<p>ARP，查看接入的MAC地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip neighbour</span><br><span class="line">192.168.56.1 dev enp0s8 lladdr 0a:00:27:00:00:00 DELAY</span><br><span class="line">10.116.21.254 dev enp0s9 lladdr 00:00:0c:07:ac:0c DELAY</span><br><span class="line">10.116.21.253 dev enp0s9 lladdr b4:de:31:c7:e7:47 STALE</span><br><span class="line">192.168.56.100 dev enp0s8 lladdr 08:00:27:3e:18:34 STALE</span><br><span class="line">10.116.21.252 dev enp0s9 lladdr b4:de:31:c7:d8:e7 STALE</span><br></pre></td></tr></table></figure>
<p>ip工具可以连续监视devices, addresses和routes的状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip monitor all</span><br><span class="line">[nsid current]192.168.56.1 dev enp0s8 lladdr 0a:00:27:00:00:00 REACHABLE</span><br><span class="line">[nsid current]10.116.21.254 dev enp0s9 lladdr 00:00:0c:07:ac:0c STALE</span><br><span class="line">[nsid current]192.168.56.1 dev enp0s8 lladdr 0a:00:27:00:00:00 REACHABLE</span><br><span class="line">[nsid current]10.116.21.254 dev enp0s9 lladdr 00:00:0c:07:ac:0c REACHABLE</span><br><span class="line">[nsid current]3: enp0s8    inet 192.168.56.102&#x2F;24 brd 192.168.56.255 scope global dynamic enp0s8</span><br><span class="line">       valid_lft 1200sec preferred_lft 1200sec</span><br></pre></td></tr></table></figure>
<p>up和down网络设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip link set enp0s9 down </span><br><span class="line">[root@cephL ~]# ip route show</span><br><span class="line">192.168.56.0&#x2F;24 dev enp0s8 proto kernel scope link src 192.168.56.102 metric 100 </span><br><span class="line">192.168.122.0&#x2F;24 dev virbr0 proto kernel scope link src 192.168.122.1</span><br><span class="line">[root@cephL ~]# ping www.baidu.com</span><br><span class="line">ping: www.baidu.com: 未知的名称或服务</span><br><span class="line"></span><br><span class="line">[root@cephL ~]# ip link set enp0s9 up</span><br><span class="line">[root@cephL ~]# ip route show</span><br><span class="line">default via 10.116.21.254 dev enp0s9 proto static metric 100 </span><br><span class="line">10.116.20.0&#x2F;23 dev enp0s9 proto kernel scope link src 10.116.21.135 metric 100 </span><br><span class="line">192.168.56.0&#x2F;24 dev enp0s8 proto kernel scope link src 192.168.56.102 metric 100 </span><br><span class="line">192.168.122.0&#x2F;24 dev virbr0 proto kernel scope link src 192.168.122.1</span><br><span class="line">[root@cephL ~]# ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (61.135.169.121) 56(84) bytes of data.</span><br><span class="line">64 bytes from 61.135.169.121 (61.135.169.121): icmp_seq&#x3D;1 ttl&#x3D;50 time&#x3D;4.35 ms</span><br></pre></td></tr></table></figure>
<p>获取帮助信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@cephL ~]# ip route help</span><br><span class="line">Usage: ip route &#123; list | flush &#125; SELECTOR</span><br><span class="line">       ip route save SELECTOR</span><br><span class="line">       ip route restore</span><br><span class="line">       ip route showdump</span><br><span class="line">       ip route get ADDRESS [ from ADDRESS iif STRING ]</span><br><span class="line">                            [ oif STRING ]  [ tos TOS ]</span><br><span class="line">                            [ mark NUMBER ]</span><br><span class="line">       ip route &#123; add | del | change | append | replace &#125; ROUTE</span><br><span class="line">SELECTOR :&#x3D; [ root PREFIX ] [ match PREFIX ] [ exact PREFIX ]</span><br><span class="line">            [ table TABLE_ID ] [ proto RTPROTO ]</span><br><span class="line">            [ type TYPE ] [ scope SCOPE ]</span><br><span class="line">ROUTE :&#x3D; NODE_SPEC [ INFO_SPEC ]</span><br><span class="line">NODE_SPEC :&#x3D; [ TYPE ] PREFIX [ tos TOS ]</span><br><span class="line">             [ table TABLE_ID ] [ proto RTPROTO ]</span><br><span class="line">             [ scope SCOPE ] [ metric METRIC ]</span><br><span class="line">INFO_SPEC :&#x3D; NH OPTIONS FLAGS [ nexthop NH ]...</span><br><span class="line">NH :&#x3D; [ via ADDRESS ] [ dev STRING ] [ weight NUMBER ] NHFLAGS</span><br><span class="line">OPTIONS :&#x3D; FLAGS [ mtu NUMBER ] [ advmss NUMBER ]</span><br><span class="line">           [ rtt TIME ] [ rttvar TIME ] [reordering NUMBER ]</span><br><span class="line">           [ window NUMBER ] [ cwnd NUMBER ] [ initcwnd NUMBER ]</span><br><span class="line">           [ ssthresh NUMBER ] [ realms REALM ] [ src ADDRESS ]</span><br><span class="line">           [ rto_min TIME ] [ hoplimit NUMBER ] [ initrwnd NUMBER ]</span><br><span class="line">           [ features FEATURES ] [ quickack BOOL ] [ congctl NAME ]</span><br><span class="line">           [ expires TIME ]</span><br><span class="line">TYPE :&#x3D; &#123; unicast | local | broadcast | multicast | throw |</span><br><span class="line">          unreachable | prohibit | blackhole | nat &#125;</span><br><span class="line">TABLE_ID :&#x3D; [ local | main | default | all | NUMBER ]</span><br><span class="line">SCOPE :&#x3D; [ host | link | global | NUMBER ]</span><br><span class="line">NHFLAGS :&#x3D; [ onlink | pervasive ]</span><br><span class="line">RTPROTO :&#x3D; [ kernel | boot | static | NUMBER ]</span><br><span class="line">TIME :&#x3D; NUMBER[s|ms]</span><br><span class="line">BOOL :&#x3D; [1|0]</span><br><span class="line">FEATURES :&#x3D; ecn</span><br></pre></td></tr></table></figure>
<p>yum常用列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides  找到缺少的RPM依赖包，例如yum provides &#39;*&#x2F;dirent.h&#39;</span><br></pre></td></tr></table></figure>
<p>查看ssh登录信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">utmpdump &#x2F;var&#x2F;log&#x2F;wtmp | cat</span><br></pre></td></tr></table></figure>




<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>【1】<a target="_blank" rel="noopener" href="https://linux.cn/article-3144-1.html">https://linux.cn/article-3144-1.html</a></p>
<p>【2】<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d89cc7ecb305">https://www.jianshu.com/p/d89cc7ecb305</a></p>
<p>【3】<a target="_blank" rel="noopener" href="http://www.pagefault.info/?p=240">http://www.pagefault.info/?p=240</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/31/%E8%BF%91%E8%B7%9D%E7%A6%BB%E6%8E%A2%E7%B4%A2memcache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/31/%E8%BF%91%E8%B7%9D%E7%A6%BB%E6%8E%A2%E7%B4%A2memcache/" class="post-title-link" itemprop="url">近距离探索memcache缓存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-31 17:22:03" itemprop="dateCreated datePublished" datetime="2018-05-31T17:22:03+08:00">2018-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:36" itemprop="dateModified" datetime="2020-03-22T16:16:36+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>近距离探索memcache缓存笔记</p>
<p>课程地址：<a target="_blank" rel="noopener" href="https://www.imooc.com/learn/527">https://www.imooc.com/learn/527</a></p>
<p>课程教师：李虎头</p>
<h2 id="memcache解析"><a href="#memcache解析" class="headerlink" title="memcache解析"></a>memcache解析</h2><p>1-1内容解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.知道什么是Memcache</span><br><span class="line">2.知道在什么时候使用Memcache</span><br><span class="line">3.知道怎样使用Memcache优化网站或API</span><br></pre></td></tr></table></figure>
<p>1-2基础介绍</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Memcache介绍</span><br><span class="line">1.什么是Memcache？</span><br><span class="line">	分布式高速缓存系统</span><br><span class="line"></span><br><span class="line">2.Memcache有什么用？</span><br><span class="line">	缓存层，前端频繁操作后端数据库时，减轻后端数据库压力，前端直接访问缓存层</span><br></pre></td></tr></table></figure>
<p>1-3理解Memcache</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">只有一张表的数据库</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>#</th>
<th>名字</th>
<th>类型</th>
<th>整理</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>key</td>
<td>varchar(255)</td>
<td>utf8_general_ci</td>
</tr>
<tr>
<td>2</td>
<td>value</td>
<td>text</td>
<td>utf8_general_ci</td>
</tr>
</tbody></table>
<p>1-4使用场景</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.非持久化存储：对数据存储要求不高</span><br><span class="line">2.分布式存储：不适合单机使用</span><br><span class="line">3.Key&#x2F;Value存储：格式简单，不支持List、Array数据格式</span><br></pre></td></tr></table></figure>
<h2 id="memcache的安装"><a href="#memcache的安装" class="headerlink" title="memcache的安装"></a>memcache的安装</h2><p>2-1安装前的说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.编译安装 Libevent Memcache(需要先安装Libevent依赖)</span><br><span class="line">2.使用依赖管理工具yum、apt-get</span><br><span class="line">-PS：Memcache和Memcached的区别(建议使用Memcached，它是Memcache的升级版)</span><br></pre></td></tr></table></figure>
<p>2-2安装服务端实际操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1.编译安装</span><br><span class="line">yum -y install automake libtool wget gcc gcc-c++ &amp;&amp; wget https:&#x2F;&#x2F;github.com&#x2F;libevent&#x2F;libevent&#x2F;archive&#x2F;release-2.1.8-stable.tar.gz &amp;&amp; tar zxvf release-2.1.8-stable.tar.gz &amp;&amp; cd libevent-release-2.1.8-stable&#x2F; &amp;&amp; .&#x2F;autogen.sh &amp;&amp; .&#x2F;configure &amp;&amp; make -j 2 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;www.memcached.org&#x2F;files&#x2F;memcached-1.5.8.tar.gz &amp;&amp; cd memcached-1.5.8 &amp;&amp; .&#x2F;configure &amp;&amp; make -j 2 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">[root@cephL memcached-1.5.8]# &#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached -h</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached: error while loading shared libraries: libevent-2.1.so.6: cannot open shared object file: No such file or directory</span><br><span class="line">[root@cephL memcached-1.5.8]# ldd &#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached </span><br><span class="line">	linux-vdso.so.1 &#x3D;&gt;  (0x00007ffdd7d77000)</span><br><span class="line">	libevent-2.1.so.6 &#x3D;&gt; not found</span><br><span class="line">	libpthread.so.0 &#x3D;&gt; &#x2F;lib64&#x2F;libpthread.so.0 (0x00007f2d78950000)</span><br><span class="line">	libc.so.6 &#x3D;&gt; &#x2F;lib64&#x2F;libc.so.6 (0x00007f2d78583000)</span><br><span class="line">	&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 (0x000055b9e254c000)</span><br><span class="line">[root@cephL memcached-1.5.8]# LD_DEBUG&#x3D;libs &#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached -v</span><br><span class="line">     51494:	find library&#x3D;libevent-2.1.so.6 [0]; searching</span><br><span class="line">     51494:	 search cache&#x3D;&#x2F;etc&#x2F;ld.so.cache</span><br><span class="line">     51494:	 search path&#x3D;&#x2F;lib64&#x2F;tls&#x2F;x86_64:&#x2F;lib64&#x2F;tls:&#x2F;lib64&#x2F;x86_64:&#x2F;lib64:&#x2F;usr&#x2F;lib64&#x2F;tls&#x2F;x86_64:&#x2F;usr&#x2F;lib64&#x2F;tls:&#x2F;usr&#x2F;lib64&#x2F;x86_64:&#x2F;usr&#x2F;lib64		(system search path)</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;lib64&#x2F;tls&#x2F;x86_64&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;lib64&#x2F;tls&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;lib64&#x2F;x86_64&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;lib64&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;usr&#x2F;lib64&#x2F;tls&#x2F;x86_64&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;usr&#x2F;lib64&#x2F;tls&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;usr&#x2F;lib64&#x2F;x86_64&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	  trying file&#x3D;&#x2F;usr&#x2F;lib64&#x2F;libevent-2.1.so.6</span><br><span class="line">     51494:	</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached: error while loading shared libraries: libevent-2.1.so.6: cannot open shared object file: No such file or directory</span><br><span class="line">[root@cephL memcached-1.5.8]# ll &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libevent-2.1.so.6</span><br><span class="line">lrwxrwxrwx. 1 root root 21 5月  29 18:48 &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libevent-2.1.so.6 -&gt; libevent-2.1.so.6.0.2</span><br><span class="line">[root@cephL memcached-1.5.8]# ln -s &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libevent-2.1.so.6 &#x2F;usr&#x2F;lib64&#x2F;libevent-2.1.so.6</span><br><span class="line">[root@cephL memcached-1.5.8]# &#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached -d -l 127.0.0.1 -p 11211 -m 150 -u root</span><br><span class="line">[root@cephL memcached-1.5.8]# ps -ef | grep memcache</span><br><span class="line">root       51810       1  0 19:04 ?        00:00:00 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;memcached -d -l 127.0.0.1 -p 11211 -m 150 -u root</span><br><span class="line"></span><br><span class="line">2.使用yum安装</span><br><span class="line">[root@cephL memcache]# yum install memcached</span><br><span class="line">[root@cephL memcache]# &#x2F;usr&#x2F;bin&#x2F;memcached -d -l 127.0.0.1 -p 11211 -m 150 -u root</span><br><span class="line"></span><br><span class="line">[root@cephL memcache]# ps -ef | grep memcache</span><br><span class="line">root       40789       1  0 18:34 ?        00:00:00 &#x2F;usr&#x2F;bin&#x2F;memcached -d -l 127.0.0.1 -p 11211 -m 150 -u root</span><br></pre></td></tr></table></figure>
<p>2-3客户端的安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.安装libmemcached</span><br><span class="line">wget https:&#x2F;&#x2F;launchpad.net&#x2F;libmemcached&#x2F;1.0&#x2F;1.0.18&#x2F;+download&#x2F;libmemcached-1.0.18.tar.gz</span><br><span class="line">tar zxvf libmemcached-1.0.18.tar.gz &amp;&amp; cd libmemcached-1.0.18</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;lib&#x2F;libmemcached</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/25/Ceph%E7%BA%A0%E5%88%A0%E7%A0%81bluestore%E4%B8%8Efilestore%E5%AF%B9%E6%AF%94%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/25/Ceph%E7%BA%A0%E5%88%A0%E7%A0%81bluestore%E4%B8%8Efilestore%E5%AF%B9%E6%AF%94%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">Ceph纠删码bluestore与filestore对比调研</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-25 11:02:06" itemprop="dateCreated datePublished" datetime="2018-05-25T11:02:06+08:00">2018-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-22 16:16:35" itemprop="dateModified" datetime="2020-03-22T16:16:35+08:00">2020-03-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近学习Ceph Erasure code，查阅了网络上有许多资料。Erasure code的概念与理论相对成熟，但目前在Ceph中实现与应用上有诸多困难。所以这里只对Ceph Erasure code应用场景做比较。</p>
<p>使用Erasure code的目的是为了节省存储空间（以牺牲计算资源换取存储资源）。</p>
<p><strong>bluestore OSD</strong></p>
<p>在luminous版本之前，只适用于像RGW那样的应用场景（full object writes and appends），不支持partial writes。</p>
<p>（1）用法一</p>
<p>在luminous版本，为了适用于RBD和CephFS的场景，增加了partial writes功能，但是只有在bluestore OSD上可以启用。</p>
<p>Erasure coded pools不支持omap，因此要将它们与RBD和CephFS一起使用，必须明确指示它们将data存储在ec pool中，将metadata存储在replicated pool中。</p>
<p>对于CephFS，在创建file system时通过<a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/cephfs/file-layouts/">file layouts</a>设定一个erasure coded pool作为默认的data pool。</p>
<p>（2）用法二</p>
<p>在erasure coded pool之前设置一个cache tier。</p>
<p><strong>filestore OSD</strong></p>
<p>（1）用法一</p>
<p>Erasure coded pools需要比replicated pools更多的资源，并且缺少一些功能，如omap。为了克服这些限制，可以在erasure coded pool之前设置一个cache tier。</p>
<p>由于使用cache tier并且与Erasure coded相关联，那么Erasure coded的性能同时与cache tier特性相关。这是一个纠结的问题！</p>
<p><strong>Ceph Cache Tiering</strong></p>
<p><img src="http://docs.ceph.com/docs/master/_images/ditaa-2982c5ed3031cac4f9e40545139e51fdb0b33897.png"></p>
<p>如上图，cache tier为客户端读取存储在后端的数据子集提供更好的I/O性能。在创建pool时，Cache Tier层pool作为Storage Tier层pool的缓存。 Ceph objecter handles 负责处理objects放置位置。 tiering agent 决定何时将缓存中的objects刷新到后端存储层。所以cache tier和后端存储层对Ceph clients来说是完全透明的。</p>
<p>但是，管理员可以配置此迁移的发生方式。 主要有两种情况：</p>
<p>Writeback Mode:</p>
<p>当管理员以writeback mode配置tiers时，Ceph clients将数据写入缓存层并从缓存层接收ACK。经过一段时间后，写入缓存层的数据将迁移到存储层，并从缓存层中清除。从概念上讲，缓存层被覆盖在后端存储层的“前面”。当Ceph client需要驻留在存储层中的数据时，cache tiering agent会在读取数据时将数据迁移到缓存层，然后将其发送到Ceph client。此后，Ceph client可以使用缓存层执行I/O，直到数据变为非活动状态。这对于易变数据（例如照片/视频编辑，交易数据等）是理想的。</p>
<p>Read-proxy Mode:</p>
<p>此模式将使用已存在于缓存层中的任何objects，但如果缓存中没有objects，则将请求代理到存储层。这对于从writeback mode转换为禁用缓存非常有用，因为它允许负载在缓存耗尽时正常运行，而无需向缓存中添加任何新objects。</p>
<p>cache tier所有迁移模式：</p>
<p><img src="https://raw.githubusercontent.com/lnsyyj/lnsyyj.github.io/hexo/Blog/source/_posts/Ceph%E7%BA%A0%E5%88%A0%E7%A0%81bluestore%E4%B8%8Efilestore%E5%AF%B9%E6%AF%94%E8%B0%83%E7%A0%94/AAA30A7C3BB8C148411DB8D2C01C175D.jpg"></p>
<p><strong>官方文档明确指出：</strong></p>
<p><strong>A WORD OF CAUTION</strong></p>
<p>Cache tiering会降低大多数workloads的性能。用户在使用此功能之前应特别小心。</p>
<p><strong>Workload dependent:</strong></p>
<p>缓存是否会提高性能，高度依赖于负载。由于将objects移入或移出缓存会产生额外成本，因此只有在数据集中访问存在较大偏差时才会生效，这样大多数请求才会命中少量objects。缓存池应该大到足以捕获你的负载，以避免抖动。</p>
<p><strong>Difficult to benchmark:</strong></p>
<p>使用cache tiering，用户常规衡量性能的基准测试将显得很糟糕，部分原因是由于很少有人将请求集中在一小部分objects上，所以缓存“预热”可能需要很长时间，同时预热可能带来更高的成本。</p>
<p><strong>Usually slower:</strong></p>
<p>对于缓存分层不友好的负载，性能通常比没有设置cache tiering enabled的普通RADOS pool慢。</p>
<p><strong>librados object enumeration:</strong></p>
<p>在这种情况下，librados级别的object enumeration API并不一致。如果您的应用程序直接使用librados并依赖于object enumeration，则缓存分层可能无法按预期工作。 </p>
<p><strong>Complexity:</strong></p>
<p>启用缓存分层会带来额外的复杂性。这会增加其他用户尚未遇到的错误的可能性，并且会使您的部署处于更高级别的风险中。</p>
<p><strong>KNOWN GOOD WORKLOADS</strong></p>
<p><strong>RGW time-skewed:</strong></p>
<p>如果RGW负载几乎所有读取操作都针对最近写入的objects，可配置为一段时间后，将最近写入的对象从缓存层迁移到存储层，这种场景可以很好地工作。</p>
<p><strong>KNOWN BAD WORKLOADS</strong></p>
<p>已知下列配置对cache tiering效果不佳。</p>
<p><strong>RBD with replicated cache and erasure-coded base:</strong></p>
<p>这是一个常见的要求，但通常表现不佳。即使合理偏差的负载仍然会向cold objects发送一些small writes操作，由于erasure-coded pool尚不支持small writes操作，因此必须将整个（通常为4 MB）objects迁移到缓存中以满足small write（通常为4 KB）。只有少数用户成功部署了此配置，并且仅适用于他们，因为他们的数据extremely cold（备份）并且对性能没有任何要求。</p>
<p><strong>RBD with replicated cache and base:</strong></p>
<p>具有replicated base tier（存储层）的RBD效果要好于erasure coded base tier（存储层）时的RBD，但它仍高度依赖于负载中的偏差量，而且很难验证。用户需要很好地理解他们的负载，并需要调整缓存分层参数。</p>
<p><strong>总结</strong></p>
<p>1、 架构角度，如果想用Ceph Erasure code，推荐使用bluestore OSD，而不推荐filestore OSD。</p>
<p>抛开bluestore的稳定性不谈（待验证），filestore OSD的Ceph Erasure code依赖Ceph Cache Tiering会带来额外的复杂性，并且限制了应用场景。</p>
<p>摘自李运华：</p>
<p>组件越多，就越有可能其中某个组件出现故障，从而导致系统故障。这个概率可以算出来，假设组件的故障率是10%（有10%的时间不可用），那么有1个组件的系统可用性是(1-10%)=90%，有2个组件的系统的可用性是(1-10%)*(1-10%)=81%，两者的可用性相差9%。</p>
<p>2、如果使用filestore OSD的Ceph Erasure code，推荐应用在RGW time-skewed场景（官方推荐）。而Ceph Cache Tiering据生产环境落地还有一定距离。 </p>
<p>3、近来很多公司都在搞云计算、搞研发，有些是自主研发而有些是基于开源定制开发。如果是基于开源，根据之前的经验，代码直接提交到社区根据社区的发布流程会省去很多额外的工作。</p>
<p>自主研发版本控制是痛苦的，需要考虑社区base更新，自主研发的代码移植到社区最新base（查分代码到吐。。。），如果社区框架变动大，还需要调试改代码。如果是聪明的开发会找到一条扩展的路，尽量更改原有逻辑，如果更改原有逻辑，对测试来说是个很大的挑战。</p>
<p>4、对于产品化一个开源项目，如ceph，还是寻找一个稳定的方案，然后再搞研发，至少研发失败还给自己留条后路，因为你背后有一个强大的社区团队。</p>
<p><strong>附录</strong></p>
<p>中文文档，如看不懂请看英语原文</p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/12/CEPH-ERASURE-CODE/">https://lnsyyj.github.io/2018/05/12/CEPH-ERASURE-CODE/</a></p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/12/CACHE-TIERING/">https://lnsyyj.github.io/2018/05/12/CACHE-TIERING/</a></p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/15/ERASURE-CODE-PROFILES/">https://lnsyyj.github.io/2018/05/15/ERASURE-CODE-PROFILES/</a></p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/16/JERASURE-ERASURE-CODE-PLUGIN/">https://lnsyyj.github.io/2018/05/16/JERASURE-ERASURE-CODE-PLUGIN/</a></p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/16/ISA-ERASURE-CODE-PLUGIN/">https://lnsyyj.github.io/2018/05/16/ISA-ERASURE-CODE-PLUGIN/</a></p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/17/LOCALLY-REPAIRABLE-ERASURE-CODE-PLUGIN/">https://lnsyyj.github.io/2018/05/17/LOCALLY-REPAIRABLE-ERASURE-CODE-PLUGIN/</a></p>
<p><a target="_blank" rel="noopener" href="https://lnsyyj.github.io/2018/05/18/SHEC-ERASURE-CODE-PLUGIN/">https://lnsyyj.github.io/2018/05/18/SHEC-ERASURE-CODE-PLUGIN/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">110</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
